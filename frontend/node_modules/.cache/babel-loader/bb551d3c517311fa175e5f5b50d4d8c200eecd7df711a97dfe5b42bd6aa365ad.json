{"ast":null,"code":"import { addClass, detach, EventHandler, isNullOrUndefined, select, Ajax, formatUnit } from '@syncfusion/ej2-base';\nimport { Browser, closest, removeClass, isNullOrUndefined as isNOU } from '@syncfusion/ej2-base';\nimport * as events from '../base/constant';\nimport * as classes from '../base/classes';\nimport { Uploader, TextBox } from '@syncfusion/ej2-inputs';\nimport { Popup } from '@syncfusion/ej2-popups';\nimport { Button, CheckBox } from '@syncfusion/ej2-buttons';\nimport { RenderType } from '../base/enum';\nimport { dispatchEvent, parseHtml, hasClass, convertToBlob } from '../base/util';\nimport { isIDevice } from '../../common/util';\n/**\n * `Image` module is used to handle image actions.\n */\nvar Image = /** @class */function () {\n  function Image(parent, serviceLocator) {\n    this.isImgUploaded = false;\n    this.isAllowedTypes = true;\n    this.pageX = null;\n    this.pageY = null;\n    this.deletedImg = [];\n    this.parent = parent;\n    this.rteID = parent.element.id;\n    this.i10n = serviceLocator.getService('rteLocale');\n    this.rendererFactory = serviceLocator.getService('rendererFactory');\n    this.dialogRenderObj = serviceLocator.getService('dialogRenderObject');\n    this.addEventListener();\n  }\n  Image.prototype.addEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n    this.parent.on(events.keyDown, this.onKeyDown, this);\n    this.parent.on(events.keyUp, this.onKeyUp, this);\n    this.parent.on(events.insertImage, this.insertImage, this);\n    this.parent.on(events.showImageDialog, this.showDialog, this);\n    this.parent.on(events.closeImageDialog, this.closeDialog, this);\n    this.parent.on(events.windowResize, this.onWindowResize, this);\n    this.parent.on(events.insertCompleted, this.showImageQuickToolbar, this);\n    this.parent.on(events.clearDialogObj, this.clearDialogObj, this);\n    this.parent.on(events.imageToolbarAction, this.onToolbarAction, this);\n    this.parent.on(events.imageCaption, this.caption, this);\n    this.parent.on(events.imageDelete, this.deleteImg, this);\n    this.parent.on(events.imageLink, this.insertImgLink, this);\n    this.parent.on(events.imageAlt, this.insertAltText, this);\n    this.parent.on(events.editAreaClick, this.editAreaClickHandler, this);\n    this.parent.on(events.iframeMouseDown, this.onIframeMouseDown, this);\n    this.parent.on(events.imageSize, this.imageSize, this);\n    this.parent.on(events.dropDownSelect, this.alignmentSelect, this);\n    this.parent.on(events.initialEnd, this.afterRender, this);\n    this.parent.on(events.dynamicModule, this.afterRender, this);\n    this.parent.on(events.paste, this.imagePaste, this);\n    this.parent.on(events.destroy, this.removeEventListener, this);\n  };\n  Image.prototype.removeEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n    this.parent.off(events.keyDown, this.onKeyDown);\n    this.parent.off(events.keyUp, this.onKeyUp);\n    this.parent.off(events.windowResize, this.onWindowResize);\n    this.parent.off(events.insertImage, this.insertImage);\n    this.parent.off(events.showImageDialog, this.showDialog);\n    this.parent.off(events.closeImageDialog, this.closeDialog);\n    this.parent.off(events.insertCompleted, this.showImageQuickToolbar);\n    this.parent.off(events.clearDialogObj, this.clearDialogObj);\n    this.parent.off(events.imageCaption, this.caption);\n    this.parent.off(events.imageToolbarAction, this.onToolbarAction);\n    this.parent.off(events.imageDelete, this.deleteImg);\n    this.parent.off(events.imageLink, this.insertImgLink);\n    this.parent.off(events.imageAlt, this.insertAltText);\n    this.parent.off(events.editAreaClick, this.editAreaClickHandler);\n    this.parent.off(events.iframeMouseDown, this.onIframeMouseDown);\n    this.parent.off(events.imageSize, this.imageSize);\n    this.parent.off(events.dropDownSelect, this.alignmentSelect);\n    this.parent.off(events.initialEnd, this.afterRender);\n    this.parent.off(events.dynamicModule, this.afterRender);\n    this.parent.off(events.paste, this.imagePaste);\n    this.parent.off(events.destroy, this.removeEventListener);\n    var dropElement = this.parent.iframeSettings.enable ? this.parent.inputElement.ownerDocument : this.parent.inputElement;\n    dropElement.removeEventListener('drop', this.dragDrop.bind(this), true);\n    dropElement.removeEventListener('dragstart', this.dragStart.bind(this), true);\n    dropElement.removeEventListener('dragenter', this.dragEnter.bind(this), true);\n    dropElement.removeEventListener('dragover', this.dragOver.bind(this), true);\n    if (!isNullOrUndefined(this.contentModule)) {\n      EventHandler.remove(this.contentModule.getEditPanel(), Browser.touchEndEvent, this.imageClick);\n      this.parent.formatter.editorManager.observer.off(events.checkUndo, this.undoStack);\n      if (this.parent.insertImageSettings.resize) {\n        EventHandler.remove(this.parent.contentModule.getEditPanel(), Browser.touchStartEvent, this.resizeStart);\n        EventHandler.remove(this.parent.element.ownerDocument, 'mousedown', this.onDocumentClick);\n        EventHandler.remove(this.contentModule.getEditPanel(), 'cut', this.onCutHandler);\n      }\n    }\n  };\n  Image.prototype.onIframeMouseDown = function () {\n    if (this.dialogObj) {\n      this.dialogObj.hide({\n        returnValue: true\n      });\n    }\n  };\n  Image.prototype.afterRender = function () {\n    this.contentModule = this.rendererFactory.getRenderer(RenderType.Content);\n    EventHandler.add(this.contentModule.getEditPanel(), Browser.touchEndEvent, this.imageClick, this);\n    if (this.parent.insertImageSettings.resize) {\n      EventHandler.add(this.parent.contentModule.getEditPanel(), Browser.touchStartEvent, this.resizeStart, this);\n      EventHandler.add(this.parent.element.ownerDocument, 'mousedown', this.onDocumentClick, this);\n      EventHandler.add(this.contentModule.getEditPanel(), 'cut', this.onCutHandler, this);\n    }\n    var dropElement = this.parent.iframeSettings.enable ? this.parent.inputElement.ownerDocument : this.parent.inputElement;\n    dropElement.addEventListener('drop', this.dragDrop.bind(this), true);\n    dropElement.addEventListener('dragstart', this.dragStart.bind(this), true);\n    dropElement.addEventListener('dragenter', this.dragOver.bind(this), true);\n    dropElement.addEventListener('dragover', this.dragOver.bind(this), true);\n  };\n  Image.prototype.undoStack = function (args) {\n    if (args.subCommand.toLowerCase() === 'undo' || args.subCommand.toLowerCase() === 'redo') {\n      for (var i = 0; i < this.parent.formatter.getUndoRedoStack().length; i++) {\n        var temp = this.parent.createElement('div');\n        var contentElem = parseHtml(this.parent.formatter.getUndoRedoStack()[i].text);\n        temp.appendChild(contentElem);\n        var img = temp.querySelectorAll('img');\n        if (temp.querySelector('.e-img-resize') && img.length > 0) {\n          for (var j = 0; j < img.length; j++) {\n            img[j].style.outline = '';\n          }\n          detach(temp.querySelector('.e-img-resize'));\n          this.parent.formatter.getUndoRedoStack()[i].text = temp.innerHTML;\n        }\n      }\n    }\n  };\n  Image.prototype.resizeEnd = function (e) {\n    this.resizeBtnInit();\n    this.imgEle.parentElement.style.cursor = 'auto';\n    if (Browser.isDevice) {\n      removeClass([e.target.parentElement], 'e-mob-span');\n    }\n    var args = {\n      event: e,\n      requestType: 'images'\n    };\n    this.parent.trigger(events.resizeStop, args);\n    /* eslint-disable */\n    var pageX = this.getPointX(e);\n    var pageY = this.parent.iframeSettings.enable ? window.pageYOffset + this.parent.element.getBoundingClientRect().top + e.clientY : e.pageY;\n    /* eslint-enable */\n    this.parent.formatter.editorManager.observer.on(events.checkUndo, this.undoStack, this);\n    this.parent.formatter.saveData();\n  };\n  Image.prototype.resizeStart = function (e, ele) {\n    var _this = this;\n    if (this.parent.readonly) {\n      return;\n    }\n    var target = ele ? ele : e.target;\n    this.prevSelectedImgEle = this.imgEle;\n    if (target.tagName === 'IMG') {\n      this.parent.preventDefaultResize(e);\n      var img = target;\n      if (this.imgResizeDiv && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n        detach(this.imgResizeDiv);\n      }\n      this.imageResize(img);\n    }\n    if (target.classList.contains('e-rte-imageboxmark')) {\n      if (this.parent.formatter.getUndoRedoStack().length === 0) {\n        this.parent.formatter.saveData();\n      }\n      this.pageX = this.getPointX(e);\n      this.pageY = this.getPointY(e);\n      e.preventDefault();\n      e.stopImmediatePropagation();\n      this.resizeBtnInit();\n      if (this.quickToolObj) {\n        this.quickToolObj.imageQTBar.hidePopup();\n      }\n      if (target.classList.contains('e-rte-topLeft')) {\n        this.resizeBtnStat.topLeft = true;\n      }\n      if (target.classList.contains('e-rte-topRight')) {\n        this.resizeBtnStat.topRight = true;\n      }\n      if (target.classList.contains('e-rte-botLeft')) {\n        this.resizeBtnStat.botLeft = true;\n      }\n      if (target.classList.contains('e-rte-botRight')) {\n        this.resizeBtnStat.botRight = true;\n      }\n      if (Browser.isDevice && this.contentModule.getEditPanel().contains(this.imgResizeDiv) && !this.imgResizeDiv.classList.contains('e-mob-span')) {\n        addClass([this.imgResizeDiv], 'e-mob-span');\n      } else {\n        var args = {\n          event: e,\n          requestType: 'images'\n        };\n        this.parent.trigger(events.resizeStart, args, function (resizeStartArgs) {\n          if (resizeStartArgs.cancel) {\n            _this.cancelResizeAction();\n          }\n        });\n      }\n      EventHandler.add(this.contentModule.getDocument(), Browser.touchEndEvent, this.resizeEnd, this);\n    }\n  };\n  Image.prototype.imageClick = function (e) {\n    if (Browser.isDevice) {\n      if (e.target.tagName === 'IMG' && e.target.parentElement.tagName === 'A' || e.target.tagName === 'IMG') {\n        this.contentModule.getEditPanel().setAttribute('contenteditable', 'false');\n        e.target.focus();\n      } else {\n        if (!this.parent.readonly) {\n          this.contentModule.getEditPanel().setAttribute('contenteditable', 'true');\n        }\n      }\n    }\n    if (e.target.tagName === 'IMG' && e.target.parentElement.tagName === 'A') {\n      e.preventDefault();\n    }\n  };\n  Image.prototype.onCutHandler = function () {\n    if (this.imgResizeDiv && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n      this.cancelResizeAction();\n    }\n  };\n  Image.prototype.imageResize = function (e) {\n    this.resizeBtnInit();\n    this.imgEle = e;\n    addClass([this.imgEle], 'e-resize');\n    this.imgResizeDiv = this.parent.createElement('span', {\n      className: 'e-img-resize',\n      id: this.rteID + '_imgResize'\n    });\n    this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n      className: 'e-rte-imageboxmark e-rte-topLeft',\n      styles: 'cursor: nwse-resize'\n    }));\n    this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n      className: 'e-rte-imageboxmark e-rte-topRight',\n      styles: 'cursor: nesw-resize'\n    }));\n    this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n      className: 'e-rte-imageboxmark e-rte-botLeft',\n      styles: 'cursor: nesw-resize'\n    }));\n    this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n      className: 'e-rte-imageboxmark e-rte-botRight',\n      styles: 'cursor: nwse-resize'\n    }));\n    if (Browser.isDevice) {\n      addClass([this.imgResizeDiv], 'e-mob-rte');\n    }\n    e.style.outline = '2px solid #4a90e2';\n    this.imgResizePos(e, this.imgResizeDiv);\n    this.resizeImgDupPos(e);\n    this.contentModule.getEditPanel().appendChild(this.imgResizeDiv);\n    EventHandler.add(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing, this);\n  };\n  Image.prototype.getPointX = function (e) {\n    if (e.touches && e.touches.length) {\n      return e.touches[0].pageX;\n    } else {\n      return e.pageX;\n    }\n  };\n  Image.prototype.getPointY = function (e) {\n    if (e.touches && e.touches.length) {\n      return e.touches[0].pageY;\n    } else {\n      return e.pageY;\n    }\n  };\n  Image.prototype.imgResizePos = function (e, imgResizeDiv) {\n    var pos = this.calcPos(e);\n    var top = pos.top;\n    var left = pos.left;\n    var imgWid = e.width;\n    var imgHgt = e.height;\n    var borWid = Browser.isDevice ? 4 * parseInt(e.style.outline.slice(-3), 10) + 2 : 2 * parseInt(e.style.outline.slice(-3), 10) + 2; //span border width + image outline width\n    var devWid = Browser.isDevice ? 0 : 2; // span border width\n    imgResizeDiv.querySelector('.e-rte-botLeft').style.left = left - borWid + 'px';\n    imgResizeDiv.querySelector('.e-rte-botLeft').style.top = imgHgt - borWid + top + 'px';\n    imgResizeDiv.querySelector('.e-rte-botRight').style.left = imgWid - (borWid - devWid) + left + 'px';\n    imgResizeDiv.querySelector('.e-rte-botRight').style.top = imgHgt - borWid + top + 'px';\n    imgResizeDiv.querySelector('.e-rte-topRight').style.left = imgWid - (borWid - devWid) + left + 'px';\n    imgResizeDiv.querySelector('.e-rte-topRight').style.top = top - borWid + 'px';\n    imgResizeDiv.querySelector('.e-rte-topLeft').style.left = left - borWid + 'px';\n    imgResizeDiv.querySelector('.e-rte-topLeft').style.top = top - borWid + 'px';\n  };\n  Image.prototype.calcPos = function (elem) {\n    var ignoreOffset = ['TD', 'TH', 'TABLE', 'A'];\n    var parentOffset = {\n      top: 0,\n      left: 0\n    };\n    var doc = elem.ownerDocument;\n    var offsetParent = (elem.offsetParent && (elem.offsetParent.classList.contains('e-img-caption') || ignoreOffset.indexOf(elem.offsetParent.tagName) > -1) ? closest(elem, '#' + this.parent.getID() + '_rte-edit-view') : elem.offsetParent) || doc.documentElement;\n    while (offsetParent && (offsetParent === doc.body || offsetParent === doc.documentElement) && offsetParent.style.position === 'static') {\n      offsetParent = offsetParent.parentNode;\n    }\n    if (offsetParent && offsetParent !== elem && offsetParent.nodeType === 1) {\n      // eslint-disable-next-line\n      parentOffset = offsetParent.getBoundingClientRect();\n    }\n    return {\n      top: elem.offsetTop,\n      left: elem.offsetLeft\n    };\n  };\n  Image.prototype.setAspectRatio = function (img, expectedX, expectedY, e) {\n    if (isNullOrUndefined(img.width)) {\n      return;\n    }\n    var width = img.style.width !== '' ? img.style.width.match(/^\\d+(\\.\\d*)?%$/g) ? parseFloat(img.style.width) : parseInt(img.style.width, 10) : img.width;\n    var height = img.style.height !== '' ? parseInt(img.style.height, 10) : img.height;\n    if (width > height) {\n      img.style.minWidth = '20px';\n      if (this.parent.insertImageSettings.resizeByPercent) {\n        if (parseInt('' + img.getBoundingClientRect().width + '', 10) !== 0 && parseInt('' + width + '', 10) !== 0) {\n          var percentageValue = this.pixToPerc(width / height * expectedY, img.previousElementSibling || img.parentElement);\n          img.style.width = Math.min(Math.round(percentageValue / img.getBoundingClientRect().width * expectedX * 100) / 100, 100) + '%';\n        } else {\n          img.style.width = this.pixToPerc(width / height * expectedY, img.previousElementSibling || img.parentElement) + '%';\n        }\n        img.style.height = null;\n        img.removeAttribute('height');\n      } else if (img.style.width === '' && img.style.height !== '') {\n        img.style.height = expectedY + 'px';\n      } else if (img.style.width !== '' && img.style.height === '') {\n        var currentWidth = width / height * expectedY + width / height < this.parent.inputElement.getBoundingClientRect().right - 32 ? width / height * expectedY + width / height : this.parent.inputElement.getBoundingClientRect().right - 32;\n        img.style.width = currentWidth.toString() + 'px';\n      } else if (img.style.width !== '') {\n        var currentWidth = width / height * expectedY < this.parent.inputElement.getBoundingClientRect().right - 32 ? width / height * expectedY : this.parent.inputElement.getBoundingClientRect().right - 32;\n        img.style.width = currentWidth + 'px';\n        img.style.height = expectedY + 'px';\n      } else {\n        img.setAttribute('width', (width / height * expectedY + width / height).toString());\n      }\n    } else if (height > width) {\n      if (this.parent.insertImageSettings.resizeByPercent) {\n        if (parseInt('' + img.getBoundingClientRect().width + '', 10) !== 0 && parseInt('' + width + '', 10) !== 0) {\n          img.style.width = Math.min(Math.round(width / img.getBoundingClientRect().width * expectedX * 100) / 100, 100) + '%';\n        } else {\n          img.style.width = this.pixToPerc(expectedX / height * expectedY, img.previousElementSibling || img.parentElement) + '%';\n        }\n        img.style.height = null;\n        img.removeAttribute('height');\n      } else if (img.style.width !== '') {\n        img.style.width = expectedX + 'px';\n        img.style.height = height / width * expectedX + 'px';\n      } else {\n        img.setAttribute('width', this.resizeBtnStat.botRight ? (this.getPointX(e.event) - img.getBoundingClientRect().left).toString() : expectedX.toString());\n      }\n    } else {\n      if (this.parent.insertImageSettings.resizeByPercent) {\n        img.style.width = this.pixToPerc(expectedX, img.previousElementSibling || img.parentElement) + '%';\n        img.style.height = null;\n        img.removeAttribute('height');\n      } else if (img.style.width !== '') {\n        img.style.width = expectedX + 'px';\n        img.style.height = expectedX + 'px';\n      } else {\n        img.setAttribute('width', expectedX.toString());\n        img.setAttribute('height', expectedX.toString());\n      }\n    }\n  };\n  Image.prototype.pixToPerc = function (expected, parentEle) {\n    return expected / parseFloat(getComputedStyle(parentEle).width) * 100;\n  };\n  Image.prototype.imgDupMouseMove = function (width, height, e) {\n    var _this = this;\n    var args = {\n      event: e,\n      requestType: 'images'\n    };\n    this.parent.trigger(events.onResize, args, function (resizingArgs) {\n      if (resizingArgs.cancel) {\n        _this.cancelResizeAction();\n      } else {\n        if (parseInt(_this.parent.insertImageSettings.minWidth, 10) >= parseInt(width, 10) || parseInt(_this.parent.getInsertImgMaxWidth(), 10) <= parseInt(width, 10) && isNOU(_this.imgEle.style.width)) {\n          return;\n        }\n        if (!_this.parent.insertImageSettings.resizeByPercent && (parseInt(_this.parent.insertImageSettings.minHeight, 10) >= parseInt(height, 10) || parseInt(_this.parent.insertImageSettings.maxHeight, 10) <= parseInt(height, 10))) {\n          return;\n        }\n        _this.imgEle.parentElement.style.cursor = 'pointer';\n        _this.setAspectRatio(_this.imgEle, parseInt(width, 10), parseInt(height, 10), args);\n        _this.resizeImgDupPos(_this.imgEle);\n        _this.imgResizePos(_this.imgEle, _this.imgResizeDiv);\n        _this.parent.setContentHeight('', false);\n      }\n    });\n  };\n  Image.prototype.resizing = function (e) {\n    if (this.imgEle.offsetWidth >= this.parent.getInsertImgMaxWidth()) {\n      this.imgEle.style.maxHeight = this.imgEle.offsetHeight + 'px';\n    }\n    var pageX = this.getPointX(e);\n    var pageY = this.getPointY(e);\n    var mouseX = this.resizeBtnStat.botLeft || this.resizeBtnStat.topLeft ? -(pageX - this.pageX) : pageX - this.pageX;\n    var mouseY = this.resizeBtnStat.topLeft || this.resizeBtnStat.topRight ? -(pageY - this.pageY) : pageY - this.pageY;\n    var width = parseInt(this.imgDupPos.width, 10) + mouseX;\n    var height = parseInt(this.imgDupPos.height, 10) + mouseY;\n    this.pageX = pageX;\n    this.pageY = pageY;\n    if (this.resizeBtnStat.botRight) {\n      this.imgDupMouseMove(width + 'px', height + 'px', e);\n    } else if (this.resizeBtnStat.botLeft) {\n      this.imgDupMouseMove(width + 'px', height + 'px', e);\n    } else if (this.resizeBtnStat.topRight) {\n      this.imgDupMouseMove(width + 'px', height + 'px', e);\n    } else if (this.resizeBtnStat.topLeft) {\n      this.imgDupMouseMove(width + 'px', height + 'px', e);\n    }\n  };\n  Image.prototype.cancelResizeAction = function () {\n    EventHandler.remove(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing);\n    EventHandler.remove(this.contentModule.getDocument(), Browser.touchEndEvent, this.resizeEnd);\n    if (this.imgEle && this.imgResizeDiv && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n      detach(this.imgResizeDiv);\n      this.imgEle.style.outline = '';\n      this.imgResizeDiv = null;\n      this.pageX = null;\n      this.pageY = null;\n    }\n  };\n  Image.prototype.resizeImgDupPos = function (e) {\n    this.imgDupPos = {\n      width: e.style.width !== '' && this.parent.insertImageSettings && !this.parent.insertImageSettings.resizeByPercent ? this.imgEle.style.width : e.width + 'px',\n      height: e.style.height !== '' ? this.imgEle.style.height : e.height + 'px'\n    };\n  };\n  Image.prototype.resizeBtnInit = function () {\n    return this.resizeBtnStat = {\n      botLeft: false,\n      botRight: false,\n      topRight: false,\n      topLeft: false\n    };\n  };\n  Image.prototype.onToolbarAction = function (args) {\n    if (isIDevice()) {\n      this.parent.notify(events.selectionRestore, {});\n    }\n    var item = args.args.item;\n    switch (item.subCommand) {\n      case 'Replace':\n        if (this.parent.fileManagerSettings.enable) {\n          this.parent.notify(events.renderFileManager, args);\n        } else {\n          this.parent.notify(events.insertImage, args);\n        }\n        break;\n      case 'Caption':\n        this.parent.notify(events.imageCaption, args);\n        break;\n      case 'InsertLink':\n        this.parent.notify(events.imageLink, args);\n        break;\n      case 'AltText':\n        this.parent.notify(events.imageAlt, args);\n        break;\n      case 'Remove':\n        this.parent.notify(events.imageDelete, args);\n        break;\n      case 'Dimension':\n        this.parent.notify(events.imageSize, args);\n        break;\n      case 'OpenImageLink':\n        this.openImgLink(args);\n        break;\n      case 'EditImageLink':\n        this.editImgLink(args);\n        break;\n      case 'RemoveImageLink':\n        this.removeImgLink(args);\n        break;\n    }\n  };\n  Image.prototype.openImgLink = function (e) {\n    var target = e.selectParent[0].parentNode.target === '' ? '_self' : '_blank';\n    this.parent.formatter.process(this.parent, e.args, e.args, {\n      url: e.selectParent[0].parentNode.href,\n      target: target,\n      selectNode: e.selectNode,\n      subCommand: e.args.item.subCommand\n    });\n  };\n  Image.prototype.editImgLink = function (e) {\n    var selectParentEle = e.selectParent[0].parentNode;\n    var linkUpdate = this.i10n.getConstant('dialogUpdate');\n    var inputDetails = {\n      url: selectParentEle.href,\n      target: selectParentEle.target,\n      header: 'Edit Link',\n      btnText: linkUpdate\n    };\n    this.insertImgLink(e, inputDetails);\n  };\n  Image.prototype.removeImgLink = function (e) {\n    if (Browser.isIE) {\n      this.contentModule.getEditPanel().focus();\n    }\n    e.selection.restore();\n    var isCapLink = this.contentModule.getEditPanel().contains(this.captionEle) && select('a', this.captionEle) ? true : false;\n    var selectParent = isCapLink ? [this.captionEle] : [e.selectNode[0].parentElement];\n    this.parent.formatter.process(this.parent, e.args, e.args, {\n      insertElement: e.selectNode[0],\n      selectParent: selectParent,\n      selection: e.selection,\n      subCommand: e.args.item.subCommand\n    });\n    if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n      this.quickToolObj.imageQTBar.hidePopup();\n      if (!isNullOrUndefined(e.selectParent)) {\n        removeClass([e.selectParent[0]], 'e-img-focus');\n      }\n    }\n    if (isCapLink) {\n      select('.e-img-inner', this.captionEle).focus();\n    }\n  };\n  Image.prototype.onKeyDown = function (event) {\n    var originalEvent = event.args;\n    var range;\n    var save;\n    var selectNodeEle;\n    var selectParentEle;\n    this.deletedImg = [];\n    var isCursor;\n    var keyCodeValues = [27, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 44, 45, 9, 16, 17, 18, 19, 20, 33, 34, 35, 36, 37, 38, 39, 40, 91, 92, 93, 144, 145, 182, 183];\n    if (this.parent.editorMode === 'HTML') {\n      range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n      isCursor = range.startContainer === range.endContainer && range.startOffset === range.endOffset;\n    }\n    if (!isCursor && this.parent.editorMode === 'HTML' && keyCodeValues.indexOf(originalEvent.which) < 0) {\n      var nodes = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n      for (var i = 0; i < nodes.length; i++) {\n        if (nodes[i].nodeName === 'IMG') {\n          this.deletedImg.push(nodes[i]);\n        }\n      }\n    }\n    if (this.parent.editorMode === 'HTML' && (originalEvent.which === 8 && originalEvent.code === 'Backspace' || originalEvent.which === 46 && originalEvent.code === 'Delete')) {\n      var isCursor_1 = range.startContainer === range.endContainer && range.startOffset === range.endOffset;\n      if (originalEvent.which === 8 && originalEvent.code === 'Backspace' && isCursor_1) {\n        this.checkImageBack(range);\n      } else if (originalEvent.which === 46 && originalEvent.code === 'Delete' && isCursor_1) {\n        this.checkImageDel(range);\n      }\n    }\n    if (!isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection) && originalEvent.code !== 'KeyK') {\n      range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n      save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n      selectNodeEle = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n      selectParentEle = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n      if (!originalEvent.ctrlKey && originalEvent.key && (originalEvent.key.length === 1 || originalEvent.action === 'enter') && selectParentEle[0].tagName === 'IMG' && selectParentEle[0].parentElement) {\n        var prev = selectParentEle[0].parentElement.childNodes[0];\n        if (this.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n          this.removeResizeEle();\n        }\n        this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(), prev, prev, prev.textContent.length, prev.textContent.length);\n        removeClass([selectParentEle[0]], 'e-img-focus');\n        this.quickToolObj.imageQTBar.hidePopup();\n      }\n    }\n    if (originalEvent.ctrlKey && (originalEvent.keyCode === 89 || originalEvent.keyCode === 90)) {\n      this.undoStack({\n        subCommand: originalEvent.keyCode === 90 ? 'undo' : 'redo'\n      });\n    }\n    if (originalEvent.keyCode === 8 || originalEvent.keyCode === 46) {\n      if (selectNodeEle && selectNodeEle[0].nodeName === 'IMG' && selectNodeEle.length < 1) {\n        originalEvent.preventDefault();\n        var event_1 = {\n          selectNode: selectNodeEle,\n          selection: save,\n          selectParent: selectParentEle,\n          args: {\n            item: {\n              command: 'Images',\n              subCommand: 'Remove'\n            },\n            originalEvent: originalEvent\n          }\n        };\n        this.deleteImg(event_1, originalEvent.keyCode);\n      }\n      if (this.parent.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n        this.removeResizeEle();\n      }\n    }\n    if (originalEvent.code === 'Backspace') {\n      originalEvent.action = 'backspace';\n    }\n    switch (originalEvent.action) {\n      case 'escape':\n        if (!isNullOrUndefined(this.dialogObj)) {\n          this.dialogObj.close();\n        }\n        break;\n      case 'backspace':\n      case 'delete':\n        for (var i = 0; i < this.deletedImg.length; i++) {\n          var src = this.deletedImg[i].src;\n          this.imageRemovePost(src);\n        }\n        if (this.parent.editorMode !== 'Markdown') {\n          if (range.startContainer.nodeType === 3) {\n            if (originalEvent.code === 'Backspace') {\n              if (range.startContainer.previousElementSibling && range.startOffset === 0 && range.startContainer.previousElementSibling.classList.contains(classes.CLS_CAPTION) && range.startContainer.previousElementSibling.classList.contains(classes.CLS_CAPINLINE)) {\n                detach(range.startContainer.previousElementSibling);\n              }\n            } else {\n              if (range.startContainer.nextElementSibling && range.endContainer.textContent.length === range.endOffset && range.startContainer.nextElementSibling.classList.contains(classes.CLS_CAPTION) && range.startContainer.nextElementSibling.classList.contains(classes.CLS_CAPINLINE)) {\n                detach(range.startContainer.nextElementSibling);\n              }\n            }\n          } else if (range.startContainer.nodeType === 1 && range.startContainer.querySelector('.' + classes.CLS_CAPTION + '.' + classes.CLS_CAPINLINE)) {\n            detach(range.startContainer.querySelector('.' + classes.CLS_CAPTION + '.' + classes.CLS_CAPINLINE));\n          }\n        }\n        break;\n      case 'insert-image':\n        this.openDialog(true, originalEvent, save, selectNodeEle, selectParentEle);\n        originalEvent.preventDefault();\n        break;\n    }\n  };\n  Image.prototype.openDialog = function (isInternal, event, selection, ele, parentEle) {\n    var range;\n    var save;\n    var selectNodeEle;\n    var selectParentEle;\n    if (!isInternal && !isNOU(this.parent.formatter.editorManager.nodeSelection)) {\n      range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n      save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n      selectNodeEle = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n      selectParentEle = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n    } else {\n      save = selection;\n      selectNodeEle = ele;\n      selectParentEle = parentEle;\n    }\n    if (this.parent.editorMode === 'HTML') {\n      this.insertImage({\n        args: {\n          item: {\n            command: 'Images',\n            subCommand: 'Image'\n          },\n          originalEvent: event\n        },\n        selectNode: selectNodeEle,\n        selection: save,\n        selectParent: selectParentEle\n      });\n    } else {\n      this.insertImage({\n        args: {\n          item: {\n            command: 'Images',\n            subCommand: 'Image'\n          },\n          originalEvent: event\n        },\n        member: 'image',\n        text: this.parent.formatter.editorManager.markdownSelection.getSelectedText(this.parent.contentModule.getEditPanel()),\n        module: 'Markdown',\n        name: 'insertImage'\n      });\n    }\n  };\n  Image.prototype.showDialog = function () {\n    this.openDialog(false);\n  };\n  Image.prototype.closeDialog = function () {\n    if (this.dialogObj) {\n      this.dialogObj.hide({\n        returnValue: true\n      });\n    }\n  };\n  // eslint-disable-next-line\n  Image.prototype.onKeyUp = function (event) {\n    if (!isNOU(this.deletedImg) && this.deletedImg.length > 0) {\n      for (var i = 0; i < this.deletedImg.length; i++) {\n        var args = {\n          element: this.deletedImg[i],\n          src: this.deletedImg[i].getAttribute('src')\n        };\n        this.parent.trigger(events.afterImageDelete, args);\n      }\n    }\n  };\n  Image.prototype.checkImageBack = function (range) {\n    if (range.startContainer.nodeName === '#text' && range.startOffset === 0 && !isNOU(range.startContainer.previousSibling) && range.startContainer.previousSibling.nodeName === 'IMG') {\n      this.deletedImg.push(range.startContainer.previousSibling);\n    } else if (range.startContainer.nodeName !== '#text' && !isNOU(range.startContainer.childNodes[range.startOffset - 1]) && range.startContainer.childNodes[range.startOffset - 1].nodeName === 'IMG') {\n      this.deletedImg.push(range.startContainer.childNodes[range.startOffset - 1]);\n    }\n  };\n  Image.prototype.checkImageDel = function (range) {\n    if (range.startContainer.nodeName === '#text' && range.startOffset === range.startContainer.textContent.length && !isNOU(range.startContainer.nextSibling) && range.startContainer.nextSibling.nodeName === 'IMG') {\n      this.deletedImg.push(range.startContainer.nextSibling);\n    } else if (range.startContainer.nodeName !== '#text' && !isNOU(range.startContainer.childNodes[range.startOffset]) && range.startContainer.childNodes[range.startOffset].nodeName === 'IMG') {\n      this.deletedImg.push(range.startContainer.childNodes[range.startOffset]);\n    }\n  };\n  Image.prototype.alignmentSelect = function (e) {\n    var item = e.item;\n    if (!document.body.contains(document.body.querySelector('.e-rte-quick-toolbar')) || item.command !== 'Images') {\n      return;\n    }\n    var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n    var selectNodeEle = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n    selectNodeEle = selectNodeEle[0].nodeName === 'IMG' ? selectNodeEle : [this.imgEle];\n    var args = {\n      args: e,\n      selectNode: selectNodeEle\n    };\n    if (this.parent.formatter.getUndoRedoStack().length === 0) {\n      this.parent.formatter.saveData();\n    }\n    switch (item.subCommand) {\n      case 'JustifyLeft':\n        this.alignImage(args, 'JustifyLeft');\n        break;\n      case 'JustifyCenter':\n        this.alignImage(args, 'JustifyCenter');\n        break;\n      case 'JustifyRight':\n        this.alignImage(args, 'JustifyRight');\n        break;\n      case 'Inline':\n        this.inline(args);\n        break;\n      case 'Break':\n        this.break(args);\n        break;\n    }\n    if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n      this.quickToolObj.imageQTBar.hidePopup();\n      removeClass([selectNodeEle[0]], 'e-img-focus');\n    }\n    this.cancelResizeAction();\n  };\n  Image.prototype.imageWithLinkQTBarItemUpdate = function () {\n    var separator;\n    var items = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item');\n    for (var i = 0; i < items.length; i++) {\n      if (items[i].getAttribute('title') === this.i10n.getConstant('openLink') || items[i].getAttribute('title') === this.i10n.getConstant('editLink') || items[i].getAttribute('title') === this.i10n.getConstant('removeLink')) {\n        addClass([items[i]], 'e-link-groups');\n        items[i].style.display = 'none';\n      } else if (items[i].getAttribute('title') === 'Insert Link') {\n        items[i].style.display = '';\n      } else if (items[i].classList.contains('e-rte-horizontal-separator')) {\n        // eslint-disable-next-line\n        separator = items[i];\n        detach(items[i]);\n      }\n    }\n    var newItems = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item:not(.e-link-groups)');\n    this.quickToolObj.imageQTBar.addQTBarItem(['-'], Math.round(newItems.length / 2));\n  };\n  Image.prototype.showImageQuickToolbar = function (e) {\n    var _this = this;\n    if (e.type !== 'Images' || isNullOrUndefined(this.parent.quickToolbarModule) || isNullOrUndefined(this.parent.quickToolbarModule.imageQTBar) || isNullOrUndefined(e.args)) {\n      return;\n    }\n    this.quickToolObj = this.parent.quickToolbarModule;\n    var args = e.args;\n    var target = e.elements;\n    [].forEach.call(e.elements, function (element, index) {\n      if (index === 0) {\n        target = element;\n      }\n    });\n    if (target && !closest(target, 'a')) {\n      this.imageWithLinkQTBarItemUpdate();\n    }\n    if (target.nodeName === 'IMG') {\n      addClass([target], ['e-img-focus']);\n    }\n    var pageY = this.parent.iframeSettings.enable ? window.pageYOffset + this.parent.element.getBoundingClientRect().top + args.clientY : args.pageY;\n    if (this.parent.quickToolbarModule.imageQTBar) {\n      if (e.isNotify) {\n        setTimeout(function () {\n          _this.quickToolObj.imageQTBar.showPopup(args.pageX, pageY, target);\n        }, 400);\n      } else {\n        this.quickToolObj.imageQTBar.showPopup(args.pageX, pageY, target);\n      }\n    }\n  };\n  Image.prototype.hideImageQuickToolbar = function () {\n    if (!isNullOrUndefined(this.contentModule.getEditPanel().querySelector('.e-img-focus'))) {\n      removeClass([this.contentModule.getEditPanel().querySelector('.e-img-focus')], 'e-img-focus');\n      if (this.quickToolObj && this.quickToolObj.imageQTBar && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n        this.quickToolObj.imageQTBar.hidePopup();\n      }\n    }\n  };\n  Image.prototype.editAreaClickHandler = function (e) {\n    if (this.parent.readonly) {\n      this.hideImageQuickToolbar();\n      return;\n    }\n    var args = e.args;\n    var showOnRightClick = this.parent.quickToolbarSettings.showOnRightClick;\n    if (args.which === 2 || showOnRightClick && args.which === 1 || !showOnRightClick && args.which === 3) {\n      if (showOnRightClick && args.which === 1 && !isNullOrUndefined(args.target) && args.target.tagName === 'IMG') {\n        this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument());\n        this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(), args.target);\n      }\n      return;\n    }\n    if (this.parent.editorMode === 'HTML' && this.parent.quickToolbarModule && this.parent.quickToolbarModule.imageQTBar) {\n      this.quickToolObj = this.parent.quickToolbarModule;\n      var target = args.target;\n      this.contentModule = this.rendererFactory.getRenderer(RenderType.Content);\n      var isPopupOpen = this.quickToolObj.imageQTBar.element.classList.contains('e-rte-pop');\n      if (target.nodeName === 'IMG' && this.parent.quickToolbarModule) {\n        if (isPopupOpen) {\n          return;\n        }\n        this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument());\n        this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(), target);\n        if (isIDevice()) {\n          this.parent.notify(events.selectionSave, e);\n        }\n        addClass([target], 'e-img-focus');\n        var items = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item');\n        var separator = void 0;\n        if (closest(target, 'a')) {\n          for (var i = 0; i < items.length; i++) {\n            if (items[i].getAttribute('title') === this.i10n.getConstant('openLink') || items[i].getAttribute('title') === this.i10n.getConstant('editLink') || items[i].getAttribute('title') === this.i10n.getConstant('removeLink')) {\n              items[i].style.display = '';\n              removeClass([items[i]], 'e-link-groups');\n            } else if (items[i].getAttribute('title') === 'Insert Link') {\n              items[i].style.display = 'none';\n            } else if (items[i].classList.contains('e-rte-horizontal-separator')) {\n              // eslint-disable-next-line\n              separator = items[i];\n              detach(items[i]);\n            }\n          }\n          var newItems = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item:not(.e-link-groups)');\n          this.quickToolObj.imageQTBar.addQTBarItem(['-'], Math.round(newItems.length / 2));\n        } else if (!closest(target, 'a')) {\n          this.imageWithLinkQTBarItemUpdate();\n        }\n        this.showImageQuickToolbar({\n          args: args,\n          type: 'Images',\n          elements: [args.target]\n        });\n      } else {\n        this.hideImageQuickToolbar();\n      }\n    }\n  };\n  Image.prototype.insertImgLink = function (e, inputDetails) {\n    var _this = this;\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n    this.imagDialog(e);\n    if (!isNullOrUndefined(this.dialogObj)) {\n      var linkWrap = this.parent.createElement('div', {\n        className: 'e-img-linkwrap'\n      });\n      var linkUrl = this.i10n.getConstant('linkurl');\n      var content = '<div class=\"e-rte-field\">' + '<input type=\"text\" data-role =\"none\" class=\"e-input e-img-link\" spellcheck=\"false\" placeholder=\"' + linkUrl + '\"/></div>' + '<div class=\"e-rte-label\"></div>' + '<div class=\"e-rte-field\">' + '<input type=\"checkbox\" class=\"e-rte-linkTarget\"  data-role =\"none\"></div>';\n      var contentElem = parseHtml(content);\n      linkWrap.appendChild(contentElem);\n      var linkTarget = linkWrap.querySelector('.e-rte-linkTarget');\n      var inputLink = linkWrap.querySelector('.e-img-link');\n      var linkOpenLabel = this.i10n.getConstant('linkOpenInNewWindow');\n      this.checkBoxObj = new CheckBox({\n        label: linkOpenLabel,\n        checked: true,\n        enableRtl: this.parent.enableRtl,\n        change: function (e) {\n          if (e.checked) {\n            target_1 = '_blank';\n          } else {\n            target_1 = null;\n          }\n        }\n      });\n      this.checkBoxObj.isStringTemplate = true;\n      this.checkBoxObj.createElement = this.parent.createElement;\n      this.checkBoxObj.appendTo(linkTarget);\n      var target_1 = this.checkBoxObj.checked ? '_blank' : null;\n      var linkUpdate = this.i10n.getConstant('dialogUpdate');\n      var linkargs_1 = {\n        args: e.args,\n        selfImage: this,\n        selection: e.selection,\n        selectNode: e.selectNode,\n        selectParent: e.selectParent,\n        link: inputLink,\n        target: target_1\n      };\n      this.dialogObj.setProperties({\n        height: 'inherit',\n        width: '290px',\n        header: this.parent.localeObj.getConstant('imageInsertLinkHeader'),\n        content: linkWrap,\n        position: {\n          X: 'center',\n          Y: 'center'\n        },\n        buttons: [{\n          // eslint-disable-next-line\n          click: function (e) {\n            _this.insertlink(linkargs_1);\n          },\n          buttonModel: {\n            content: linkUpdate,\n            cssClass: 'e-flat e-update-link',\n            isPrimary: true\n          }\n        }]\n      });\n      if (!isNullOrUndefined(inputDetails)) {\n        inputLink.value = inputDetails.url;\n        // eslint-disable-next-line\n        inputDetails.target ? this.checkBoxObj.checked = true : this.checkBoxObj.checked = false;\n        this.dialogObj.header = inputDetails.header;\n      }\n      this.dialogObj.element.style.maxHeight = 'inherit';\n      this.dialogObj.content.querySelector('input').focus();\n    }\n  };\n  Image.prototype.insertAltText = function (e) {\n    var _this = this;\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n    this.imagDialog(e);\n    var altText = this.i10n.getConstant('altText');\n    if (!isNullOrUndefined(this.dialogObj)) {\n      var altWrap = this.parent.createElement('div', {\n        className: 'e-img-altwrap'\n      });\n      var altHeader = this.i10n.getConstant('alternateHeader');\n      var linkUpdate = this.i10n.getConstant('dialogUpdate');\n      var getAlt = e.selectNode[0].getAttribute('alt') === null ? '' : e.selectNode[0].getAttribute('alt');\n      var content = '<div class=\"e-rte-field\">' + '<input type=\"text\" spellcheck=\"false\" value=\"' + getAlt + '\" class=\"e-input e-img-alt\" placeholder=\"' + altText + '\"/>' + '</div>';\n      var contentElem = parseHtml(content);\n      altWrap.appendChild(contentElem);\n      var inputAlt = altWrap.querySelector('.e-img-alt');\n      var altArgs_1 = {\n        args: e.args,\n        selfImage: this,\n        selection: e.selection,\n        selectNode: e.selectNode,\n        alt: inputAlt\n      };\n      this.dialogObj.setProperties({\n        height: 'inherit',\n        width: '290px',\n        header: altHeader,\n        content: altWrap,\n        position: {\n          X: 'center',\n          Y: 'center'\n        },\n        buttons: [{\n          // eslint-disable-next-line\n          click: function (e) {\n            _this.insertAlt(altArgs_1);\n          },\n          buttonModel: {\n            content: linkUpdate,\n            cssClass: 'e-flat e-update-alt',\n            isPrimary: true\n          }\n        }]\n      });\n      this.dialogObj.element.style.maxHeight = 'inherit';\n      this.dialogObj.content.querySelector('input').focus();\n    }\n  };\n  Image.prototype.insertAlt = function (e) {\n    if (!isNullOrUndefined(e.alt)) {\n      e.selection.restore();\n      if (this.parent.formatter.getUndoRedoStack().length === 0) {\n        this.parent.formatter.saveData();\n      }\n      var altText = e.alt.value;\n      this.parent.formatter.process(this.parent, e.args, e.args, {\n        altText: altText,\n        selectNode: e.selectNode,\n        subCommand: e.args.item.subCommand\n      });\n      this.dialogObj.hide({\n        returnValue: false\n      });\n    }\n  };\n  Image.prototype.insertlink = function (e) {\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n    var url = e.link.value;\n    if (url === '') {\n      addClass([e.link], 'e-error');\n      e.link.setSelectionRange(0, url.length);\n      e.link.focus();\n      return;\n    }\n    if (!this.isUrl(url)) {\n      url = 'http://' + url;\n    } else {\n      removeClass([e.link], 'e-error');\n    }\n    var proxy = e.selfImage;\n    if (proxy.parent.editorMode === 'HTML') {\n      e.selection.restore();\n    }\n    if (proxy.parent.formatter.getUndoRedoStack().length === 0) {\n      proxy.parent.formatter.saveData();\n    }\n    if (e.selectNode[0].parentElement.nodeName === 'A') {\n      proxy.parent.formatter.process(proxy.parent, e.args, e.args, {\n        url: url,\n        target: proxy.checkBoxObj.checked ? '_blank' : null,\n        selectNode: e.selectNode,\n        subCommand: e.args.item.subCommand\n      });\n      proxy.dialogObj.hide({\n        returnValue: true\n      });\n      return;\n    }\n    proxy.parent.formatter.process(proxy.parent, e.args, e.args, {\n      url: url,\n      target: proxy.checkBoxObj.checked ? '_blank' : null,\n      selectNode: e.selectNode,\n      subCommand: e.args.item.subCommand,\n      selection: e.selection\n    });\n    var captionEle = closest(e.selectNode[0], '.e-img-caption');\n    if (captionEle) {\n      select('.e-img-inner', captionEle).focus();\n    }\n    if (captionEle) {\n      select('.e-img-inner', captionEle).focus();\n    }\n    proxy.dialogObj.hide({\n      returnValue: false\n    });\n  };\n  Image.prototype.isUrl = function (url) {\n    // eslint-disable-next-line\n    var regexp = /(ftp|http|https):\\/\\/(\\w+:{0,1}\\w*@)?(\\S+)(:[0-9]+)?(\\/|\\/([\\w#!:.?+=&%@!\\-\\/]))?/gi;\n    return regexp.test(url);\n  };\n  Image.prototype.deleteImg = function (e, keyCode) {\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n    var args = {\n      element: e.selectNode[0],\n      src: e.selectNode[0].getAttribute('src')\n    };\n    if (this.parent.formatter.getUndoRedoStack().length === 0) {\n      this.parent.formatter.saveData();\n    }\n    e.selection.restore();\n    if (this.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n      this.removeResizeEle();\n    }\n    this.parent.formatter.process(this.parent, e.args, e.args, {\n      selectNode: e.selectNode,\n      captionClass: classes.CLS_CAPTION,\n      subCommand: e.args.item.subCommand\n    });\n    this.imageRemovePost(args.src);\n    if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n      this.quickToolObj.imageQTBar.hidePopup();\n    }\n    this.cancelResizeAction();\n    if (isNullOrUndefined(keyCode)) {\n      this.parent.trigger(events.afterImageDelete, args);\n    }\n  };\n  Image.prototype.imageRemovePost = function (src) {\n    var proxy = this;\n    var absoluteUrl = '';\n    if (isNOU(this.parent.insertImageSettings.removeUrl) || this.parent.insertImageSettings.removeUrl === '') {\n      return;\n    }\n    if (src.indexOf('http://') > -1 || src.indexOf('https://') > -1) {\n      absoluteUrl = src;\n    } else {\n      absoluteUrl = new URL(src, document.baseURI).href;\n    }\n    this.removingImgName = absoluteUrl.replace(/^.*[\\\\\\/]/, '');\n    var xhr = new XMLHttpRequest();\n    xhr.addEventListener(\"readystatechange\", function () {\n      if (this.readyState == 4 && this.status == 200) {\n        proxy.triggerPost(this.response);\n      }\n    });\n    xhr.open('GET', absoluteUrl);\n    xhr.responseType = 'blob';\n    xhr.send();\n  };\n  Image.prototype.triggerPost = function (response) {\n    var removeUrl = this.parent.insertImageSettings.removeUrl;\n    if (isNOU(removeUrl) || removeUrl === '') {\n      return;\n    }\n    var file = new File([response], this.removingImgName);\n    var ajax = new Ajax(removeUrl, 'POST', true, null);\n    var formData = new FormData();\n    formData.append('UploadFiles', file);\n    ajax.send(formData);\n  };\n  Image.prototype.caption = function (e) {\n    var selectNode = e.selectNode[0];\n    if (selectNode.nodeName !== 'IMG') {\n      return;\n    }\n    e.selection.restore();\n    if (this.parent.formatter.getUndoRedoStack().length === 0) {\n      this.parent.formatter.saveData();\n    }\n    this.cancelResizeAction();\n    addClass([selectNode], 'e-rte-image');\n    var subCommand = e.args.item ? e.args.item.subCommand : 'Caption';\n    if (!isNullOrUndefined(closest(selectNode, '.' + classes.CLS_CAPTION))) {\n      detach(closest(selectNode, '.' + classes.CLS_CAPTION));\n      if (Browser.isIE) {\n        this.contentModule.getEditPanel().focus();\n        e.selection.restore();\n      }\n      if (selectNode.parentElement.tagName === 'A') {\n        this.parent.formatter.process(this.parent, e.args, e.args, {\n          insertElement: selectNode.parentElement,\n          selectNode: e.selectNode,\n          subCommand: subCommand\n        });\n      } else {\n        this.parent.formatter.process(this.parent, e.args, e.args, {\n          insertElement: selectNode,\n          selectNode: e.selectNode,\n          subCommand: subCommand\n        });\n      }\n    } else {\n      this.captionEle = this.parent.createElement('span', {\n        className: classes.CLS_CAPTION + ' ' + classes.CLS_RTE_CAPTION,\n        attrs: {\n          contenteditable: 'false',\n          draggable: 'false',\n          style: 'width:' + this.parent.insertImageSettings.width\n        }\n      });\n      var imgWrap = this.parent.createElement('span', {\n        className: 'e-img-wrap'\n      });\n      var imgInner = this.parent.createElement('span', {\n        className: 'e-img-inner',\n        attrs: {\n          contenteditable: 'true'\n        }\n      });\n      var parent_1 = e.selectNode[0].parentElement;\n      if (parent_1.tagName === 'A') {\n        parent_1.setAttribute('contenteditable', 'true');\n      }\n      imgWrap.appendChild(parent_1.tagName === 'A' ? parent_1 : e.selectNode[0]);\n      imgWrap.appendChild(imgInner);\n      var imgCaption = this.i10n.getConstant('imageCaption');\n      imgInner.innerHTML = imgCaption;\n      this.captionEle.appendChild(imgWrap);\n      if (selectNode.classList.contains(classes.CLS_IMGINLINE)) {\n        addClass([this.captionEle], classes.CLS_CAPINLINE);\n      }\n      if (selectNode.classList.contains(classes.CLS_IMGBREAK)) {\n        addClass([this.captionEle], classes.CLS_IMGBREAK);\n      }\n      if (selectNode.classList.contains(classes.CLS_IMGLEFT)) {\n        addClass([this.captionEle], classes.CLS_IMGLEFT);\n      }\n      if (selectNode.classList.contains(classes.CLS_IMGRIGHT)) {\n        addClass([this.captionEle], classes.CLS_IMGRIGHT);\n      }\n      if (selectNode.classList.contains(classes.CLS_IMGCENTER)) {\n        addClass([this.captionEle], classes.CLS_IMGCENTER);\n      }\n      this.parent.formatter.process(this.parent, e.args, e.args, {\n        insertElement: this.captionEle,\n        selectNode: e.selectNode,\n        subCommand: subCommand\n      });\n      this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(), imgInner.childNodes[0], imgInner.childNodes[0], 0, imgInner.childNodes[0].textContent.length);\n    }\n    if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n      this.quickToolObj.imageQTBar.hidePopup();\n      removeClass([selectNode], 'e-img-focus');\n    }\n  };\n  Image.prototype.imageSize = function (e) {\n    var _this = this;\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n    this.imagDialog(e);\n    if (!isNullOrUndefined(this.dialogObj)) {\n      var imgSizeHeader = this.i10n.getConstant('imageSizeHeader');\n      var linkUpdate = this.i10n.getConstant('dialogUpdate');\n      var dialogContent = this.imgsizeInput(e);\n      var selectObj_1 = {\n        args: e.args,\n        selfImage: this,\n        selection: e.selection,\n        selectNode: e.selectNode\n      };\n      this.dialogObj.setProperties({\n        height: 'inherit',\n        width: '290px',\n        header: imgSizeHeader,\n        content: dialogContent,\n        position: {\n          X: 'center',\n          Y: 'center'\n        },\n        buttons: [{\n          // eslint-disable-next-line\n          click: function (e) {\n            _this.insertSize(selectObj_1);\n          },\n          buttonModel: {\n            content: linkUpdate,\n            cssClass: 'e-flat e-update-size',\n            isPrimary: true\n          }\n        }]\n      });\n      this.dialogObj.element.style.maxHeight = 'inherit';\n      this.dialogObj.content.querySelector('input').focus();\n    }\n  };\n  Image.prototype.break = function (e) {\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n    var subCommand = e.args.item ? e.args.item.subCommand : 'Break';\n    this.parent.formatter.process(this.parent, e.args, e.args, {\n      selectNode: e.selectNode,\n      subCommand: subCommand\n    });\n  };\n  Image.prototype.inline = function (e) {\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n    var subCommand = e.args.item ? e.args.item.subCommand : 'Inline';\n    this.parent.formatter.process(this.parent, e.args, e.args, {\n      selectNode: e.selectNode,\n      subCommand: subCommand\n    });\n  };\n  Image.prototype.alignImage = function (e, type) {\n    var subCommand = e.args.item ? e.args.item.subCommand : type;\n    this.parent.formatter.process(this.parent, e.args, e.args, {\n      selectNode: e.selectNode,\n      subCommand: subCommand\n    });\n  };\n  Image.prototype.clearDialogObj = function () {\n    if (this.dialogObj) {\n      this.dialogObj.destroy();\n      detach(this.dialogObj.element);\n      this.dialogObj = null;\n    }\n  };\n  Image.prototype.imagDialog = function (e) {\n    var _this = this;\n    if (this.dialogObj) {\n      this.dialogObj.hide({\n        returnValue: true\n      });\n      return;\n    }\n    var imgDialog = this.parent.createElement('div', {\n      className: 'e-rte-img-dialog',\n      id: this.rteID + '_image'\n    });\n    this.parent.element.appendChild(imgDialog);\n    var imgInsert = this.i10n.getConstant('dialogInsert');\n    var imglinkCancel = this.i10n.getConstant('dialogCancel');\n    var imgHeader = this.i10n.getConstant('imageHeader');\n    var selection = e.selection;\n    var selectObj = {\n      selfImage: this,\n      selection: e.selection,\n      args: e.args,\n      selectParent: e.selectParent\n    };\n    var dialogModel = {\n      header: imgHeader,\n      cssClass: classes.CLS_RTE_ELEMENTS,\n      enableRtl: this.parent.enableRtl,\n      locale: this.parent.locale,\n      showCloseIcon: true,\n      closeOnEscape: true,\n      width: Browser.isDevice ? '290px' : '340px',\n      height: 'inherit',\n      position: {\n        X: 'center',\n        Y: Browser.isDevice ? 'center' : 'top'\n      },\n      isModal: Browser.isDevice,\n      buttons: [{\n        click: this.insertImageUrl.bind(selectObj),\n        buttonModel: {\n          content: imgInsert,\n          cssClass: 'e-flat e-insertImage',\n          isPrimary: true,\n          disabled: true\n        }\n      }, {\n        click: function (e) {\n          _this.cancelDialog(e);\n        },\n        buttonModel: {\n          cssClass: 'e-flat e-cancel',\n          content: imglinkCancel\n        }\n      }],\n      target: Browser.isDevice ? document.body : this.parent.element,\n      animationSettings: {\n        effect: 'None'\n      },\n      close: function (event) {\n        if (_this.isImgUploaded) {\n          _this.uploadObj.removing();\n        }\n        _this.parent.isBlur = false;\n        if (event && event.event.returnValue) {\n          if (_this.parent.editorMode === 'HTML') {\n            selection.restore();\n          } else {\n            _this.parent.formatter.editorManager.markdownSelection.restore(_this.parent.contentModule.getEditPanel());\n          }\n        }\n        _this.dialogObj.destroy();\n        detach(_this.dialogObj.element);\n        _this.dialogRenderObj.close(event);\n        _this.dialogObj = null;\n      }\n    };\n    var dialogContent = this.parent.createElement('div', {\n      className: 'e-img-content'\n    });\n    if (!isNullOrUndefined(this.parent.insertImageSettings.path) && this.parent.editorMode === 'Markdown' || this.parent.editorMode === 'HTML') {\n      dialogContent.appendChild(this.imgUpload(e));\n    }\n    var linkHeader = this.parent.createElement('div', {\n      className: 'e-linkheader'\n    });\n    var linkHeaderText = this.i10n.getConstant('imageLinkHeader');\n    if (this.parent.editorMode === 'HTML') {\n      linkHeader.innerHTML = linkHeaderText;\n    } else {\n      linkHeader.innerHTML = this.i10n.getConstant('mdimageLink');\n    }\n    dialogContent.appendChild(linkHeader);\n    dialogContent.appendChild(this.imageUrlPopup(e));\n    if (e.selectNode && e.selectNode[0].nodeName === 'IMG') {\n      dialogModel.header = this.parent.localeObj.getConstant('editImageHeader');\n      dialogModel.content = dialogContent;\n    } else {\n      dialogModel.content = dialogContent;\n    }\n    this.dialogObj = this.dialogRenderObj.render(dialogModel);\n    this.dialogObj.createElement = this.parent.createElement;\n    this.dialogObj.appendTo(imgDialog);\n    if (isNullOrUndefined(this.dialogObj)) {\n      return;\n    }\n    if (e.selectNode && e.selectNode[0].nodeName === 'IMG' && e.name === 'insertImage') {\n      this.dialogObj.element.querySelector('.e-insertImage').textContent = this.parent.localeObj.getConstant('dialogUpdate');\n    }\n    imgDialog.style.maxHeight = 'inherit';\n    if (this.quickToolObj) {\n      if (this.quickToolObj.imageQTBar && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n        this.quickToolObj.imageQTBar.hidePopup();\n        if (!isNullOrUndefined(e.selectParent)) {\n          removeClass([e.selectParent[0]], 'e-img-focus');\n        }\n      }\n      if (this.quickToolObj.inlineQTBar && document.body.contains(this.quickToolObj.inlineQTBar.element)) {\n        this.quickToolObj.inlineQTBar.hidePopup();\n      }\n    }\n  };\n  // eslint-disable-next-line\n  Image.prototype.cancelDialog = function (e) {\n    this.parent.isBlur = false;\n    this.dialogObj.hide({\n      returnValue: true\n    });\n    if (this.isImgUploaded) {\n      this.uploadObj.removing();\n    }\n  };\n  Image.prototype.onDocumentClick = function (e) {\n    var target = e.target;\n    if (target.nodeName === 'IMG') {\n      this.imgEle = target;\n    }\n    if (!isNullOrUndefined(this.dialogObj) && (\n    // eslint-disable-next-line\n    !closest(target, '[id=' + \"'\" + this.dialogObj.element.id + \"'\" + ']') && this.parent.toolbarSettings.enable && this.parent.getToolbarElement() && !this.parent.getToolbarElement().contains(e.target) || this.parent.getToolbarElement() && this.parent.getToolbarElement().contains(e.target) && !closest(target, '#' + this.parent.getID() + '_toolbar_Image') && !target.querySelector('#' + this.parent.getID() + '_toolbar_Image'))) {\n      /* eslint-disable */\n      if (e.offsetX > e.target.clientWidth || e.offsetY > e.target.clientHeight) {} else {\n        this.dialogObj.hide({\n          returnValue: true\n        });\n        this.parent.isBlur = true;\n        dispatchEvent(this.parent.element, 'focusout');\n      }\n      /* eslint-enable */\n    }\n\n    if (e.target.tagName !== 'IMG' && this.imgResizeDiv && !(this.quickToolObj && this.quickToolObj.imageQTBar && this.quickToolObj.imageQTBar.element.contains(e.target)) && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n      this.cancelResizeAction();\n    }\n    if (this.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n      if (target.tagName !== 'IMG') {\n        this.removeResizeEle();\n      }\n      if (target.tagName !== 'IMG' && !isNOU(this.imgEle)) {\n        this.imgEle.style.outline = '';\n      } else if (!isNOU(this.prevSelectedImgEle) && this.prevSelectedImgEle !== target) {\n        this.prevSelectedImgEle.style.outline = '';\n      }\n    }\n  };\n  Image.prototype.removeResizeEle = function () {\n    EventHandler.remove(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing);\n    EventHandler.remove(this.contentModule.getDocument(), Browser.touchEndEvent, this.resizeEnd);\n    detach(this.contentModule.getEditPanel().querySelector('.e-img-resize'));\n  };\n  Image.prototype.onWindowResize = function () {\n    if (!isNOU(this.contentModule) && !isNOU(this.contentModule.getEditPanel().querySelector('.e-img-resize'))) {\n      this.cancelResizeAction();\n    }\n  };\n  // eslint-disable-next-line\n  Image.prototype.imageUrlPopup = function (e) {\n    var _this = this;\n    var imgUrl = this.parent.createElement('div', {\n      className: 'imgUrl'\n    });\n    var placeUrl = this.i10n.getConstant('imageUrl');\n    this.inputUrl = this.parent.createElement('input', {\n      className: 'e-input e-img-url',\n      attrs: {\n        placeholder: placeUrl,\n        spellcheck: 'false'\n      }\n    });\n    this.inputUrl.addEventListener('input', function () {\n      if (!isNOU(_this.inputUrl)) {\n        if (_this.inputUrl.value.length === 0) {\n          _this.dialogObj.getButtons(0).element.disabled = true;\n        } else {\n          _this.dialogObj.getButtons(0).element.removeAttribute('disabled');\n        }\n      }\n    });\n    imgUrl.appendChild(this.inputUrl);\n    return imgUrl;\n  };\n  // eslint-disable-next-line\n  Image.prototype.insertImageUrl = function (e) {\n    var proxy = this.selfImage;\n    proxy.isImgUploaded = false;\n    var url = proxy.inputUrl.value;\n    if (proxy.parent.formatter.getUndoRedoStack().length === 0) {\n      proxy.parent.formatter.saveData();\n    }\n    if (!isNullOrUndefined(proxy.uploadUrl) && proxy.uploadUrl.url !== '') {\n      proxy.uploadUrl.cssClass = proxy.parent.insertImageSettings.display === 'inline' ? classes.CLS_IMGINLINE : classes.CLS_IMGBREAK;\n      proxy.dialogObj.hide({\n        returnValue: false\n      });\n      proxy.parent.formatter.process(proxy.parent, this.args, this.args.originalEvent, proxy.uploadUrl);\n      proxy.uploadUrl.url = '';\n      if (proxy.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n        proxy.imgEle.style.outline = '';\n        proxy.removeResizeEle();\n      }\n    } else if (url !== '') {\n      if (proxy.parent.editorMode === 'HTML' && isNullOrUndefined(closest(\n      // eslint-disable-next-line\n      this.selection.range.startContainer.parentNode, '[id=' + \"'\" + proxy.contentModule.getPanel().id + \"'\" + ']'))) {\n        proxy.contentModule.getEditPanel().focus();\n        var range = proxy.parent.formatter.editorManager.nodeSelection.getRange(proxy.contentModule.getDocument());\n        this.selection = proxy.parent.formatter.editorManager.nodeSelection.save(range, proxy.contentModule.getDocument());\n        this.selectParent = proxy.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n      }\n      var regex = /[\\w-]+.(jpg|png|jpeg|gif)/g;\n      var matchUrl = !isNullOrUndefined(url.match(regex)) && proxy.parent.editorMode === 'HTML' ? url.match(regex)[0] : '';\n      var value = {\n        cssClass: proxy.parent.insertImageSettings.display === 'inline' ? classes.CLS_IMGINLINE : classes.CLS_IMGBREAK,\n        url: url,\n        selection: this.selection,\n        altText: matchUrl,\n        selectParent: this.selectParent,\n        width: {\n          width: proxy.parent.insertImageSettings.width,\n          minWidth: proxy.parent.insertImageSettings.minWidth,\n          maxWidth: proxy.parent.getInsertImgMaxWidth()\n        },\n        height: {\n          height: proxy.parent.insertImageSettings.height,\n          minHeight: proxy.parent.insertImageSettings.minHeight,\n          maxHeight: proxy.parent.insertImageSettings.maxHeight\n        }\n      };\n      proxy.parent.formatter.process(proxy.parent, this.args, this.args.originalEvent, value);\n      proxy.dialogObj.hide({\n        returnValue: false\n      });\n    }\n  };\n  Image.prototype.imgsizeInput = function (e) {\n    var _this = this;\n    var selectNode = e.selectNode[0];\n    var imgHeight = this.i10n.getConstant('imageHeight');\n    var imgWidth = this.i10n.getConstant('imageWidth');\n    var imgSizeWrap = this.parent.createElement('div', {\n      className: 'e-img-sizewrap'\n    });\n    var widthVal = isNullOrUndefined(this.changedWidthValue) && (selectNode.style.width.toString() === 'auto' || selectNode.style.width !== '') ? selectNode.style.width : !isNullOrUndefined(this.changedWidthValue) ? this.changedWidthValue : parseInt(selectNode.getClientRects()[0].width.toString(), 10).toString();\n    var heightVal = isNullOrUndefined(this.changedHeightValue) && (selectNode.style.height.toString() === 'auto' || selectNode.style.height !== '') ? selectNode.style.height : !isNullOrUndefined(this.changedHeightValue) ? this.changedHeightValue : parseInt(selectNode.getClientRects()[0].height.toString(), 10).toString();\n    this.changedWidthValue = null;\n    this.changedHeightValue = null;\n    var content = '<div class=\"e-rte-label\"><label>' + imgWidth + '</label></div><div class=\"e-rte-field\"><input type=\"text\" id=\"imgwidth\" class=\"e-img-width\" value=' + widthVal + ' /></div>' + '<div class=\"e-rte-label\">' + '<label>' + imgHeight + '</label></div><div class=\"e-rte-field\"> ' + '<input type=\"text\" id=\"imgheight\" class=\"e-img-height\" value=' + heightVal + ' /></div>';\n    var contentElem = parseHtml(content);\n    imgSizeWrap.appendChild(contentElem);\n    var widthNum = new TextBox({\n      value: formatUnit(widthVal),\n      enableRtl: this.parent.enableRtl,\n      input: function (e) {\n        _this.inputWidthValue = formatUnit(_this.inputValue(e.value));\n      }\n    });\n    widthNum.createElement = this.parent.createElement;\n    widthNum.appendTo(imgSizeWrap.querySelector('#imgwidth'));\n    var heightNum = new TextBox({\n      value: formatUnit(heightVal),\n      enableRtl: this.parent.enableRtl,\n      input: function (e) {\n        _this.inputHeightValue = formatUnit(_this.inputValue(e.value));\n      }\n    });\n    heightNum.createElement = this.parent.createElement;\n    heightNum.appendTo(imgSizeWrap.querySelector('#imgheight'));\n    return imgSizeWrap;\n  };\n  Image.prototype.inputValue = function (value) {\n    if (value === 'auto' || value.indexOf('%') !== -1 || value.indexOf('px') !== -1 || value.match(/(\\d+)/)) {\n      return value;\n    } else {\n      return 'auto';\n    }\n  };\n  Image.prototype.insertSize = function (e) {\n    e.selection.restore();\n    var proxy = e.selfImage;\n    if (proxy.parent.formatter.getUndoRedoStack().length === 0) {\n      proxy.parent.formatter.saveData();\n    }\n    var dialogEle = proxy.dialogObj.element;\n    this.changedWidthValue = this.inputWidthValue;\n    this.changedHeightValue = this.inputHeightValue;\n    var width = dialogEle.querySelector('.e-img-width').value;\n    var height = dialogEle.parentElement.querySelector('.e-img-height').value;\n    proxy.parent.formatter.process(this.parent, e.args, e.args, {\n      width: width,\n      height: height,\n      selectNode: e.selectNode,\n      subCommand: e.args.item.subCommand\n    });\n    if (this.imgResizeDiv) {\n      proxy.imgResizePos(e.selectNode[0], this.imgResizeDiv);\n    }\n    proxy.dialogObj.hide({\n      returnValue: true\n    });\n  };\n  Image.prototype.insertImage = function (e) {\n    this.imagDialog(e);\n    if (!isNullOrUndefined(this.dialogObj)) {\n      this.dialogObj.element.style.maxHeight = 'inherit';\n      var dialogContent = this.dialogObj.element.querySelector('.e-img-content');\n      if (!isNullOrUndefined(this.parent.insertImageSettings.path) && this.parent.editorMode === 'Markdown' || this.parent.editorMode === 'HTML') {\n        document.getElementById(this.rteID + '_insertImage').focus();\n      } else {\n        dialogContent.querySelector('.e-img-url').focus();\n      }\n    }\n  };\n  Image.prototype.imgUpload = function (e) {\n    var _this = this;\n    var save;\n    var selectParent;\n    // eslint-disable-next-line\n    var proxy = this;\n    var iframe = proxy.parent.iframeSettings.enable;\n    if (proxy.parent.editorMode === 'HTML' && (!iframe && isNullOrUndefined(closest(e.selection.range.startContainer.parentNode, '[id='\n    // eslint-disable-next-line\n    + \"'\" + this.parent.contentModule.getPanel().id + \"'\" + ']')) || iframe && !hasClass(e.selection.range.startContainer.parentNode.ownerDocument.querySelector('body'), 'e-lib'))) {\n      this.contentModule.getEditPanel().focus();\n      var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n      save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n      selectParent = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n    } else {\n      save = e.selection;\n      selectParent = e.selectParent;\n    }\n    var uploadParentEle = this.parent.createElement('div', {\n      className: 'e-img-uploadwrap e-droparea'\n    });\n    var deviceImgUpMsg = this.i10n.getConstant('imageDeviceUploadMessage');\n    var imgUpMsg = this.i10n.getConstant('imageUploadMessage');\n    var span = this.parent.createElement('span', {\n      className: 'e-droptext'\n    });\n    var spanMsg = this.parent.createElement('span', {\n      className: 'e-rte-upload-text',\n      innerHTML: Browser.isDevice ? deviceImgUpMsg : imgUpMsg\n    });\n    span.appendChild(spanMsg);\n    var btnEle = this.parent.createElement('button', {\n      className: 'e-browsebtn',\n      id: this.rteID + '_insertImage',\n      attrs: {\n        autofocus: 'true',\n        type: 'button'\n      }\n    });\n    span.appendChild(btnEle);\n    uploadParentEle.appendChild(span);\n    var browserMsg = this.i10n.getConstant('browse');\n    var button = new Button({\n      content: browserMsg,\n      enableRtl: this.parent.enableRtl\n    });\n    button.isStringTemplate = true;\n    button.createElement = this.parent.createElement;\n    button.appendTo(btnEle);\n    var btnClick = Browser.isDevice ? span : btnEle;\n    EventHandler.add(btnClick, 'click', this.fileSelect, this);\n    var uploadEle = this.parent.createElement('input', {\n      id: this.rteID + '_upload',\n      attrs: {\n        type: 'File',\n        name: 'UploadFiles'\n      }\n    });\n    uploadParentEle.appendChild(uploadEle);\n    var altText;\n    var rawFile;\n    var selectArgs;\n    var filesData;\n    var beforeUploadArgs;\n    this.uploadObj = new Uploader({\n      asyncSettings: {\n        saveUrl: this.parent.insertImageSettings.saveUrl,\n        removeUrl: this.parent.insertImageSettings.removeUrl\n      },\n      dropArea: span,\n      multiple: false,\n      enableRtl: this.parent.enableRtl,\n      allowedExtensions: this.parent.insertImageSettings.allowedTypes.toString(),\n      selected: function (e) {\n        proxy.isImgUploaded = true;\n        selectArgs = e;\n        filesData = e.filesData;\n        if (_this.parent.isServerRendered) {\n          selectArgs = JSON.parse(JSON.stringify(e));\n          e.cancel = true;\n          rawFile = e.filesData;\n          selectArgs.filesData = rawFile;\n        }\n        _this.parent.trigger(events.imageSelected, selectArgs, function (selectArgs) {\n          if (!selectArgs.cancel) {\n            _this.checkExtension(selectArgs.filesData[0]);\n            altText = selectArgs.filesData[0].name;\n            if (_this.parent.editorMode === 'HTML' && isNullOrUndefined(_this.parent.insertImageSettings.path)) {\n              var reader_1 = new FileReader();\n              // eslint-disable-next-line\n              reader_1.addEventListener('load', function (e) {\n                var url = _this.parent.insertImageSettings.saveFormat === 'Base64' ? reader_1.result : URL.createObjectURL(convertToBlob(reader_1.result));\n                proxy.uploadUrl = {\n                  url: url,\n                  selection: save,\n                  altText: altText,\n                  selectParent: selectParent,\n                  width: {\n                    width: proxy.parent.insertImageSettings.width,\n                    minWidth: proxy.parent.insertImageSettings.minWidth,\n                    maxWidth: proxy.parent.getInsertImgMaxWidth()\n                  },\n                  height: {\n                    height: proxy.parent.insertImageSettings.height,\n                    minHeight: proxy.parent.insertImageSettings.minHeight,\n                    maxHeight: proxy.parent.insertImageSettings.maxHeight\n                  }\n                };\n                proxy.inputUrl.setAttribute('disabled', 'true');\n                if (isNullOrUndefined(proxy.parent.insertImageSettings.saveUrl) && _this.isAllowedTypes && !isNullOrUndefined(_this.dialogObj)) {\n                  _this.dialogObj.getButtons(0).element.removeAttribute('disabled');\n                }\n              });\n              reader_1.readAsDataURL(selectArgs.filesData[0].rawFile);\n            }\n            if (_this.parent.isServerRendered) {\n              /* eslint-disable */\n              _this.uploadObj._internalRenderSelect(selectArgs, rawFile);\n              /* eslint-enable */\n            }\n          }\n        });\n      },\n\n      beforeUpload: function (args) {\n        if (_this.parent.isServerRendered) {\n          beforeUploadArgs = JSON.parse(JSON.stringify(args));\n          beforeUploadArgs.filesData = filesData;\n          args.cancel = true;\n          _this.parent.trigger(events.imageUploading, beforeUploadArgs, function (beforeUploadArgs) {\n            if (beforeUploadArgs.cancel) {\n              return;\n            }\n            /* eslint-disable */\n            _this.uploadObj.currentRequestHeader = beforeUploadArgs.currentRequest ? beforeUploadArgs.currentRequest : _this.uploadObj.currentRequestHeader;\n            _this.uploadObj.customFormDatas = beforeUploadArgs.customFormData && beforeUploadArgs.customFormData.length > 0 ? beforeUploadArgs.customFormData : _this.uploadObj.customFormDatas;\n            _this.uploadObj.uploadFiles(rawFile, null);\n            /* eslint-enable */\n          });\n        } else {\n          _this.parent.trigger(events.beforeImageUpload, args);\n        }\n      },\n      uploading: function (e) {\n        if (!_this.parent.isServerRendered) {\n          _this.parent.trigger(events.imageUploading, e);\n        }\n      },\n      success: function (e) {\n        _this.parent.trigger(events.imageUploadSuccess, e, function (e) {\n          if (!isNullOrUndefined(_this.parent.insertImageSettings.path)) {\n            var url = _this.parent.insertImageSettings.path + e.file.name;\n            // eslint-disable-next-line\n            var value = {\n              url: url,\n              selection: save\n            };\n            proxy.uploadUrl = {\n              url: url,\n              selection: save,\n              altText: altText,\n              selectParent: selectParent,\n              width: {\n                width: proxy.parent.insertImageSettings.width,\n                minWidth: proxy.parent.insertImageSettings.minWidth,\n                maxWidth: proxy.parent.getInsertImgMaxWidth()\n              },\n              height: {\n                height: proxy.parent.insertImageSettings.height,\n                minHeight: proxy.parent.insertImageSettings.minHeight,\n                maxHeight: proxy.parent.insertImageSettings.maxHeight\n              }\n            };\n            proxy.inputUrl.setAttribute('disabled', 'true');\n          }\n          if (e.operation === 'upload' && !isNullOrUndefined(_this.dialogObj)) {\n            _this.dialogObj.getButtons(0).element.removeAttribute('disabled');\n          }\n        });\n      },\n      failure: function (e) {\n        _this.parent.trigger(events.imageUploadFailed, e);\n      },\n      removing: function () {\n        // eslint-disable-next-line\n        _this.parent.trigger(events.imageRemoving, e, function (e) {\n          proxy.isImgUploaded = false;\n          _this.dialogObj.getButtons(0).element.disabled = true;\n          proxy.inputUrl.removeAttribute('disabled');\n          if (proxy.uploadUrl) {\n            proxy.uploadUrl.url = '';\n          }\n        });\n      }\n    });\n    this.uploadObj.isStringTemplate = true;\n    this.uploadObj.createElement = this.parent.createElement;\n    this.uploadObj.appendTo(uploadEle);\n    return uploadParentEle;\n  };\n  Image.prototype.checkExtension = function (e) {\n    if (this.uploadObj.allowedExtensions) {\n      if (this.uploadObj.allowedExtensions.toLocaleLowerCase().indexOf(('.' + e.type).toLocaleLowerCase()) === -1) {\n        this.dialogObj.getButtons(0).element.setAttribute('disabled', 'disabled');\n        this.isAllowedTypes = false;\n      } else {\n        this.isAllowedTypes = true;\n      }\n    }\n  };\n  Image.prototype.fileSelect = function () {\n    this.dialogObj.element.getElementsByClassName('e-file-select-wrap')[0].querySelector('button').click();\n    return false;\n  };\n  Image.prototype.dragStart = function (e) {\n    if (e.target.nodeName === 'IMG') {\n      this.parent.trigger(events.actionBegin, e, function (actionBeginArgs) {\n        if (actionBeginArgs.cancel) {\n          e.preventDefault();\n        } else {\n          e.dataTransfer.effectAllowed = 'copyMove';\n          e.target.classList.add(classes.CLS_RTE_DRAG_IMAGE);\n        }\n      });\n    } else {\n      return true;\n    }\n  };\n  Image.prototype.dragEnter = function (e) {\n    e.dataTransfer.dropEffect = 'copy';\n    e.preventDefault();\n  };\n  Image.prototype.dragOver = function (e) {\n    if (Browser.info.name === 'edge' && e.dataTransfer.items[0].type.split('/')[0].indexOf('image') > -1 || Browser.isIE && e.dataTransfer.types[0] === 'Files') {\n      e.preventDefault();\n    } else {\n      return true;\n    }\n  };\n  /**\n   * Used to set range When drop an image\n   *\n   * @param {ImageDropEventArgs} args - specifies the image arguments.\n   * @returns {void}\n   */\n  Image.prototype.dragDrop = function (args) {\n    var _this = this;\n    this.parent.trigger(events.beforeImageDrop, args, function (e) {\n      var imgElement = _this.parent.inputElement.ownerDocument.querySelector('.' + classes.CLS_RTE_DRAG_IMAGE);\n      var isImgOrFileDrop = imgElement && imgElement.tagName === 'IMG' || e.dataTransfer.files.length > 0;\n      if (!e.cancel && isImgOrFileDrop) {\n        _this.parent.trigger(events.actionBegin, e, function (actionBeginArgs) {\n          if (actionBeginArgs.cancel) {\n            e.preventDefault();\n          } else {\n            if (closest(e.target, '#' + _this.parent.getID() + '_toolbar') || _this.parent.inputElement.contentEditable === 'false') {\n              e.preventDefault();\n              return;\n            }\n            if (_this.parent.element.querySelector('.' + classes.CLS_IMG_RESIZE)) {\n              detach(_this.imgResizeDiv);\n            }\n            e.preventDefault();\n            var range = void 0;\n            if (_this.contentModule.getDocument().caretRangeFromPoint) {\n              //For chrome\n              range = _this.contentModule.getDocument().caretRangeFromPoint(e.clientX, e.clientY);\n            } else if (e.rangeParent) {\n              //For mozilla firefox\n              range = _this.contentModule.getDocument().createRange();\n              range.setStart(e.rangeParent, e.rangeOffset);\n            } else {\n              range = _this.getDropRange(e.clientX, e.clientY); //For internet explorer\n            }\n\n            _this.parent.notify(events.selectRange, {\n              range: range\n            });\n            var uploadArea = _this.parent.element.querySelector('.' + classes.CLS_DROPAREA);\n            if (uploadArea) {\n              return;\n            }\n            _this.insertDragImage(e);\n          }\n        });\n      } else {\n        if (isImgOrFileDrop) {\n          e.preventDefault();\n        }\n      }\n    });\n  };\n  /**\n   * Used to calculate range on internet explorer\n   *\n   * @param {number} x - specifies the x range.\n   * @param {number} y - specifies the y range.\n   * @returns {void}\n   */\n  Image.prototype.getDropRange = function (x, y) {\n    var startRange = this.contentModule.getDocument().createRange();\n    this.parent.formatter.editorManager.nodeSelection.setRange(this.contentModule.getDocument(), startRange);\n    var elem = this.contentModule.getDocument().elementFromPoint(x, y);\n    var startNode = elem.childNodes.length > 0 ? elem.childNodes[0] : elem;\n    var startCharIndexCharacter = 0;\n    if (this.parent.inputElement.firstChild.innerHTML === '<br>') {\n      startRange.setStart(startNode, startCharIndexCharacter);\n      startRange.setEnd(startNode, startCharIndexCharacter);\n    } else {\n      var rangeRect = void 0;\n      do {\n        startCharIndexCharacter++;\n        startRange.setStart(startNode, startCharIndexCharacter);\n        startRange.setEnd(startNode, startCharIndexCharacter + 1);\n        rangeRect = startRange.getBoundingClientRect();\n      } while (rangeRect.left < x && startCharIndexCharacter < startNode.length - 1);\n    }\n    return startRange;\n  };\n  Image.prototype.insertDragImage = function (e) {\n    var _this = this;\n    e.preventDefault();\n    var activePopupElement = this.parent.element.querySelector('' + classes.CLS_POPUP_OPEN);\n    this.parent.notify(events.drop, {\n      args: e\n    });\n    if (activePopupElement) {\n      activePopupElement.classList.add(classes.CLS_HIDE);\n    }\n    var imgElement = this.parent.inputElement.ownerDocument.querySelector('.' + classes.CLS_RTE_DRAG_IMAGE);\n    if (e.dataTransfer.files.length > 0 && imgElement === null) {\n      //For external image drag and drop\n      if (e.dataTransfer.files.length > 1) {\n        return;\n      }\n      var imgFiles = e.dataTransfer.files;\n      var fileName = imgFiles[0].name;\n      var imgType = fileName.substring(fileName.lastIndexOf('.'));\n      var allowedTypes = this.parent.insertImageSettings.allowedTypes;\n      for (var i = 0; i < allowedTypes.length; i++) {\n        if (imgType.toLocaleLowerCase() === allowedTypes[i].toLowerCase()) {\n          if (this.parent.insertImageSettings.saveUrl) {\n            this.onSelect(e);\n          } else {\n            var args = {\n              args: e,\n              text: '',\n              file: imgFiles[0]\n            };\n            e.preventDefault();\n            this.imagePaste(args);\n          }\n        }\n      }\n    } else {\n      //For internal image drag and drop\n      var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n      if (imgElement && imgElement.tagName === 'IMG') {\n        if (imgElement.nextElementSibling) {\n          if (imgElement.nextElementSibling.classList.contains(classes.CLS_IMG_INNER)) {\n            range.insertNode(imgElement.parentElement.parentElement);\n          } else {\n            range.insertNode(imgElement);\n          }\n        } else {\n          range.insertNode(imgElement);\n        }\n        imgElement.classList.remove(classes.CLS_RTE_DRAG_IMAGE);\n        var imgArgs_1 = {\n          elements: [imgElement]\n        };\n        imgElement.addEventListener('load', function () {\n          _this.parent.trigger(events.actionComplete, imgArgs_1);\n        });\n        this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument());\n        var args = e;\n        this.resizeStart(args, imgElement);\n        this.hideImageQuickToolbar();\n      }\n    }\n  };\n  Image.prototype.onSelect = function (args) {\n    var _this = this;\n    // eslint-disable-next-line\n    var proxy = this;\n    var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n    var parentElement = this.parent.createElement('ul', {\n      className: classes.CLS_UPLOAD_FILES\n    });\n    this.parent.element.appendChild(parentElement);\n    var validFiles = {\n      name: '',\n      size: 0,\n      status: '',\n      statusCode: '',\n      type: '',\n      rawFile: args.dataTransfer.files[0],\n      validationMessages: {}\n    };\n    var imageTag = this.parent.createElement('IMG');\n    imageTag.style.opacity = '0.5';\n    imageTag.classList.add(classes.CLS_RTE_IMAGE);\n    imageTag.classList.add(classes.CLS_IMGINLINE);\n    imageTag.classList.add(classes.CLS_RESIZE);\n    var file = validFiles.rawFile;\n    var reader = new FileReader();\n    reader.addEventListener('load', function () {\n      var url = URL.createObjectURL(convertToBlob(reader.result));\n      imageTag.src = proxy.parent.insertImageSettings.saveFormat === 'Blob' ? url : reader.result;\n    });\n    if (file) {\n      reader.readAsDataURL(file);\n    }\n    range.insertNode(imageTag);\n    this.uploadMethod(args, imageTag);\n    var e = {\n      elements: [imageTag]\n    };\n    imageTag.addEventListener('load', function () {\n      _this.parent.trigger(events.actionComplete, e);\n    });\n    detach(parentElement);\n  };\n  /**\n   * Rendering uploader and popup for drag and drop\n   *\n   * @param {DragEvent} dragEvent - specifies the event.\n   * @param {HTMLImageElement} imageElement - specifies the element.\n   * @returns {void}\n   */\n  Image.prototype.uploadMethod = function (dragEvent, imageElement) {\n    var _this = this;\n    var isUploading = false;\n    // eslint-disable-next-line\n    var proxy = this;\n    var popupEle = this.parent.createElement('div');\n    this.parent.element.appendChild(popupEle);\n    var uploadEle = this.parent.createElement('input', {\n      id: this.rteID + '_upload',\n      attrs: {\n        type: 'File',\n        name: 'UploadFiles'\n      }\n    });\n    var offsetY = this.parent.iframeSettings.enable ? -50 : -90;\n    this.popupObj = new Popup(popupEle, {\n      relateTo: imageElement,\n      height: '85px',\n      width: '300px',\n      offsetY: offsetY,\n      content: uploadEle,\n      viewPortElement: this.parent.element,\n      position: {\n        X: 'center',\n        Y: 'top'\n      },\n      enableRtl: this.parent.enableRtl,\n      zIndex: 10001,\n      // eslint-disable-next-line\n      close: function (event) {\n        _this.parent.isBlur = false;\n        _this.popupObj.destroy();\n        detach(_this.popupObj.element);\n        _this.popupObj = null;\n        if (!_this.parent.inlineMode.enable) {\n          _this.parent.toolbarModule.baseToolbar.toolbarObj.disable(false);\n        }\n      }\n    });\n    this.popupObj.element.style.display = 'none';\n    addClass([this.popupObj.element], classes.CLS_POPUP_OPEN);\n    addClass([this.popupObj.element], classes.CLS_RTE_UPLOAD_POPUP);\n    var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n    var timeOut = dragEvent.dataTransfer.files[0].size > 1000000 ? 300 : 100;\n    setTimeout(function () {\n      proxy.refreshPopup(imageElement);\n    }, timeOut);\n    var rawFile;\n    var beforeUploadArgs;\n    this.uploadObj = new Uploader({\n      asyncSettings: {\n        saveUrl: this.parent.insertImageSettings.saveUrl,\n        removeUrl: this.parent.insertImageSettings.removeUrl\n      },\n      cssClass: classes.CLS_RTE_DIALOG_UPLOAD,\n      dropArea: this.parent.element,\n      allowedExtensions: this.parent.insertImageSettings.allowedTypes.toString(),\n      removing: function () {\n        _this.parent.inputElement.contentEditable = 'true';\n        isUploading = false;\n        detach(imageElement);\n        _this.popupObj.close();\n      },\n      canceling: function () {\n        _this.parent.inputElement.contentEditable = 'true';\n        isUploading = false;\n        detach(imageElement);\n        _this.popupObj.close();\n        _this.quickToolObj.imageQTBar.hidePopup();\n        setTimeout(function () {\n          _this.uploadObj.destroy();\n        }, 900);\n      },\n      beforeUpload: function (args) {\n        if (_this.parent.isServerRendered) {\n          beforeUploadArgs = JSON.parse(JSON.stringify(args));\n          beforeUploadArgs.filesData = rawFile;\n          isUploading = true;\n          args.cancel = true;\n          _this.parent.trigger(events.imageUploading, beforeUploadArgs, function (beforeUploadArgs) {\n            if (beforeUploadArgs.cancel) {\n              return;\n            }\n            if (!_this.parent.inlineMode.enable) {\n              _this.parent.toolbarModule.baseToolbar.toolbarObj.disable(true);\n            }\n            /* eslint-disable */\n            _this.uploadObj.currentRequestHeader = beforeUploadArgs.currentRequest ? beforeUploadArgs.currentRequest : _this.uploadObj.currentRequestHeader;\n            _this.uploadObj.customFormDatas = beforeUploadArgs.customFormData && beforeUploadArgs.customFormData.length > 0 ? beforeUploadArgs.customFormData : _this.uploadObj.customFormDatas;\n            _this.uploadObj.uploadFiles(rawFile, null);\n            _this.parent.inputElement.contentEditable = 'false';\n            /* eslint-enable */\n          });\n        } else {\n          _this.parent.trigger(events.beforeImageUpload, args);\n          if (!_this.parent.inlineMode.enable) {\n            _this.parent.toolbarModule.baseToolbar.toolbarObj.disable(true);\n          }\n        }\n      },\n      uploading: function (e) {\n        if (!_this.parent.isServerRendered) {\n          isUploading = true;\n          _this.parent.trigger(events.imageUploading, e, function (imageUploadingArgs) {\n            if (imageUploadingArgs.cancel) {\n              if (!isNullOrUndefined(imageElement)) {\n                detach(imageElement);\n              }\n              if (!isNullOrUndefined(_this.popupObj.element)) {\n                detach(_this.popupObj.element);\n              }\n            } else {\n              _this.parent.inputElement.contentEditable = 'false';\n            }\n          });\n        }\n      },\n      selected: function (e) {\n        if (isUploading) {\n          e.cancel = true;\n        }\n        if (_this.parent.isServerRendered) {\n          rawFile = e.filesData;\n        }\n      },\n      failure: function (e) {\n        isUploading = false;\n        _this.parent.inputElement.contentEditable = 'true';\n        var args = {\n          args: dragEvent,\n          type: 'Images',\n          isNotify: undefined,\n          elements: imageElement\n        };\n        setTimeout(function () {\n          _this.uploadFailure(imageElement, args, e);\n        }, 900);\n      },\n      success: function (e) {\n        if (e.operation === \"cancel\") {\n          return;\n        }\n        isUploading = false;\n        _this.parent.inputElement.contentEditable = 'true';\n        var args = {\n          args: dragEvent,\n          type: 'Images',\n          isNotify: undefined,\n          elements: imageElement\n        };\n        setTimeout(function () {\n          _this.uploadSuccess(imageElement, dragEvent, args, e);\n        }, 900);\n      }\n    });\n    this.uploadObj.appendTo(this.popupObj.element.childNodes[0]);\n    this.popupObj.element.querySelector('.e-rte-dialog-upload .e-file-select-wrap').style.display = 'none';\n    range.selectNodeContents(imageElement);\n    this.parent.formatter.editorManager.nodeSelection.setRange(this.contentModule.getDocument(), range);\n  };\n  Image.prototype.refreshPopup = function (imageElement) {\n    var imgPosition = this.parent.iframeSettings.enable ? this.parent.element.offsetTop + imageElement.offsetTop : imageElement.offsetTop;\n    var rtePosition = this.parent.element.offsetTop + this.parent.element.offsetHeight;\n    if (imgPosition > rtePosition) {\n      this.popupObj.relateTo = this.parent.inputElement;\n      this.popupObj.offsetY = this.parent.iframeSettings.enable ? -30 : -65;\n      this.popupObj.element.style.display = 'block';\n    } else {\n      if (this.popupObj) {\n        this.popupObj.refreshPosition(imageElement);\n        this.popupObj.element.style.display = 'block';\n      }\n    }\n  };\n  /**\n   * Called when drop image upload was failed\n   *\n   * @param {HTMLElement} imgEle - specifies the image element.\n   * @param {IShowPopupArgs} args - specifies the arguments.\n   * @param {Object} e - specfies the object.\n   * @returns {void}\n   */\n  Image.prototype.uploadFailure = function (imgEle, args, e) {\n    detach(imgEle);\n    if (this.popupObj) {\n      this.popupObj.close();\n    }\n    this.parent.trigger(events.imageUploadFailed, e);\n    this.uploadObj.destroy();\n  };\n  /**\n   * Called when drop image upload was successful\n   *\n   * @param {HTMLElement} imageElement - specifies the image element.\n   * @param {DragEvent} dragEvent - specifies the drag event.\n   * @param {IShowPopupArgs} args - specifies the arguments.\n   * @param {ImageSuccessEventArgs} e - specifies the success event.\n   * @returns {void}\n   */\n  Image.prototype.uploadSuccess = function (imageElement, dragEvent, args, e) {\n    var _this = this;\n    imageElement.style.opacity = '1';\n    imageElement.classList.add(classes.CLS_IMG_FOCUS);\n    e.element = imageElement;\n    this.parent.trigger(events.imageUploadSuccess, e, function (e) {\n      if (!isNullOrUndefined(_this.parent.insertImageSettings.path)) {\n        var url = _this.parent.insertImageSettings.path + e.file.name;\n        imageElement.src = url;\n        imageElement.setAttribute('alt', e.file.name);\n      }\n    });\n    if (this.popupObj) {\n      this.popupObj.close();\n      this.uploadObj.destroy();\n    }\n    this.showImageQuickToolbar(args);\n    this.resizeStart(dragEvent, imageElement);\n  };\n  Image.prototype.imagePaste = function (args) {\n    var _this = this;\n    if (args.text.length === 0 && !isNullOrUndefined(args.file)) {\n      // eslint-disable-next-line\n      var proxy_1 = this;\n      var reader_2 = new FileReader();\n      args.args.preventDefault();\n      // eslint-disable-next-line\n      reader_2.addEventListener('load', function (e) {\n        var url = {\n          cssClass: proxy_1.parent.insertImageSettings.display === 'inline' ? classes.CLS_IMGINLINE : classes.CLS_IMGBREAK,\n          url: _this.parent.insertImageSettings.saveFormat === 'Base64' || !isNullOrUndefined(args.callBack) ? reader_2.result : URL.createObjectURL(convertToBlob(reader_2.result)),\n          width: {\n            width: proxy_1.parent.insertImageSettings.width,\n            minWidth: proxy_1.parent.insertImageSettings.minWidth,\n            maxWidth: proxy_1.parent.getInsertImgMaxWidth()\n          },\n          height: {\n            height: proxy_1.parent.insertImageSettings.height,\n            minHeight: proxy_1.parent.insertImageSettings.minHeight,\n            maxHeight: proxy_1.parent.insertImageSettings.maxHeight\n          }\n        };\n        if (!isNullOrUndefined(args.callBack)) {\n          args.callBack(url);\n          return;\n        } else {\n          proxy_1.parent.formatter.process(proxy_1.parent, {\n            item: {\n              command: 'Images',\n              subCommand: 'Image'\n            }\n          }, args.args, url);\n          _this.showPopupToolBar(args, url);\n        }\n      });\n      reader_2.readAsDataURL(args.file);\n    }\n  };\n  Image.prototype.showPopupToolBar = function (e, url) {\n    var _this = this;\n    var imageSrc = 'img[src=\"' + url.url + '\"]';\n    var imageElement = this.parent.inputElement.querySelector(imageSrc);\n    this.parent.quickToolbarModule.createQTBar('Image', 'MultiRow', this.parent.quickToolbarSettings.image, RenderType.ImageToolbar);\n    var args = {\n      args: e.args,\n      type: 'Images',\n      isNotify: undefined,\n      elements: imageElement\n    };\n    if (imageElement) {\n      setTimeout(function () {\n        _this.showImageQuickToolbar(args);\n        _this.resizeStart(e.args, imageElement);\n      }, 0);\n    }\n  };\n  /* eslint-disable */\n  /**\n   * Destroys the ToolBar.\n   *\n   * @method destroy\n   * @returns {void}\n   * @hidden\n    */\n  /* eslint-enable */\n  Image.prototype.destroy = function () {\n    this.prevSelectedImgEle = undefined;\n    this.removeEventListener();\n  };\n  /**\n   * For internal use only - Get the module name.\n   *\n   * @returns {void}\n   */\n  Image.prototype.getModuleName = function () {\n    return 'image';\n  };\n  return Image;\n}();\nexport { Image };","map":{"version":3,"names":["addClass","detach","EventHandler","isNullOrUndefined","select","Ajax","formatUnit","Browser","closest","removeClass","isNOU","events","classes","Uploader","TextBox","Popup","Button","CheckBox","RenderType","dispatchEvent","parseHtml","hasClass","convertToBlob","isIDevice","Image","parent","serviceLocator","isImgUploaded","isAllowedTypes","pageX","pageY","deletedImg","rteID","element","id","i10n","getService","rendererFactory","dialogRenderObj","addEventListener","prototype","isDestroyed","on","keyDown","onKeyDown","keyUp","onKeyUp","insertImage","showImageDialog","showDialog","closeImageDialog","closeDialog","windowResize","onWindowResize","insertCompleted","showImageQuickToolbar","clearDialogObj","imageToolbarAction","onToolbarAction","imageCaption","caption","imageDelete","deleteImg","imageLink","insertImgLink","imageAlt","insertAltText","editAreaClick","editAreaClickHandler","iframeMouseDown","onIframeMouseDown","imageSize","dropDownSelect","alignmentSelect","initialEnd","afterRender","dynamicModule","paste","imagePaste","destroy","removeEventListener","off","dropElement","iframeSettings","enable","inputElement","ownerDocument","dragDrop","bind","dragStart","dragEnter","dragOver","contentModule","remove","getEditPanel","touchEndEvent","imageClick","formatter","editorManager","observer","checkUndo","undoStack","insertImageSettings","resize","touchStartEvent","resizeStart","onDocumentClick","onCutHandler","dialogObj","hide","returnValue","getRenderer","Content","add","args","subCommand","toLowerCase","i","getUndoRedoStack","length","temp","createElement","contentElem","text","appendChild","img","querySelectorAll","querySelector","j","style","outline","innerHTML","resizeEnd","e","resizeBtnInit","imgEle","parentElement","cursor","isDevice","target","event","requestType","trigger","resizeStop","getPointX","window","pageYOffset","getBoundingClientRect","top","clientY","saveData","ele","_this","readonly","prevSelectedImgEle","tagName","preventDefaultResize","imgResizeDiv","contains","imageResize","classList","getPointY","preventDefault","stopImmediatePropagation","quickToolObj","imageQTBar","hidePopup","resizeBtnStat","topLeft","topRight","botLeft","botRight","resizeStartArgs","cancel","cancelResizeAction","getDocument","setAttribute","focus","className","styles","imgResizePos","resizeImgDupPos","touchMoveEvent","resizing","touches","pos","calcPos","left","imgWid","width","imgHgt","height","borWid","parseInt","slice","devWid","elem","ignoreOffset","parentOffset","doc","offsetParent","indexOf","getID","documentElement","body","position","parentNode","nodeType","offsetTop","offsetLeft","setAspectRatio","expectedX","expectedY","match","parseFloat","minWidth","resizeByPercent","percentageValue","pixToPerc","previousElementSibling","Math","min","round","removeAttribute","currentWidth","right","toString","expected","parentEle","getComputedStyle","imgDupMouseMove","onResize","resizingArgs","getInsertImgMaxWidth","minHeight","maxHeight","setContentHeight","offsetWidth","offsetHeight","mouseX","mouseY","imgDupPos","notify","selectionRestore","item","fileManagerSettings","renderFileManager","openImgLink","editImgLink","removeImgLink","selectParent","process","url","href","selectNode","selectParentEle","linkUpdate","getConstant","inputDetails","header","btnText","isIE","selection","restore","isCapLink","captionEle","insertElement","document","originalEvent","range","save","selectNodeEle","isCursor","keyCodeValues","editorMode","nodeSelection","getRange","startContainer","endContainer","startOffset","endOffset","which","nodes","getNodeCollection","nodeName","push","code","isCursor_1","checkImageBack","checkImageDel","getParentNodeCollection","ctrlKey","key","action","prev","childNodes","removeResizeEle","setSelectionText","textContent","keyCode","event_1","command","close","src","imageRemovePost","CLS_CAPTION","CLS_CAPINLINE","nextElementSibling","openDialog","isInternal","member","markdownSelection","getSelectedText","module","name","getAttribute","afterImageDelete","previousSibling","nextSibling","alignImage","inline","break","imageWithLinkQTBarItemUpdate","separator","items","toolbarElement","display","newItems","addQTBarItem","type","quickToolbarModule","elements","forEach","call","index","isNotify","setTimeout","showPopup","hideImageQuickToolbar","showOnRightClick","quickToolbarSettings","Clear","setSelectionContents","isPopupOpen","selectionSave","imagDialog","linkWrap","linkUrl","content","linkTarget","inputLink","linkOpenLabel","checkBoxObj","label","checked","enableRtl","change","target_1","isStringTemplate","appendTo","linkargs_1","selfImage","link","setProperties","localeObj","X","Y","buttons","click","insertlink","buttonModel","cssClass","isPrimary","value","altText","altWrap","altHeader","getAlt","inputAlt","altArgs_1","alt","insertAlt","setSelectionRange","isUrl","proxy","regexp","test","captionClass","absoluteUrl","removeUrl","URL","baseURI","removingImgName","replace","xhr","XMLHttpRequest","readyState","status","triggerPost","response","open","responseType","send","file","File","ajax","formData","FormData","append","CLS_RTE_CAPTION","attrs","contenteditable","draggable","imgWrap","imgInner","parent_1","imgCaption","CLS_IMGINLINE","CLS_IMGBREAK","CLS_IMGLEFT","CLS_IMGRIGHT","CLS_IMGCENTER","imgSizeHeader","dialogContent","imgsizeInput","selectObj_1","insertSize","imgDialog","imgInsert","imglinkCancel","imgHeader","selectObj","dialogModel","CLS_RTE_ELEMENTS","locale","showCloseIcon","closeOnEscape","isModal","insertImageUrl","disabled","cancelDialog","animationSettings","effect","uploadObj","removing","isBlur","path","imgUpload","linkHeader","linkHeaderText","imageUrlPopup","render","inlineQTBar","toolbarSettings","getToolbarElement","offsetX","clientWidth","offsetY","clientHeight","imgUrl","placeUrl","inputUrl","placeholder","spellcheck","getButtons","uploadUrl","getPanel","regex","matchUrl","maxWidth","imgHeight","imgWidth","imgSizeWrap","widthVal","changedWidthValue","getClientRects","heightVal","changedHeightValue","widthNum","input","inputWidthValue","inputValue","heightNum","inputHeightValue","dialogEle","getElementById","iframe","uploadParentEle","deviceImgUpMsg","imgUpMsg","span","spanMsg","btnEle","autofocus","browserMsg","button","btnClick","fileSelect","uploadEle","rawFile","selectArgs","filesData","beforeUploadArgs","asyncSettings","saveUrl","dropArea","multiple","allowedExtensions","allowedTypes","selected","isServerRendered","JSON","parse","stringify","imageSelected","checkExtension","reader_1","FileReader","saveFormat","result","createObjectURL","readAsDataURL","_internalRenderSelect","beforeUpload","imageUploading","currentRequestHeader","currentRequest","customFormDatas","customFormData","uploadFiles","beforeImageUpload","uploading","success","imageUploadSuccess","operation","failure","imageUploadFailed","imageRemoving","toLocaleLowerCase","getElementsByClassName","actionBegin","actionBeginArgs","dataTransfer","effectAllowed","CLS_RTE_DRAG_IMAGE","dropEffect","info","split","types","beforeImageDrop","imgElement","isImgOrFileDrop","files","contentEditable","CLS_IMG_RESIZE","caretRangeFromPoint","clientX","rangeParent","createRange","setStart","rangeOffset","getDropRange","selectRange","uploadArea","CLS_DROPAREA","insertDragImage","x","y","startRange","setRange","elementFromPoint","startNode","startCharIndexCharacter","firstChild","setEnd","rangeRect","activePopupElement","CLS_POPUP_OPEN","drop","CLS_HIDE","imgFiles","fileName","imgType","substring","lastIndexOf","onSelect","CLS_IMG_INNER","insertNode","imgArgs_1","actionComplete","CLS_UPLOAD_FILES","validFiles","size","statusCode","validationMessages","imageTag","opacity","CLS_RTE_IMAGE","CLS_RESIZE","reader","uploadMethod","dragEvent","imageElement","isUploading","popupEle","popupObj","relateTo","viewPortElement","zIndex","inlineMode","toolbarModule","baseToolbar","toolbarObj","disable","CLS_RTE_UPLOAD_POPUP","timeOut","refreshPopup","CLS_RTE_DIALOG_UPLOAD","canceling","imageUploadingArgs","undefined","uploadFailure","uploadSuccess","selectNodeContents","imgPosition","rtePosition","refreshPosition","CLS_IMG_FOCUS","proxy_1","reader_2","callBack","showPopupToolBar","imageSrc","createQTBar","image","ImageToolbar","getModuleName"],"sources":["D:/USPERSO IMPLEMENTATION/Projet_DevIII/frontend/node_modules/@syncfusion/ej2-richtexteditor/src/rich-text-editor/renderer/image-module.js"],"sourcesContent":["import { addClass, detach, EventHandler, isNullOrUndefined, select, Ajax, formatUnit } from '@syncfusion/ej2-base';\nimport { Browser, closest, removeClass, isNullOrUndefined as isNOU } from '@syncfusion/ej2-base';\nimport * as events from '../base/constant';\nimport * as classes from '../base/classes';\nimport { Uploader, TextBox } from '@syncfusion/ej2-inputs';\nimport { Popup } from '@syncfusion/ej2-popups';\nimport { Button, CheckBox } from '@syncfusion/ej2-buttons';\nimport { RenderType } from '../base/enum';\nimport { dispatchEvent, parseHtml, hasClass, convertToBlob } from '../base/util';\nimport { isIDevice } from '../../common/util';\n/**\n * `Image` module is used to handle image actions.\n */\nvar Image = /** @class */ (function () {\n    function Image(parent, serviceLocator) {\n        this.isImgUploaded = false;\n        this.isAllowedTypes = true;\n        this.pageX = null;\n        this.pageY = null;\n        this.deletedImg = [];\n        this.parent = parent;\n        this.rteID = parent.element.id;\n        this.i10n = serviceLocator.getService('rteLocale');\n        this.rendererFactory = serviceLocator.getService('rendererFactory');\n        this.dialogRenderObj = serviceLocator.getService('dialogRenderObject');\n        this.addEventListener();\n    }\n    Image.prototype.addEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.on(events.keyDown, this.onKeyDown, this);\n        this.parent.on(events.keyUp, this.onKeyUp, this);\n        this.parent.on(events.insertImage, this.insertImage, this);\n        this.parent.on(events.showImageDialog, this.showDialog, this);\n        this.parent.on(events.closeImageDialog, this.closeDialog, this);\n        this.parent.on(events.windowResize, this.onWindowResize, this);\n        this.parent.on(events.insertCompleted, this.showImageQuickToolbar, this);\n        this.parent.on(events.clearDialogObj, this.clearDialogObj, this);\n        this.parent.on(events.imageToolbarAction, this.onToolbarAction, this);\n        this.parent.on(events.imageCaption, this.caption, this);\n        this.parent.on(events.imageDelete, this.deleteImg, this);\n        this.parent.on(events.imageLink, this.insertImgLink, this);\n        this.parent.on(events.imageAlt, this.insertAltText, this);\n        this.parent.on(events.editAreaClick, this.editAreaClickHandler, this);\n        this.parent.on(events.iframeMouseDown, this.onIframeMouseDown, this);\n        this.parent.on(events.imageSize, this.imageSize, this);\n        this.parent.on(events.dropDownSelect, this.alignmentSelect, this);\n        this.parent.on(events.initialEnd, this.afterRender, this);\n        this.parent.on(events.dynamicModule, this.afterRender, this);\n        this.parent.on(events.paste, this.imagePaste, this);\n        this.parent.on(events.destroy, this.removeEventListener, this);\n    };\n    Image.prototype.removeEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.off(events.keyDown, this.onKeyDown);\n        this.parent.off(events.keyUp, this.onKeyUp);\n        this.parent.off(events.windowResize, this.onWindowResize);\n        this.parent.off(events.insertImage, this.insertImage);\n        this.parent.off(events.showImageDialog, this.showDialog);\n        this.parent.off(events.closeImageDialog, this.closeDialog);\n        this.parent.off(events.insertCompleted, this.showImageQuickToolbar);\n        this.parent.off(events.clearDialogObj, this.clearDialogObj);\n        this.parent.off(events.imageCaption, this.caption);\n        this.parent.off(events.imageToolbarAction, this.onToolbarAction);\n        this.parent.off(events.imageDelete, this.deleteImg);\n        this.parent.off(events.imageLink, this.insertImgLink);\n        this.parent.off(events.imageAlt, this.insertAltText);\n        this.parent.off(events.editAreaClick, this.editAreaClickHandler);\n        this.parent.off(events.iframeMouseDown, this.onIframeMouseDown);\n        this.parent.off(events.imageSize, this.imageSize);\n        this.parent.off(events.dropDownSelect, this.alignmentSelect);\n        this.parent.off(events.initialEnd, this.afterRender);\n        this.parent.off(events.dynamicModule, this.afterRender);\n        this.parent.off(events.paste, this.imagePaste);\n        this.parent.off(events.destroy, this.removeEventListener);\n        var dropElement = this.parent.iframeSettings.enable ? this.parent.inputElement.ownerDocument\n            : this.parent.inputElement;\n        dropElement.removeEventListener('drop', this.dragDrop.bind(this), true);\n        dropElement.removeEventListener('dragstart', this.dragStart.bind(this), true);\n        dropElement.removeEventListener('dragenter', this.dragEnter.bind(this), true);\n        dropElement.removeEventListener('dragover', this.dragOver.bind(this), true);\n        if (!isNullOrUndefined(this.contentModule)) {\n            EventHandler.remove(this.contentModule.getEditPanel(), Browser.touchEndEvent, this.imageClick);\n            this.parent.formatter.editorManager.observer.off(events.checkUndo, this.undoStack);\n            if (this.parent.insertImageSettings.resize) {\n                EventHandler.remove(this.parent.contentModule.getEditPanel(), Browser.touchStartEvent, this.resizeStart);\n                EventHandler.remove(this.parent.element.ownerDocument, 'mousedown', this.onDocumentClick);\n                EventHandler.remove(this.contentModule.getEditPanel(), 'cut', this.onCutHandler);\n            }\n        }\n    };\n    Image.prototype.onIframeMouseDown = function () {\n        if (this.dialogObj) {\n            this.dialogObj.hide({ returnValue: true });\n        }\n    };\n    Image.prototype.afterRender = function () {\n        this.contentModule = this.rendererFactory.getRenderer(RenderType.Content);\n        EventHandler.add(this.contentModule.getEditPanel(), Browser.touchEndEvent, this.imageClick, this);\n        if (this.parent.insertImageSettings.resize) {\n            EventHandler.add(this.parent.contentModule.getEditPanel(), Browser.touchStartEvent, this.resizeStart, this);\n            EventHandler.add(this.parent.element.ownerDocument, 'mousedown', this.onDocumentClick, this);\n            EventHandler.add(this.contentModule.getEditPanel(), 'cut', this.onCutHandler, this);\n        }\n        var dropElement = this.parent.iframeSettings.enable ? this.parent.inputElement.ownerDocument :\n            this.parent.inputElement;\n        dropElement.addEventListener('drop', this.dragDrop.bind(this), true);\n        dropElement.addEventListener('dragstart', this.dragStart.bind(this), true);\n        dropElement.addEventListener('dragenter', this.dragOver.bind(this), true);\n        dropElement.addEventListener('dragover', this.dragOver.bind(this), true);\n    };\n    Image.prototype.undoStack = function (args) {\n        if (args.subCommand.toLowerCase() === 'undo' || args.subCommand.toLowerCase() === 'redo') {\n            for (var i = 0; i < this.parent.formatter.getUndoRedoStack().length; i++) {\n                var temp = this.parent.createElement('div');\n                var contentElem = parseHtml(this.parent.formatter.getUndoRedoStack()[i].text);\n                temp.appendChild(contentElem);\n                var img = temp.querySelectorAll('img');\n                if (temp.querySelector('.e-img-resize') && img.length > 0) {\n                    for (var j = 0; j < img.length; j++) {\n                        img[j].style.outline = '';\n                    }\n                    detach(temp.querySelector('.e-img-resize'));\n                    this.parent.formatter.getUndoRedoStack()[i].text = temp.innerHTML;\n                }\n            }\n        }\n    };\n    Image.prototype.resizeEnd = function (e) {\n        this.resizeBtnInit();\n        this.imgEle.parentElement.style.cursor = 'auto';\n        if (Browser.isDevice) {\n            removeClass([e.target.parentElement], 'e-mob-span');\n        }\n        var args = { event: e, requestType: 'images' };\n        this.parent.trigger(events.resizeStop, args);\n        /* eslint-disable */\n        var pageX = this.getPointX(e);\n        var pageY = (this.parent.iframeSettings.enable) ? window.pageYOffset +\n            this.parent.element.getBoundingClientRect().top + e.clientY : e.pageY;\n        /* eslint-enable */\n        this.parent.formatter.editorManager.observer.on(events.checkUndo, this.undoStack, this);\n        this.parent.formatter.saveData();\n    };\n    Image.prototype.resizeStart = function (e, ele) {\n        var _this = this;\n        if (this.parent.readonly) {\n            return;\n        }\n        var target = ele ? ele : e.target;\n        this.prevSelectedImgEle = this.imgEle;\n        if (target.tagName === 'IMG') {\n            this.parent.preventDefaultResize(e);\n            var img = target;\n            if (this.imgResizeDiv && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n                detach(this.imgResizeDiv);\n            }\n            this.imageResize(img);\n        }\n        if (target.classList.contains('e-rte-imageboxmark')) {\n            if (this.parent.formatter.getUndoRedoStack().length === 0) {\n                this.parent.formatter.saveData();\n            }\n            this.pageX = this.getPointX(e);\n            this.pageY = this.getPointY(e);\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            this.resizeBtnInit();\n            if (this.quickToolObj) {\n                this.quickToolObj.imageQTBar.hidePopup();\n            }\n            if (target.classList.contains('e-rte-topLeft')) {\n                this.resizeBtnStat.topLeft = true;\n            }\n            if (target.classList.contains('e-rte-topRight')) {\n                this.resizeBtnStat.topRight = true;\n            }\n            if (target.classList.contains('e-rte-botLeft')) {\n                this.resizeBtnStat.botLeft = true;\n            }\n            if (target.classList.contains('e-rte-botRight')) {\n                this.resizeBtnStat.botRight = true;\n            }\n            if (Browser.isDevice && this.contentModule.getEditPanel().contains(this.imgResizeDiv) &&\n                !this.imgResizeDiv.classList.contains('e-mob-span')) {\n                addClass([this.imgResizeDiv], 'e-mob-span');\n            }\n            else {\n                var args = { event: e, requestType: 'images' };\n                this.parent.trigger(events.resizeStart, args, function (resizeStartArgs) {\n                    if (resizeStartArgs.cancel) {\n                        _this.cancelResizeAction();\n                    }\n                });\n            }\n            EventHandler.add(this.contentModule.getDocument(), Browser.touchEndEvent, this.resizeEnd, this);\n        }\n    };\n    Image.prototype.imageClick = function (e) {\n        if (Browser.isDevice) {\n            if ((e.target.tagName === 'IMG' &&\n                e.target.parentElement.tagName === 'A') ||\n                (e.target.tagName === 'IMG')) {\n                this.contentModule.getEditPanel().setAttribute('contenteditable', 'false');\n                e.target.focus();\n            }\n            else {\n                if (!this.parent.readonly) {\n                    this.contentModule.getEditPanel().setAttribute('contenteditable', 'true');\n                }\n            }\n        }\n        if (e.target.tagName === 'IMG' &&\n            e.target.parentElement.tagName === 'A') {\n            e.preventDefault();\n        }\n    };\n    Image.prototype.onCutHandler = function () {\n        if (this.imgResizeDiv && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n            this.cancelResizeAction();\n        }\n    };\n    Image.prototype.imageResize = function (e) {\n        this.resizeBtnInit();\n        this.imgEle = e;\n        addClass([this.imgEle], 'e-resize');\n        this.imgResizeDiv = this.parent.createElement('span', { className: 'e-img-resize', id: this.rteID + '_imgResize' });\n        this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n            className: 'e-rte-imageboxmark e-rte-topLeft', styles: 'cursor: nwse-resize'\n        }));\n        this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n            className: 'e-rte-imageboxmark e-rte-topRight', styles: 'cursor: nesw-resize'\n        }));\n        this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n            className: 'e-rte-imageboxmark e-rte-botLeft', styles: 'cursor: nesw-resize'\n        }));\n        this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n            className: 'e-rte-imageboxmark e-rte-botRight', styles: 'cursor: nwse-resize'\n        }));\n        if (Browser.isDevice) {\n            addClass([this.imgResizeDiv], 'e-mob-rte');\n        }\n        e.style.outline = '2px solid #4a90e2';\n        this.imgResizePos(e, this.imgResizeDiv);\n        this.resizeImgDupPos(e);\n        this.contentModule.getEditPanel().appendChild(this.imgResizeDiv);\n        EventHandler.add(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing, this);\n    };\n    Image.prototype.getPointX = function (e) {\n        if (e.touches && e.touches.length) {\n            return e.touches[0].pageX;\n        }\n        else {\n            return e.pageX;\n        }\n    };\n    Image.prototype.getPointY = function (e) {\n        if (e.touches && e.touches.length) {\n            return e.touches[0].pageY;\n        }\n        else {\n            return e.pageY;\n        }\n    };\n    Image.prototype.imgResizePos = function (e, imgResizeDiv) {\n        var pos = this.calcPos(e);\n        var top = pos.top;\n        var left = pos.left;\n        var imgWid = e.width;\n        var imgHgt = e.height;\n        var borWid = (Browser.isDevice) ? (4 * parseInt((e.style.outline.slice(-3)), 10)) + 2 :\n            (2 * parseInt((e.style.outline.slice(-3)), 10)) + 2; //span border width + image outline width\n        var devWid = ((Browser.isDevice) ? 0 : 2); // span border width\n        imgResizeDiv.querySelector('.e-rte-botLeft').style.left = (left - borWid) + 'px';\n        imgResizeDiv.querySelector('.e-rte-botLeft').style.top = ((imgHgt - borWid) + top) + 'px';\n        imgResizeDiv.querySelector('.e-rte-botRight').style.left = ((imgWid - (borWid - devWid)) + left) + 'px';\n        imgResizeDiv.querySelector('.e-rte-botRight').style.top = ((imgHgt - borWid) + top) + 'px';\n        imgResizeDiv.querySelector('.e-rte-topRight').style.left = ((imgWid - (borWid - devWid)) + left) + 'px';\n        imgResizeDiv.querySelector('.e-rte-topRight').style.top = (top - (borWid)) + 'px';\n        imgResizeDiv.querySelector('.e-rte-topLeft').style.left = (left - borWid) + 'px';\n        imgResizeDiv.querySelector('.e-rte-topLeft').style.top = (top - borWid) + 'px';\n    };\n    Image.prototype.calcPos = function (elem) {\n        var ignoreOffset = ['TD', 'TH', 'TABLE', 'A'];\n        var parentOffset = { top: 0, left: 0 };\n        var doc = elem.ownerDocument;\n        var offsetParent = ((elem.offsetParent && (elem.offsetParent.classList.contains('e-img-caption') ||\n            ignoreOffset.indexOf(elem.offsetParent.tagName) > -1)) ?\n            closest(elem, '#' + this.parent.getID() + '_rte-edit-view') : elem.offsetParent) || doc.documentElement;\n        while (offsetParent &&\n            (offsetParent === doc.body || offsetParent === doc.documentElement) &&\n            offsetParent.style.position === 'static') {\n            offsetParent = offsetParent.parentNode;\n        }\n        if (offsetParent && offsetParent !== elem && offsetParent.nodeType === 1) {\n            // eslint-disable-next-line\n            parentOffset = offsetParent.getBoundingClientRect();\n        }\n        return {\n            top: elem.offsetTop,\n            left: elem.offsetLeft\n        };\n    };\n    Image.prototype.setAspectRatio = function (img, expectedX, expectedY, e) {\n        if (isNullOrUndefined(img.width)) {\n            return;\n        }\n        var width = img.style.width !== '' ? img.style.width.match(/^\\d+(\\.\\d*)?%$/g) ? parseFloat(img.style.width) :\n            parseInt(img.style.width, 10) : img.width;\n        var height = img.style.height !== '' ? parseInt(img.style.height, 10) : img.height;\n        if (width > height) {\n            img.style.minWidth = '20px';\n            if (this.parent.insertImageSettings.resizeByPercent) {\n                if (parseInt('' + img.getBoundingClientRect().width + '', 10) !== 0 && parseInt('' + width + '', 10) !== 0) {\n                    var percentageValue = this.pixToPerc((width / height * expectedY), (img.previousElementSibling || img.parentElement));\n                    img.style.width = Math.min(Math.round((percentageValue / img.getBoundingClientRect().width) * expectedX * 100) / 100, 100) + '%';\n                }\n                else {\n                    img.style.width = this.pixToPerc((width / height * expectedY), (img.previousElementSibling || img.parentElement)) + '%';\n                }\n                img.style.height = null;\n                img.removeAttribute('height');\n            }\n            else if (img.style.width === '' && img.style.height !== '') {\n                img.style.height = expectedY + 'px';\n            }\n            else if (img.style.width !== '' && img.style.height === '') {\n                var currentWidth = ((width / height * expectedY) + width / height) < (this.parent.inputElement.getBoundingClientRect().right - 32) ?\n                    ((width / height * expectedY) + width / height) : (this.parent.inputElement.getBoundingClientRect().right - 32);\n                img.style.width = currentWidth.toString() + 'px';\n            }\n            else if (img.style.width !== '') {\n                var currentWidth = (width / height * expectedY) < (this.parent.inputElement.getBoundingClientRect().right - 32) ?\n                    (width / height * expectedY) : (this.parent.inputElement.getBoundingClientRect().right - 32);\n                img.style.width = currentWidth + 'px';\n                img.style.height = expectedY + 'px';\n            }\n            else {\n                img.setAttribute('width', ((width / height * expectedY) + width / height).toString());\n            }\n        }\n        else if (height > width) {\n            if (this.parent.insertImageSettings.resizeByPercent) {\n                if (parseInt('' + img.getBoundingClientRect().width + '', 10) !== 0 && parseInt('' + width + '', 10) !== 0) {\n                    img.style.width = Math.min(Math.round((width / img.getBoundingClientRect().width) * expectedX * 100) / 100, 100) + '%';\n                }\n                else {\n                    img.style.width = this.pixToPerc((expectedX / height * expectedY), (img.previousElementSibling || img.parentElement)) + '%';\n                }\n                img.style.height = null;\n                img.removeAttribute('height');\n            }\n            else if (img.style.width !== '') {\n                img.style.width = expectedX + 'px';\n                img.style.height = (height / width * expectedX) + 'px';\n            }\n            else {\n                img.setAttribute('width', this.resizeBtnStat.botRight ? (this.getPointX(e.event) - img.getBoundingClientRect().left).toString() : expectedX.toString());\n            }\n        }\n        else {\n            if (this.parent.insertImageSettings.resizeByPercent) {\n                img.style.width = this.pixToPerc(expectedX, (img.previousElementSibling || img.parentElement)) + '%';\n                img.style.height = null;\n                img.removeAttribute('height');\n            }\n            else if (img.style.width !== '') {\n                img.style.width = expectedX + 'px';\n                img.style.height = expectedX + 'px';\n            }\n            else {\n                img.setAttribute('width', expectedX.toString());\n                img.setAttribute('height', expectedX.toString());\n            }\n        }\n    };\n    Image.prototype.pixToPerc = function (expected, parentEle) {\n        return expected / parseFloat(getComputedStyle(parentEle).width) * 100;\n    };\n    Image.prototype.imgDupMouseMove = function (width, height, e) {\n        var _this = this;\n        var args = { event: e, requestType: 'images' };\n        this.parent.trigger(events.onResize, args, function (resizingArgs) {\n            if (resizingArgs.cancel) {\n                _this.cancelResizeAction();\n            }\n            else {\n                if ((parseInt(_this.parent.insertImageSettings.minWidth, 10) >= parseInt(width, 10) ||\n                    (parseInt(_this.parent.getInsertImgMaxWidth(), 10) <= parseInt(width, 10) &&\n                        isNOU(_this.imgEle.style.width)))) {\n                    return;\n                }\n                if (!_this.parent.insertImageSettings.resizeByPercent &&\n                    (parseInt(_this.parent.insertImageSettings.minHeight, 10) >= parseInt(height, 10) ||\n                        parseInt(_this.parent.insertImageSettings.maxHeight, 10) <= parseInt(height, 10))) {\n                    return;\n                }\n                _this.imgEle.parentElement.style.cursor = 'pointer';\n                _this.setAspectRatio(_this.imgEle, parseInt(width, 10), parseInt(height, 10), args);\n                _this.resizeImgDupPos(_this.imgEle);\n                _this.imgResizePos(_this.imgEle, _this.imgResizeDiv);\n                _this.parent.setContentHeight('', false);\n            }\n        });\n    };\n    Image.prototype.resizing = function (e) {\n        if (this.imgEle.offsetWidth >= this.parent.getInsertImgMaxWidth()) {\n            this.imgEle.style.maxHeight = this.imgEle.offsetHeight + 'px';\n        }\n        var pageX = this.getPointX(e);\n        var pageY = this.getPointY(e);\n        var mouseX = (this.resizeBtnStat.botLeft || this.resizeBtnStat.topLeft) ? -(pageX - this.pageX) : (pageX - this.pageX);\n        var mouseY = (this.resizeBtnStat.topLeft || this.resizeBtnStat.topRight) ? -(pageY - this.pageY) : (pageY - this.pageY);\n        var width = parseInt(this.imgDupPos.width, 10) + mouseX;\n        var height = parseInt(this.imgDupPos.height, 10) + mouseY;\n        this.pageX = pageX;\n        this.pageY = pageY;\n        if (this.resizeBtnStat.botRight) {\n            this.imgDupMouseMove(width + 'px', height + 'px', e);\n        }\n        else if (this.resizeBtnStat.botLeft) {\n            this.imgDupMouseMove(width + 'px', height + 'px', e);\n        }\n        else if (this.resizeBtnStat.topRight) {\n            this.imgDupMouseMove(width + 'px', height + 'px', e);\n        }\n        else if (this.resizeBtnStat.topLeft) {\n            this.imgDupMouseMove(width + 'px', height + 'px', e);\n        }\n    };\n    Image.prototype.cancelResizeAction = function () {\n        EventHandler.remove(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing);\n        EventHandler.remove(this.contentModule.getDocument(), Browser.touchEndEvent, this.resizeEnd);\n        if (this.imgEle && this.imgResizeDiv && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n            detach(this.imgResizeDiv);\n            this.imgEle.style.outline = '';\n            this.imgResizeDiv = null;\n            this.pageX = null;\n            this.pageY = null;\n        }\n    };\n    Image.prototype.resizeImgDupPos = function (e) {\n        this.imgDupPos = {\n            width: (e.style.width !== '' && (this.parent.insertImageSettings &&\n                !this.parent.insertImageSettings.resizeByPercent)) ? this.imgEle.style.width : e.width + 'px',\n            height: (e.style.height !== '') ? this.imgEle.style.height : e.height + 'px'\n        };\n    };\n    Image.prototype.resizeBtnInit = function () {\n        return this.resizeBtnStat = { botLeft: false, botRight: false, topRight: false, topLeft: false };\n    };\n    Image.prototype.onToolbarAction = function (args) {\n        if (isIDevice()) {\n            this.parent.notify(events.selectionRestore, {});\n        }\n        var item = args.args.item;\n        switch (item.subCommand) {\n            case 'Replace':\n                if (this.parent.fileManagerSettings.enable) {\n                    this.parent.notify(events.renderFileManager, args);\n                }\n                else {\n                    this.parent.notify(events.insertImage, args);\n                }\n                break;\n            case 'Caption':\n                this.parent.notify(events.imageCaption, args);\n                break;\n            case 'InsertLink':\n                this.parent.notify(events.imageLink, args);\n                break;\n            case 'AltText':\n                this.parent.notify(events.imageAlt, args);\n                break;\n            case 'Remove':\n                this.parent.notify(events.imageDelete, args);\n                break;\n            case 'Dimension':\n                this.parent.notify(events.imageSize, args);\n                break;\n            case 'OpenImageLink':\n                this.openImgLink(args);\n                break;\n            case 'EditImageLink':\n                this.editImgLink(args);\n                break;\n            case 'RemoveImageLink':\n                this.removeImgLink(args);\n                break;\n        }\n    };\n    Image.prototype.openImgLink = function (e) {\n        var target = e.selectParent[0].parentNode.target === '' ? '_self' : '_blank';\n        this.parent.formatter.process(this.parent, e.args, e.args, {\n            url: e.selectParent[0].parentNode.href, target: target, selectNode: e.selectNode,\n            subCommand: e.args.item.subCommand\n        });\n    };\n    Image.prototype.editImgLink = function (e) {\n        var selectParentEle = e.selectParent[0].parentNode;\n        var linkUpdate = this.i10n.getConstant('dialogUpdate');\n        var inputDetails = {\n            url: selectParentEle.href, target: selectParentEle.target,\n            header: 'Edit Link', btnText: linkUpdate\n        };\n        this.insertImgLink(e, inputDetails);\n    };\n    Image.prototype.removeImgLink = function (e) {\n        if (Browser.isIE) {\n            this.contentModule.getEditPanel().focus();\n        }\n        e.selection.restore();\n        var isCapLink = (this.contentModule.getEditPanel().contains(this.captionEle) && select('a', this.captionEle)) ?\n            true : false;\n        var selectParent = isCapLink ? [this.captionEle] : [e.selectNode[0].parentElement];\n        this.parent.formatter.process(this.parent, e.args, e.args, {\n            insertElement: e.selectNode[0], selectParent: selectParent, selection: e.selection,\n            subCommand: e.args.item.subCommand\n        });\n        if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n            this.quickToolObj.imageQTBar.hidePopup();\n            if (!isNullOrUndefined(e.selectParent)) {\n                removeClass([e.selectParent[0]], 'e-img-focus');\n            }\n        }\n        if (isCapLink) {\n            select('.e-img-inner', this.captionEle).focus();\n        }\n    };\n    Image.prototype.onKeyDown = function (event) {\n        var originalEvent = event.args;\n        var range;\n        var save;\n        var selectNodeEle;\n        var selectParentEle;\n        this.deletedImg = [];\n        var isCursor;\n        var keyCodeValues = [27, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123,\n            44, 45, 9, 16, 17, 18, 19, 20, 33, 34, 35, 36, 37, 38, 39, 40, 91, 92, 93, 144, 145, 182, 183];\n        if (this.parent.editorMode === 'HTML') {\n            range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n            isCursor = range.startContainer === range.endContainer && range.startOffset === range.endOffset;\n        }\n        if (!isCursor && this.parent.editorMode === 'HTML' && keyCodeValues.indexOf(originalEvent.which) < 0) {\n            var nodes = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n            for (var i = 0; i < nodes.length; i++) {\n                if (nodes[i].nodeName === 'IMG') {\n                    this.deletedImg.push(nodes[i]);\n                }\n            }\n        }\n        if (this.parent.editorMode === 'HTML' && ((originalEvent.which === 8 && originalEvent.code === 'Backspace') ||\n            (originalEvent.which === 46 && originalEvent.code === 'Delete'))) {\n            var isCursor_1 = range.startContainer === range.endContainer && range.startOffset === range.endOffset;\n            if ((originalEvent.which === 8 && originalEvent.code === 'Backspace' && isCursor_1)) {\n                this.checkImageBack(range);\n            }\n            else if ((originalEvent.which === 46 && originalEvent.code === 'Delete' && isCursor_1)) {\n                this.checkImageDel(range);\n            }\n        }\n        if (!isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection) &&\n            originalEvent.code !== 'KeyK') {\n            range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n            save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n            selectNodeEle = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n            selectParentEle = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n            if (!originalEvent.ctrlKey && originalEvent.key && (originalEvent.key.length === 1 || originalEvent.action === 'enter') &&\n                (selectParentEle[0].tagName === 'IMG') && selectParentEle[0].parentElement) {\n                var prev = selectParentEle[0].parentElement.childNodes[0];\n                if (this.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n                    this.removeResizeEle();\n                }\n                this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(), prev, prev, prev.textContent.length, prev.textContent.length);\n                removeClass([selectParentEle[0]], 'e-img-focus');\n                this.quickToolObj.imageQTBar.hidePopup();\n            }\n        }\n        if (originalEvent.ctrlKey && (originalEvent.keyCode === 89 || originalEvent.keyCode === 90)) {\n            this.undoStack({ subCommand: (originalEvent.keyCode === 90 ? 'undo' : 'redo') });\n        }\n        if (originalEvent.keyCode === 8 || originalEvent.keyCode === 46) {\n            if (selectNodeEle && selectNodeEle[0].nodeName === 'IMG' && selectNodeEle.length < 1) {\n                originalEvent.preventDefault();\n                var event_1 = {\n                    selectNode: selectNodeEle, selection: save, selectParent: selectParentEle,\n                    args: {\n                        item: { command: 'Images', subCommand: 'Remove' },\n                        originalEvent: originalEvent\n                    }\n                };\n                this.deleteImg(event_1, originalEvent.keyCode);\n            }\n            if (this.parent.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n                this.removeResizeEle();\n            }\n        }\n        if (originalEvent.code === 'Backspace') {\n            originalEvent.action = 'backspace';\n        }\n        switch (originalEvent.action) {\n            case 'escape':\n                if (!isNullOrUndefined(this.dialogObj)) {\n                    this.dialogObj.close();\n                }\n                break;\n            case 'backspace':\n            case 'delete':\n                for (var i = 0; i < this.deletedImg.length; i++) {\n                    var src = this.deletedImg[i].src;\n                    this.imageRemovePost(src);\n                }\n                if (this.parent.editorMode !== 'Markdown') {\n                    if (range.startContainer.nodeType === 3) {\n                        if (originalEvent.code === 'Backspace') {\n                            if (range.startContainer.previousElementSibling && range.startOffset === 0 &&\n                                range.startContainer.previousElementSibling.classList.contains(classes.CLS_CAPTION) &&\n                                range.startContainer.previousElementSibling.classList.contains(classes.CLS_CAPINLINE)) {\n                                detach(range.startContainer.previousElementSibling);\n                            }\n                        }\n                        else {\n                            if (range.startContainer.nextElementSibling &&\n                                range.endContainer.textContent.length === range.endOffset &&\n                                range.startContainer.nextElementSibling.classList.contains(classes.CLS_CAPTION) &&\n                                range.startContainer.nextElementSibling.classList.contains(classes.CLS_CAPINLINE)) {\n                                detach(range.startContainer.nextElementSibling);\n                            }\n                        }\n                    }\n                    else if ((range.startContainer.nodeType === 1 &&\n                        range.startContainer.querySelector('.' + classes.CLS_CAPTION + '.' + classes.CLS_CAPINLINE))) {\n                        detach(range.startContainer.querySelector('.' + classes.CLS_CAPTION + '.' + classes.CLS_CAPINLINE));\n                    }\n                }\n                break;\n            case 'insert-image':\n                this.openDialog(true, originalEvent, save, selectNodeEle, selectParentEle);\n                originalEvent.preventDefault();\n                break;\n        }\n    };\n    Image.prototype.openDialog = function (isInternal, event, selection, ele, parentEle) {\n        var range;\n        var save;\n        var selectNodeEle;\n        var selectParentEle;\n        if (!isInternal && !isNOU(this.parent.formatter.editorManager.nodeSelection)) {\n            range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n            save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n            selectNodeEle = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n            selectParentEle = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n        }\n        else {\n            save = selection;\n            selectNodeEle = ele;\n            selectParentEle = parentEle;\n        }\n        if (this.parent.editorMode === 'HTML') {\n            this.insertImage({\n                args: {\n                    item: { command: 'Images', subCommand: 'Image' },\n                    originalEvent: event\n                },\n                selectNode: selectNodeEle,\n                selection: save,\n                selectParent: selectParentEle\n            });\n        }\n        else {\n            this.insertImage({\n                args: {\n                    item: { command: 'Images', subCommand: 'Image' },\n                    originalEvent: event\n                },\n                member: 'image',\n                text: this.parent.formatter.editorManager.markdownSelection.getSelectedText(this.parent.contentModule.getEditPanel()),\n                module: 'Markdown',\n                name: 'insertImage'\n            });\n        }\n    };\n    Image.prototype.showDialog = function () {\n        this.openDialog(false);\n    };\n    Image.prototype.closeDialog = function () {\n        if (this.dialogObj) {\n            this.dialogObj.hide({ returnValue: true });\n        }\n    };\n    // eslint-disable-next-line\n    Image.prototype.onKeyUp = function (event) {\n        if (!isNOU(this.deletedImg) && this.deletedImg.length > 0) {\n            for (var i = 0; i < this.deletedImg.length; i++) {\n                var args = {\n                    element: this.deletedImg[i],\n                    src: this.deletedImg[i].getAttribute('src')\n                };\n                this.parent.trigger(events.afterImageDelete, args);\n            }\n        }\n    };\n    Image.prototype.checkImageBack = function (range) {\n        if (range.startContainer.nodeName === '#text' && range.startOffset === 0 &&\n            !isNOU(range.startContainer.previousSibling) && range.startContainer.previousSibling.nodeName === 'IMG') {\n            this.deletedImg.push(range.startContainer.previousSibling);\n        }\n        else if (range.startContainer.nodeName !== '#text' && !isNOU(range.startContainer.childNodes[range.startOffset - 1]) &&\n            range.startContainer.childNodes[range.startOffset - 1].nodeName === 'IMG') {\n            this.deletedImg.push(range.startContainer.childNodes[range.startOffset - 1]);\n        }\n    };\n    Image.prototype.checkImageDel = function (range) {\n        if (range.startContainer.nodeName === '#text' && range.startOffset === range.startContainer.textContent.length &&\n            !isNOU(range.startContainer.nextSibling) && range.startContainer.nextSibling.nodeName === 'IMG') {\n            this.deletedImg.push(range.startContainer.nextSibling);\n        }\n        else if (range.startContainer.nodeName !== '#text' && !isNOU(range.startContainer.childNodes[range.startOffset]) &&\n            range.startContainer.childNodes[range.startOffset].nodeName === 'IMG') {\n            this.deletedImg.push(range.startContainer.childNodes[range.startOffset]);\n        }\n    };\n    Image.prototype.alignmentSelect = function (e) {\n        var item = e.item;\n        if (!document.body.contains(document.body.querySelector('.e-rte-quick-toolbar')) || item.command !== 'Images') {\n            return;\n        }\n        var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n        var selectNodeEle = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n        selectNodeEle = (selectNodeEle[0].nodeName === 'IMG') ? selectNodeEle : [this.imgEle];\n        var args = { args: e, selectNode: selectNodeEle };\n        if (this.parent.formatter.getUndoRedoStack().length === 0) {\n            this.parent.formatter.saveData();\n        }\n        switch (item.subCommand) {\n            case 'JustifyLeft':\n                this.alignImage(args, 'JustifyLeft');\n                break;\n            case 'JustifyCenter':\n                this.alignImage(args, 'JustifyCenter');\n                break;\n            case 'JustifyRight':\n                this.alignImage(args, 'JustifyRight');\n                break;\n            case 'Inline':\n                this.inline(args);\n                break;\n            case 'Break':\n                this.break(args);\n                break;\n        }\n        if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n            this.quickToolObj.imageQTBar.hidePopup();\n            removeClass([selectNodeEle[0]], 'e-img-focus');\n        }\n        this.cancelResizeAction();\n    };\n    Image.prototype.imageWithLinkQTBarItemUpdate = function () {\n        var separator;\n        var items = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item');\n        for (var i = 0; i < items.length; i++) {\n            if (items[i].getAttribute('title') === this.i10n.getConstant('openLink') ||\n                items[i].getAttribute('title') === this.i10n.getConstant('editLink') ||\n                items[i].getAttribute('title') === this.i10n.getConstant('removeLink')) {\n                addClass([items[i]], 'e-link-groups');\n                items[i].style.display = 'none';\n            }\n            else if (items[i].getAttribute('title') === 'Insert Link') {\n                items[i].style.display = '';\n            }\n            else if (items[i].classList.contains('e-rte-horizontal-separator')) {\n                // eslint-disable-next-line\n                separator = items[i];\n                detach(items[i]);\n            }\n        }\n        var newItems = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item:not(.e-link-groups)');\n        this.quickToolObj.imageQTBar.addQTBarItem(['-'], Math.round(newItems.length / 2));\n    };\n    Image.prototype.showImageQuickToolbar = function (e) {\n        var _this = this;\n        if (e.type !== 'Images' || isNullOrUndefined(this.parent.quickToolbarModule)\n            || isNullOrUndefined(this.parent.quickToolbarModule.imageQTBar) || isNullOrUndefined(e.args)) {\n            return;\n        }\n        this.quickToolObj = this.parent.quickToolbarModule;\n        var args = e.args;\n        var target = e.elements;\n        [].forEach.call(e.elements, function (element, index) {\n            if (index === 0) {\n                target = element;\n            }\n        });\n        if (target && !closest(target, 'a')) {\n            this.imageWithLinkQTBarItemUpdate();\n        }\n        if (target.nodeName === 'IMG') {\n            addClass([target], ['e-img-focus']);\n        }\n        var pageY = (this.parent.iframeSettings.enable) ? window.pageYOffset +\n            this.parent.element.getBoundingClientRect().top + args.clientY : args.pageY;\n        if (this.parent.quickToolbarModule.imageQTBar) {\n            if (e.isNotify) {\n                setTimeout(function () {\n                    _this.quickToolObj.imageQTBar.showPopup(args.pageX, pageY, target);\n                }, 400);\n            }\n            else {\n                this.quickToolObj.imageQTBar.showPopup(args.pageX, pageY, target);\n            }\n        }\n    };\n    Image.prototype.hideImageQuickToolbar = function () {\n        if (!isNullOrUndefined(this.contentModule.getEditPanel().querySelector('.e-img-focus'))) {\n            removeClass([this.contentModule.getEditPanel().querySelector('.e-img-focus')], 'e-img-focus');\n            if (this.quickToolObj && this.quickToolObj.imageQTBar && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n                this.quickToolObj.imageQTBar.hidePopup();\n            }\n        }\n    };\n    Image.prototype.editAreaClickHandler = function (e) {\n        if (this.parent.readonly) {\n            this.hideImageQuickToolbar();\n            return;\n        }\n        var args = e.args;\n        var showOnRightClick = this.parent.quickToolbarSettings.showOnRightClick;\n        if (args.which === 2 || (showOnRightClick && args.which === 1) || (!showOnRightClick && args.which === 3)) {\n            if ((showOnRightClick && args.which === 1) && !isNullOrUndefined(args.target) &&\n                args.target.tagName === 'IMG') {\n                this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument());\n                this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(), args.target);\n            }\n            return;\n        }\n        if (this.parent.editorMode === 'HTML' && this.parent.quickToolbarModule && this.parent.quickToolbarModule.imageQTBar) {\n            this.quickToolObj = this.parent.quickToolbarModule;\n            var target = args.target;\n            this.contentModule = this.rendererFactory.getRenderer(RenderType.Content);\n            var isPopupOpen = this.quickToolObj.imageQTBar.element.classList.contains('e-rte-pop');\n            if (target.nodeName === 'IMG' && this.parent.quickToolbarModule) {\n                if (isPopupOpen) {\n                    return;\n                }\n                this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument());\n                this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(), target);\n                if (isIDevice()) {\n                    this.parent.notify(events.selectionSave, e);\n                }\n                addClass([target], 'e-img-focus');\n                var items = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item');\n                var separator = void 0;\n                if (closest(target, 'a')) {\n                    for (var i = 0; i < items.length; i++) {\n                        if (items[i].getAttribute('title') === this.i10n.getConstant('openLink') ||\n                            items[i].getAttribute('title') === this.i10n.getConstant('editLink') ||\n                            items[i].getAttribute('title') === this.i10n.getConstant('removeLink')) {\n                            items[i].style.display = '';\n                            removeClass([items[i]], 'e-link-groups');\n                        }\n                        else if (items[i].getAttribute('title') === 'Insert Link') {\n                            items[i].style.display = 'none';\n                        }\n                        else if (items[i].classList.contains('e-rte-horizontal-separator')) {\n                            // eslint-disable-next-line\n                            separator = items[i];\n                            detach(items[i]);\n                        }\n                    }\n                    var newItems = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item:not(.e-link-groups)');\n                    this.quickToolObj.imageQTBar.addQTBarItem(['-'], Math.round(newItems.length / 2));\n                }\n                else if (!closest(target, 'a')) {\n                    this.imageWithLinkQTBarItemUpdate();\n                }\n                this.showImageQuickToolbar({ args: args, type: 'Images', elements: [args.target] });\n            }\n            else {\n                this.hideImageQuickToolbar();\n            }\n        }\n    };\n    Image.prototype.insertImgLink = function (e, inputDetails) {\n        var _this = this;\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        this.imagDialog(e);\n        if (!isNullOrUndefined(this.dialogObj)) {\n            var linkWrap = this.parent.createElement('div', { className: 'e-img-linkwrap' });\n            var linkUrl = this.i10n.getConstant('linkurl');\n            var content = '<div class=\"e-rte-field\">' +\n                '<input type=\"text\" data-role =\"none\" class=\"e-input e-img-link\" spellcheck=\"false\" placeholder=\"' + linkUrl + '\"/></div>' +\n                '<div class=\"e-rte-label\"></div>' + '<div class=\"e-rte-field\">' +\n                '<input type=\"checkbox\" class=\"e-rte-linkTarget\"  data-role =\"none\"></div>';\n            var contentElem = parseHtml(content);\n            linkWrap.appendChild(contentElem);\n            var linkTarget = linkWrap.querySelector('.e-rte-linkTarget');\n            var inputLink = linkWrap.querySelector('.e-img-link');\n            var linkOpenLabel = this.i10n.getConstant('linkOpenInNewWindow');\n            this.checkBoxObj = new CheckBox({\n                label: linkOpenLabel, checked: true, enableRtl: this.parent.enableRtl, change: function (e) {\n                    if (e.checked) {\n                        target_1 = '_blank';\n                    }\n                    else {\n                        target_1 = null;\n                    }\n                }\n            });\n            this.checkBoxObj.isStringTemplate = true;\n            this.checkBoxObj.createElement = this.parent.createElement;\n            this.checkBoxObj.appendTo(linkTarget);\n            var target_1 = this.checkBoxObj.checked ? '_blank' : null;\n            var linkUpdate = this.i10n.getConstant('dialogUpdate');\n            var linkargs_1 = {\n                args: e.args,\n                selfImage: this, selection: e.selection,\n                selectNode: e.selectNode, selectParent: e.selectParent, link: inputLink, target: target_1\n            };\n            this.dialogObj.setProperties({\n                height: 'inherit',\n                width: '290px',\n                header: this.parent.localeObj.getConstant('imageInsertLinkHeader'),\n                content: linkWrap,\n                position: { X: 'center', Y: 'center' },\n                buttons: [{\n                        // eslint-disable-next-line\n                        click: function (e) {\n                            _this.insertlink(linkargs_1);\n                        },\n                        buttonModel: {\n                            content: linkUpdate, cssClass: 'e-flat e-update-link', isPrimary: true\n                        }\n                    }]\n            });\n            if (!isNullOrUndefined(inputDetails)) {\n                inputLink.value = inputDetails.url;\n                // eslint-disable-next-line\n                (inputDetails.target) ? this.checkBoxObj.checked = true : this.checkBoxObj.checked = false;\n                this.dialogObj.header = inputDetails.header;\n            }\n            this.dialogObj.element.style.maxHeight = 'inherit';\n            this.dialogObj.content.querySelector('input').focus();\n        }\n    };\n    Image.prototype.insertAltText = function (e) {\n        var _this = this;\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        this.imagDialog(e);\n        var altText = this.i10n.getConstant('altText');\n        if (!isNullOrUndefined(this.dialogObj)) {\n            var altWrap = this.parent.createElement('div', { className: 'e-img-altwrap' });\n            var altHeader = this.i10n.getConstant('alternateHeader');\n            var linkUpdate = this.i10n.getConstant('dialogUpdate');\n            var getAlt = (e.selectNode[0].getAttribute('alt') === null) ? '' :\n                e.selectNode[0].getAttribute('alt');\n            var content = '<div class=\"e-rte-field\">' +\n                '<input type=\"text\" spellcheck=\"false\" value=\"' + getAlt + '\" class=\"e-input e-img-alt\" placeholder=\"' + altText + '\"/>' +\n                '</div>';\n            var contentElem = parseHtml(content);\n            altWrap.appendChild(contentElem);\n            var inputAlt = altWrap.querySelector('.e-img-alt');\n            var altArgs_1 = {\n                args: e.args, selfImage: this, selection: e.selection, selectNode: e.selectNode,\n                alt: inputAlt\n            };\n            this.dialogObj.setProperties({\n                height: 'inherit', width: '290px', header: altHeader, content: altWrap, position: { X: 'center', Y: 'center' },\n                buttons: [{\n                        // eslint-disable-next-line\n                        click: function (e) {\n                            _this.insertAlt(altArgs_1);\n                        },\n                        buttonModel: {\n                            content: linkUpdate, cssClass: 'e-flat e-update-alt', isPrimary: true\n                        }\n                    }]\n            });\n            this.dialogObj.element.style.maxHeight = 'inherit';\n            this.dialogObj.content.querySelector('input').focus();\n        }\n    };\n    Image.prototype.insertAlt = function (e) {\n        if (!isNullOrUndefined(e.alt)) {\n            e.selection.restore();\n            if (this.parent.formatter.getUndoRedoStack().length === 0) {\n                this.parent.formatter.saveData();\n            }\n            var altText = e.alt.value;\n            this.parent.formatter.process(this.parent, e.args, e.args, {\n                altText: altText, selectNode: e.selectNode,\n                subCommand: e.args.item.subCommand\n            });\n            this.dialogObj.hide({ returnValue: false });\n        }\n    };\n    Image.prototype.insertlink = function (e) {\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        var url = e.link.value;\n        if (url === '') {\n            addClass([e.link], 'e-error');\n            e.link.setSelectionRange(0, url.length);\n            e.link.focus();\n            return;\n        }\n        if (!this.isUrl(url)) {\n            url = 'http://' + url;\n        }\n        else {\n            removeClass([e.link], 'e-error');\n        }\n        var proxy = e.selfImage;\n        if (proxy.parent.editorMode === 'HTML') {\n            e.selection.restore();\n        }\n        if (proxy.parent.formatter.getUndoRedoStack().length === 0) {\n            proxy.parent.formatter.saveData();\n        }\n        if (e.selectNode[0].parentElement.nodeName === 'A') {\n            proxy.parent.formatter.process(proxy.parent, e.args, e.args, {\n                url: url, target: proxy.checkBoxObj.checked ? '_blank' : null, selectNode: e.selectNode,\n                subCommand: e.args.item.subCommand\n            });\n            proxy.dialogObj.hide({ returnValue: true });\n            return;\n        }\n        proxy.parent.formatter.process(proxy.parent, e.args, e.args, {\n            url: url, target: proxy.checkBoxObj.checked ? '_blank' : null, selectNode: e.selectNode,\n            subCommand: e.args.item.subCommand, selection: e.selection\n        });\n        var captionEle = closest(e.selectNode[0], '.e-img-caption');\n        if (captionEle) {\n            select('.e-img-inner', captionEle).focus();\n        }\n        if (captionEle) {\n            select('.e-img-inner', captionEle).focus();\n        }\n        proxy.dialogObj.hide({ returnValue: false });\n    };\n    Image.prototype.isUrl = function (url) {\n        // eslint-disable-next-line\n        var regexp = /(ftp|http|https):\\/\\/(\\w+:{0,1}\\w*@)?(\\S+)(:[0-9]+)?(\\/|\\/([\\w#!:.?+=&%@!\\-\\/]))?/gi;\n        return regexp.test(url);\n    };\n    Image.prototype.deleteImg = function (e, keyCode) {\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        var args = {\n            element: e.selectNode[0],\n            src: e.selectNode[0].getAttribute('src')\n        };\n        if (this.parent.formatter.getUndoRedoStack().length === 0) {\n            this.parent.formatter.saveData();\n        }\n        e.selection.restore();\n        if (this.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n            this.removeResizeEle();\n        }\n        this.parent.formatter.process(this.parent, e.args, e.args, {\n            selectNode: e.selectNode,\n            captionClass: classes.CLS_CAPTION,\n            subCommand: e.args.item.subCommand\n        });\n        this.imageRemovePost(args.src);\n        if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n            this.quickToolObj.imageQTBar.hidePopup();\n        }\n        this.cancelResizeAction();\n        if (isNullOrUndefined(keyCode)) {\n            this.parent.trigger(events.afterImageDelete, args);\n        }\n    };\n    Image.prototype.imageRemovePost = function (src) {\n        var proxy = this;\n        var absoluteUrl = '';\n        if (isNOU(this.parent.insertImageSettings.removeUrl) || this.parent.insertImageSettings.removeUrl === '') {\n            return;\n        }\n        if (src.indexOf('http://') > -1 || src.indexOf('https://') > -1) {\n            absoluteUrl = src;\n        }\n        else {\n            absoluteUrl = new URL(src, document.baseURI).href;\n        }\n        this.removingImgName = absoluteUrl.replace(/^.*[\\\\\\/]/, '');\n        var xhr = new XMLHttpRequest();\n        xhr.addEventListener(\"readystatechange\", function () {\n            if (this.readyState == 4 && this.status == 200) {\n                proxy.triggerPost(this.response);\n            }\n        });\n        xhr.open('GET', absoluteUrl);\n        xhr.responseType = 'blob';\n        xhr.send();\n    };\n    Image.prototype.triggerPost = function (response) {\n        var removeUrl = this.parent.insertImageSettings.removeUrl;\n        if (isNOU(removeUrl) || removeUrl === '') {\n            return;\n        }\n        var file = new File([response], this.removingImgName);\n        var ajax = new Ajax(removeUrl, 'POST', true, null);\n        var formData = new FormData();\n        formData.append('UploadFiles', file);\n        ajax.send(formData);\n    };\n    Image.prototype.caption = function (e) {\n        var selectNode = e.selectNode[0];\n        if (selectNode.nodeName !== 'IMG') {\n            return;\n        }\n        e.selection.restore();\n        if (this.parent.formatter.getUndoRedoStack().length === 0) {\n            this.parent.formatter.saveData();\n        }\n        this.cancelResizeAction();\n        addClass([selectNode], 'e-rte-image');\n        var subCommand = (e.args.item) ?\n            e.args.item.subCommand : 'Caption';\n        if (!isNullOrUndefined(closest(selectNode, '.' + classes.CLS_CAPTION))) {\n            detach(closest(selectNode, '.' + classes.CLS_CAPTION));\n            if (Browser.isIE) {\n                this.contentModule.getEditPanel().focus();\n                e.selection.restore();\n            }\n            if (selectNode.parentElement.tagName === 'A') {\n                this.parent.formatter.process(this.parent, e.args, e.args, { insertElement: selectNode.parentElement, selectNode: e.selectNode, subCommand: subCommand });\n            }\n            else {\n                this.parent.formatter.process(this.parent, e.args, e.args, { insertElement: selectNode, selectNode: e.selectNode, subCommand: subCommand });\n            }\n        }\n        else {\n            this.captionEle = this.parent.createElement('span', {\n                className: classes.CLS_CAPTION + ' ' + classes.CLS_RTE_CAPTION,\n                attrs: { contenteditable: 'false', draggable: 'false', style: 'width:' + this.parent.insertImageSettings.width }\n            });\n            var imgWrap = this.parent.createElement('span', { className: 'e-img-wrap' });\n            var imgInner = this.parent.createElement('span', { className: 'e-img-inner',\n                attrs: { contenteditable: 'true' } });\n            var parent_1 = e.selectNode[0].parentElement;\n            if (parent_1.tagName === 'A') {\n                parent_1.setAttribute('contenteditable', 'true');\n            }\n            imgWrap.appendChild(parent_1.tagName === 'A' ? parent_1 : e.selectNode[0]);\n            imgWrap.appendChild(imgInner);\n            var imgCaption = this.i10n.getConstant('imageCaption');\n            imgInner.innerHTML = imgCaption;\n            this.captionEle.appendChild(imgWrap);\n            if (selectNode.classList.contains(classes.CLS_IMGINLINE)) {\n                addClass([this.captionEle], classes.CLS_CAPINLINE);\n            }\n            if (selectNode.classList.contains(classes.CLS_IMGBREAK)) {\n                addClass([this.captionEle], classes.CLS_IMGBREAK);\n            }\n            if (selectNode.classList.contains(classes.CLS_IMGLEFT)) {\n                addClass([this.captionEle], classes.CLS_IMGLEFT);\n            }\n            if (selectNode.classList.contains(classes.CLS_IMGRIGHT)) {\n                addClass([this.captionEle], classes.CLS_IMGRIGHT);\n            }\n            if (selectNode.classList.contains(classes.CLS_IMGCENTER)) {\n                addClass([this.captionEle], classes.CLS_IMGCENTER);\n            }\n            this.parent.formatter.process(this.parent, e.args, e.args, { insertElement: this.captionEle, selectNode: e.selectNode, subCommand: subCommand });\n            this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(), imgInner.childNodes[0], imgInner.childNodes[0], 0, imgInner.childNodes[0].textContent.length);\n        }\n        if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n            this.quickToolObj.imageQTBar.hidePopup();\n            removeClass([selectNode], 'e-img-focus');\n        }\n    };\n    Image.prototype.imageSize = function (e) {\n        var _this = this;\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        this.imagDialog(e);\n        if (!isNullOrUndefined(this.dialogObj)) {\n            var imgSizeHeader = this.i10n.getConstant('imageSizeHeader');\n            var linkUpdate = this.i10n.getConstant('dialogUpdate');\n            var dialogContent = this.imgsizeInput(e);\n            var selectObj_1 = { args: e.args, selfImage: this, selection: e.selection, selectNode: e.selectNode };\n            this.dialogObj.setProperties({\n                height: 'inherit', width: '290px', header: imgSizeHeader, content: dialogContent, position: { X: 'center', Y: 'center' },\n                buttons: [{\n                        // eslint-disable-next-line\n                        click: function (e) {\n                            _this.insertSize(selectObj_1);\n                        },\n                        buttonModel: {\n                            content: linkUpdate, cssClass: 'e-flat e-update-size', isPrimary: true\n                        }\n                    }]\n            });\n            this.dialogObj.element.style.maxHeight = 'inherit';\n            this.dialogObj.content.querySelector('input').focus();\n        }\n    };\n    Image.prototype.break = function (e) {\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        var subCommand = (e.args.item) ?\n            e.args.item.subCommand : 'Break';\n        this.parent.formatter.process(this.parent, e.args, e.args, { selectNode: e.selectNode, subCommand: subCommand });\n    };\n    Image.prototype.inline = function (e) {\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        var subCommand = (e.args.item) ?\n            e.args.item.subCommand : 'Inline';\n        this.parent.formatter.process(this.parent, e.args, e.args, { selectNode: e.selectNode, subCommand: subCommand });\n    };\n    Image.prototype.alignImage = function (e, type) {\n        var subCommand = (e.args.item) ?\n            e.args.item.subCommand : type;\n        this.parent.formatter.process(this.parent, e.args, e.args, { selectNode: e.selectNode, subCommand: subCommand });\n    };\n    Image.prototype.clearDialogObj = function () {\n        if (this.dialogObj) {\n            this.dialogObj.destroy();\n            detach(this.dialogObj.element);\n            this.dialogObj = null;\n        }\n    };\n    Image.prototype.imagDialog = function (e) {\n        var _this = this;\n        if (this.dialogObj) {\n            this.dialogObj.hide({ returnValue: true });\n            return;\n        }\n        var imgDialog = this.parent.createElement('div', { className: 'e-rte-img-dialog', id: this.rteID + '_image' });\n        this.parent.element.appendChild(imgDialog);\n        var imgInsert = this.i10n.getConstant('dialogInsert');\n        var imglinkCancel = this.i10n.getConstant('dialogCancel');\n        var imgHeader = this.i10n.getConstant('imageHeader');\n        var selection = e.selection;\n        var selectObj = { selfImage: this, selection: e.selection, args: e.args, selectParent: e.selectParent };\n        var dialogModel = {\n            header: imgHeader,\n            cssClass: classes.CLS_RTE_ELEMENTS,\n            enableRtl: this.parent.enableRtl,\n            locale: this.parent.locale,\n            showCloseIcon: true, closeOnEscape: true, width: (Browser.isDevice) ? '290px' : '340px', height: 'inherit',\n            position: { X: 'center', Y: (Browser.isDevice) ? 'center' : 'top' },\n            isModal: Browser.isDevice,\n            buttons: [{\n                    click: this.insertImageUrl.bind(selectObj),\n                    buttonModel: { content: imgInsert, cssClass: 'e-flat e-insertImage', isPrimary: true, disabled: true }\n                },\n                {\n                    click: function (e) {\n                        _this.cancelDialog(e);\n                    },\n                    buttonModel: { cssClass: 'e-flat e-cancel', content: imglinkCancel }\n                }],\n            target: (Browser.isDevice) ? document.body : this.parent.element,\n            animationSettings: { effect: 'None' },\n            close: function (event) {\n                if (_this.isImgUploaded) {\n                    _this.uploadObj.removing();\n                }\n                _this.parent.isBlur = false;\n                if (event && event.event.returnValue) {\n                    if (_this.parent.editorMode === 'HTML') {\n                        selection.restore();\n                    }\n                    else {\n                        _this.parent.formatter.editorManager.markdownSelection.restore(_this.parent.contentModule.getEditPanel());\n                    }\n                }\n                _this.dialogObj.destroy();\n                detach(_this.dialogObj.element);\n                _this.dialogRenderObj.close(event);\n                _this.dialogObj = null;\n            }\n        };\n        var dialogContent = this.parent.createElement('div', { className: 'e-img-content' });\n        if ((!isNullOrUndefined(this.parent.insertImageSettings.path) && this.parent.editorMode === 'Markdown')\n            || this.parent.editorMode === 'HTML') {\n            dialogContent.appendChild(this.imgUpload(e));\n        }\n        var linkHeader = this.parent.createElement('div', { className: 'e-linkheader' });\n        var linkHeaderText = this.i10n.getConstant('imageLinkHeader');\n        if (this.parent.editorMode === 'HTML') {\n            linkHeader.innerHTML = linkHeaderText;\n        }\n        else {\n            linkHeader.innerHTML = this.i10n.getConstant('mdimageLink');\n        }\n        dialogContent.appendChild(linkHeader);\n        dialogContent.appendChild(this.imageUrlPopup(e));\n        if (e.selectNode && e.selectNode[0].nodeName === 'IMG') {\n            dialogModel.header = this.parent.localeObj.getConstant('editImageHeader');\n            dialogModel.content = dialogContent;\n        }\n        else {\n            dialogModel.content = dialogContent;\n        }\n        this.dialogObj = this.dialogRenderObj.render(dialogModel);\n        this.dialogObj.createElement = this.parent.createElement;\n        this.dialogObj.appendTo(imgDialog);\n        if (isNullOrUndefined(this.dialogObj)) {\n            return;\n        }\n        if (e.selectNode && e.selectNode[0].nodeName === 'IMG' && (e.name === 'insertImage')) {\n            this.dialogObj.element.querySelector('.e-insertImage').textContent = this.parent.localeObj.getConstant('dialogUpdate');\n        }\n        imgDialog.style.maxHeight = 'inherit';\n        if (this.quickToolObj) {\n            if (this.quickToolObj.imageQTBar && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n                this.quickToolObj.imageQTBar.hidePopup();\n                if (!isNullOrUndefined(e.selectParent)) {\n                    removeClass([e.selectParent[0]], 'e-img-focus');\n                }\n            }\n            if (this.quickToolObj.inlineQTBar && document.body.contains(this.quickToolObj.inlineQTBar.element)) {\n                this.quickToolObj.inlineQTBar.hidePopup();\n            }\n        }\n    };\n    // eslint-disable-next-line\n    Image.prototype.cancelDialog = function (e) {\n        this.parent.isBlur = false;\n        this.dialogObj.hide({ returnValue: true });\n        if (this.isImgUploaded) {\n            this.uploadObj.removing();\n        }\n    };\n    Image.prototype.onDocumentClick = function (e) {\n        var target = e.target;\n        if (target.nodeName === 'IMG') {\n            this.imgEle = target;\n        }\n        if (!isNullOrUndefined(this.dialogObj) && ((\n        // eslint-disable-next-line\n        !closest(target, '[id=' + \"'\" + this.dialogObj.element.id + \"'\" + ']') && this.parent.toolbarSettings.enable && this.parent.getToolbarElement() &&\n            !this.parent.getToolbarElement().contains(e.target)) ||\n            (this.parent.getToolbarElement() && this.parent.getToolbarElement().contains(e.target) &&\n                !closest(target, '#' + this.parent.getID() + '_toolbar_Image') &&\n                !target.querySelector('#' + this.parent.getID() + '_toolbar_Image')))) {\n            /* eslint-disable */\n            if (e.offsetX > e.target.clientWidth || e.offsetY > e.target.clientHeight) {\n            }\n            else {\n                this.dialogObj.hide({ returnValue: true });\n                this.parent.isBlur = true;\n                dispatchEvent(this.parent.element, 'focusout');\n            }\n            /* eslint-enable */\n        }\n        if (e.target.tagName !== 'IMG' && this.imgResizeDiv && !(this.quickToolObj &&\n            this.quickToolObj.imageQTBar && this.quickToolObj.imageQTBar.element.contains(e.target)) &&\n            this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n            this.cancelResizeAction();\n        }\n        if (this.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n            if (target.tagName !== 'IMG') {\n                this.removeResizeEle();\n            }\n            if (target.tagName !== 'IMG' && !isNOU(this.imgEle)) {\n                this.imgEle.style.outline = '';\n            }\n            else if (!isNOU(this.prevSelectedImgEle) && this.prevSelectedImgEle !== target) {\n                this.prevSelectedImgEle.style.outline = '';\n            }\n        }\n    };\n    Image.prototype.removeResizeEle = function () {\n        EventHandler.remove(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing);\n        EventHandler.remove(this.contentModule.getDocument(), Browser.touchEndEvent, this.resizeEnd);\n        detach(this.contentModule.getEditPanel().querySelector('.e-img-resize'));\n    };\n    Image.prototype.onWindowResize = function () {\n        if (!isNOU(this.contentModule) && !isNOU(this.contentModule.getEditPanel().querySelector('.e-img-resize'))) {\n            this.cancelResizeAction();\n        }\n    };\n    // eslint-disable-next-line\n    Image.prototype.imageUrlPopup = function (e) {\n        var _this = this;\n        var imgUrl = this.parent.createElement('div', { className: 'imgUrl' });\n        var placeUrl = this.i10n.getConstant('imageUrl');\n        this.inputUrl = this.parent.createElement('input', {\n            className: 'e-input e-img-url',\n            attrs: { placeholder: placeUrl, spellcheck: 'false' }\n        });\n        this.inputUrl.addEventListener('input', function () {\n            if (!isNOU(_this.inputUrl)) {\n                if (_this.inputUrl.value.length === 0) {\n                    _this.dialogObj.getButtons(0).element.disabled = true;\n                }\n                else {\n                    _this.dialogObj.getButtons(0).element.removeAttribute('disabled');\n                }\n            }\n        });\n        imgUrl.appendChild(this.inputUrl);\n        return imgUrl;\n    };\n    // eslint-disable-next-line\n    Image.prototype.insertImageUrl = function (e) {\n        var proxy = this.selfImage;\n        proxy.isImgUploaded = false;\n        var url = proxy.inputUrl.value;\n        if (proxy.parent.formatter.getUndoRedoStack().length === 0) {\n            proxy.parent.formatter.saveData();\n        }\n        if (!isNullOrUndefined(proxy.uploadUrl) && proxy.uploadUrl.url !== '') {\n            proxy.uploadUrl.cssClass = (proxy.parent.insertImageSettings.display === 'inline' ?\n                classes.CLS_IMGINLINE : classes.CLS_IMGBREAK);\n            proxy.dialogObj.hide({ returnValue: false });\n            proxy.parent.formatter.process(proxy.parent, this.args, this.args.originalEvent, proxy.uploadUrl);\n            proxy.uploadUrl.url = '';\n            if (proxy.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n                proxy.imgEle.style.outline = '';\n                proxy.removeResizeEle();\n            }\n        }\n        else if (url !== '') {\n            if (proxy.parent.editorMode === 'HTML' && isNullOrUndefined(closest(\n            // eslint-disable-next-line\n            this.selection.range.startContainer.parentNode, '[id=' + \"'\" + proxy.contentModule.getPanel().id + \"'\" + ']'))) {\n                proxy.contentModule.getEditPanel().focus();\n                var range = proxy.parent.formatter.editorManager.nodeSelection.getRange(proxy.contentModule.getDocument());\n                this.selection = proxy.parent.formatter.editorManager.nodeSelection.save(range, proxy.contentModule.getDocument());\n                this.selectParent = proxy.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n            }\n            var regex = /[\\w-]+.(jpg|png|jpeg|gif)/g;\n            var matchUrl = (!isNullOrUndefined(url.match(regex)) && proxy.parent.editorMode === 'HTML') ? url.match(regex)[0] : '';\n            var value = {\n                cssClass: (proxy.parent.insertImageSettings.display === 'inline' ? classes.CLS_IMGINLINE : classes.CLS_IMGBREAK),\n                url: url, selection: this.selection, altText: matchUrl,\n                selectParent: this.selectParent, width: {\n                    width: proxy.parent.insertImageSettings.width, minWidth: proxy.parent.insertImageSettings.minWidth,\n                    maxWidth: proxy.parent.getInsertImgMaxWidth()\n                },\n                height: {\n                    height: proxy.parent.insertImageSettings.height, minHeight: proxy.parent.insertImageSettings.minHeight,\n                    maxHeight: proxy.parent.insertImageSettings.maxHeight\n                }\n            };\n            proxy.parent.formatter.process(proxy.parent, this.args, this.args.originalEvent, value);\n            proxy.dialogObj.hide({ returnValue: false });\n        }\n    };\n    Image.prototype.imgsizeInput = function (e) {\n        var _this = this;\n        var selectNode = e.selectNode[0];\n        var imgHeight = this.i10n.getConstant('imageHeight');\n        var imgWidth = this.i10n.getConstant('imageWidth');\n        var imgSizeWrap = this.parent.createElement('div', { className: 'e-img-sizewrap' });\n        var widthVal = isNullOrUndefined(this.changedWidthValue) && (selectNode.style.width.toString() === 'auto' ||\n            selectNode.style.width !== '') ? selectNode.style.width : !isNullOrUndefined(this.changedWidthValue) ?\n            this.changedWidthValue : (parseInt(selectNode.getClientRects()[0].width.toString(), 10)).toString();\n        var heightVal = isNullOrUndefined(this.changedHeightValue) && (selectNode.style.height.toString() === 'auto' ||\n            selectNode.style.height !== '') ? selectNode.style.height : !isNullOrUndefined(this.changedHeightValue) ?\n            this.changedHeightValue : (parseInt(selectNode.getClientRects()[0].height.toString(), 10)).toString();\n        this.changedWidthValue = null;\n        this.changedHeightValue = null;\n        var content = '<div class=\"e-rte-label\"><label>' + imgWidth +\n            '</label></div><div class=\"e-rte-field\"><input type=\"text\" id=\"imgwidth\" class=\"e-img-width\" value=' +\n            widthVal\n            + ' /></div>' +\n            '<div class=\"e-rte-label\">' + '<label>' + imgHeight + '</label></div><div class=\"e-rte-field\"> ' +\n            '<input type=\"text\" id=\"imgheight\" class=\"e-img-height\" value=' +\n            heightVal\n            + ' /></div>';\n        var contentElem = parseHtml(content);\n        imgSizeWrap.appendChild(contentElem);\n        var widthNum = new TextBox({\n            value: formatUnit(widthVal),\n            enableRtl: this.parent.enableRtl,\n            input: function (e) {\n                _this.inputWidthValue = formatUnit(_this.inputValue(e.value));\n            }\n        });\n        widthNum.createElement = this.parent.createElement;\n        widthNum.appendTo(imgSizeWrap.querySelector('#imgwidth'));\n        var heightNum = new TextBox({\n            value: formatUnit(heightVal),\n            enableRtl: this.parent.enableRtl,\n            input: function (e) {\n                _this.inputHeightValue = formatUnit(_this.inputValue(e.value));\n            }\n        });\n        heightNum.createElement = this.parent.createElement;\n        heightNum.appendTo(imgSizeWrap.querySelector('#imgheight'));\n        return imgSizeWrap;\n    };\n    Image.prototype.inputValue = function (value) {\n        if (value === 'auto' || value.indexOf('%') !== -1 || value.indexOf('px') !== -1\n            || value.match(/(\\d+)/)) {\n            return value;\n        }\n        else {\n            return 'auto';\n        }\n    };\n    Image.prototype.insertSize = function (e) {\n        e.selection.restore();\n        var proxy = e.selfImage;\n        if (proxy.parent.formatter.getUndoRedoStack().length === 0) {\n            proxy.parent.formatter.saveData();\n        }\n        var dialogEle = proxy.dialogObj.element;\n        this.changedWidthValue = this.inputWidthValue;\n        this.changedHeightValue = this.inputHeightValue;\n        var width = dialogEle.querySelector('.e-img-width').value;\n        var height = dialogEle.parentElement.querySelector('.e-img-height').value;\n        proxy.parent.formatter.process(this.parent, e.args, e.args, {\n            width: width, height: height, selectNode: e.selectNode,\n            subCommand: e.args.item.subCommand\n        });\n        if (this.imgResizeDiv) {\n            proxy.imgResizePos(e.selectNode[0], this.imgResizeDiv);\n        }\n        proxy.dialogObj.hide({ returnValue: true });\n    };\n    Image.prototype.insertImage = function (e) {\n        this.imagDialog(e);\n        if (!isNullOrUndefined(this.dialogObj)) {\n            this.dialogObj.element.style.maxHeight = 'inherit';\n            var dialogContent = this.dialogObj.element.querySelector('.e-img-content');\n            if (((!isNullOrUndefined(this.parent.insertImageSettings.path) && this.parent.editorMode === 'Markdown')\n                || this.parent.editorMode === 'HTML')) {\n                document.getElementById(this.rteID + '_insertImage').focus();\n            }\n            else {\n                dialogContent.querySelector('.e-img-url').focus();\n            }\n        }\n    };\n    Image.prototype.imgUpload = function (e) {\n        var _this = this;\n        var save;\n        var selectParent;\n        // eslint-disable-next-line\n        var proxy = this;\n        var iframe = proxy.parent.iframeSettings.enable;\n        if (proxy.parent.editorMode === 'HTML' && (!iframe && isNullOrUndefined(closest(e.selection.range.startContainer.parentNode, '[id='\n            // eslint-disable-next-line\n            + \"'\" + this.parent.contentModule.getPanel().id + \"'\" + ']'))\n            || (iframe && !hasClass(e.selection.range.startContainer.parentNode.ownerDocument.querySelector('body'), 'e-lib')))) {\n            this.contentModule.getEditPanel().focus();\n            var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n            save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n            selectParent = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n        }\n        else {\n            save = e.selection;\n            selectParent = e.selectParent;\n        }\n        var uploadParentEle = this.parent.createElement('div', { className: 'e-img-uploadwrap e-droparea' });\n        var deviceImgUpMsg = this.i10n.getConstant('imageDeviceUploadMessage');\n        var imgUpMsg = this.i10n.getConstant('imageUploadMessage');\n        var span = this.parent.createElement('span', { className: 'e-droptext' });\n        var spanMsg = this.parent.createElement('span', {\n            className: 'e-rte-upload-text', innerHTML: ((Browser.isDevice) ? deviceImgUpMsg : imgUpMsg)\n        });\n        span.appendChild(spanMsg);\n        var btnEle = this.parent.createElement('button', {\n            className: 'e-browsebtn', id: this.rteID + '_insertImage', attrs: { autofocus: 'true', type: 'button' }\n        });\n        span.appendChild(btnEle);\n        uploadParentEle.appendChild(span);\n        var browserMsg = this.i10n.getConstant('browse');\n        var button = new Button({ content: browserMsg, enableRtl: this.parent.enableRtl });\n        button.isStringTemplate = true;\n        button.createElement = this.parent.createElement;\n        button.appendTo(btnEle);\n        var btnClick = (Browser.isDevice) ? span : btnEle;\n        EventHandler.add(btnClick, 'click', this.fileSelect, this);\n        var uploadEle = this.parent.createElement('input', {\n            id: this.rteID + '_upload', attrs: { type: 'File', name: 'UploadFiles' }\n        });\n        uploadParentEle.appendChild(uploadEle);\n        var altText;\n        var rawFile;\n        var selectArgs;\n        var filesData;\n        var beforeUploadArgs;\n        this.uploadObj = new Uploader({\n            asyncSettings: { saveUrl: this.parent.insertImageSettings.saveUrl, removeUrl: this.parent.insertImageSettings.removeUrl },\n            dropArea: span, multiple: false, enableRtl: this.parent.enableRtl,\n            allowedExtensions: this.parent.insertImageSettings.allowedTypes.toString(),\n            selected: function (e) {\n                proxy.isImgUploaded = true;\n                selectArgs = e;\n                filesData = e.filesData;\n                if (_this.parent.isServerRendered) {\n                    selectArgs = JSON.parse(JSON.stringify(e));\n                    e.cancel = true;\n                    rawFile = e.filesData;\n                    selectArgs.filesData = rawFile;\n                }\n                _this.parent.trigger(events.imageSelected, selectArgs, function (selectArgs) {\n                    if (!selectArgs.cancel) {\n                        _this.checkExtension(selectArgs.filesData[0]);\n                        altText = selectArgs.filesData[0].name;\n                        if (_this.parent.editorMode === 'HTML' && isNullOrUndefined(_this.parent.insertImageSettings.path)) {\n                            var reader_1 = new FileReader();\n                            // eslint-disable-next-line\n                            reader_1.addEventListener('load', function (e) {\n                                var url = _this.parent.insertImageSettings.saveFormat === 'Base64' ? reader_1.result :\n                                    URL.createObjectURL(convertToBlob(reader_1.result));\n                                proxy.uploadUrl = {\n                                    url: url, selection: save, altText: altText,\n                                    selectParent: selectParent,\n                                    width: {\n                                        width: proxy.parent.insertImageSettings.width, minWidth: proxy.parent.insertImageSettings.minWidth,\n                                        maxWidth: proxy.parent.getInsertImgMaxWidth()\n                                    }, height: {\n                                        height: proxy.parent.insertImageSettings.height,\n                                        minHeight: proxy.parent.insertImageSettings.minHeight,\n                                        maxHeight: proxy.parent.insertImageSettings.maxHeight\n                                    }\n                                };\n                                proxy.inputUrl.setAttribute('disabled', 'true');\n                                if (isNullOrUndefined(proxy.parent.insertImageSettings.saveUrl) && _this.isAllowedTypes\n                                    && !isNullOrUndefined(_this.dialogObj)) {\n                                    _this.dialogObj.getButtons(0).element.removeAttribute('disabled');\n                                }\n                            });\n                            reader_1.readAsDataURL(selectArgs.filesData[0].rawFile);\n                        }\n                        if (_this.parent.isServerRendered) {\n                            /* eslint-disable */\n                            _this.uploadObj._internalRenderSelect(selectArgs, rawFile);\n                            /* eslint-enable */\n                        }\n                    }\n                });\n            },\n            beforeUpload: function (args) {\n                if (_this.parent.isServerRendered) {\n                    beforeUploadArgs = JSON.parse(JSON.stringify(args));\n                    beforeUploadArgs.filesData = filesData;\n                    args.cancel = true;\n                    _this.parent.trigger(events.imageUploading, beforeUploadArgs, function (beforeUploadArgs) {\n                        if (beforeUploadArgs.cancel) {\n                            return;\n                        }\n                        /* eslint-disable */\n                        _this.uploadObj.currentRequestHeader = beforeUploadArgs.currentRequest ?\n                            beforeUploadArgs.currentRequest : _this.uploadObj.currentRequestHeader;\n                        _this.uploadObj.customFormDatas = beforeUploadArgs.customFormData && beforeUploadArgs.customFormData.length > 0 ?\n                            beforeUploadArgs.customFormData : _this.uploadObj.customFormDatas;\n                        _this.uploadObj.uploadFiles(rawFile, null);\n                        /* eslint-enable */\n                    });\n                }\n                else {\n                    _this.parent.trigger(events.beforeImageUpload, args);\n                }\n            },\n            uploading: function (e) {\n                if (!_this.parent.isServerRendered) {\n                    _this.parent.trigger(events.imageUploading, e);\n                }\n            },\n            success: function (e) {\n                _this.parent.trigger(events.imageUploadSuccess, e, function (e) {\n                    if (!isNullOrUndefined(_this.parent.insertImageSettings.path)) {\n                        var url = _this.parent.insertImageSettings.path + e.file.name;\n                        // eslint-disable-next-line\n                        var value = { url: url, selection: save };\n                        proxy.uploadUrl = {\n                            url: url, selection: save, altText: altText, selectParent: selectParent,\n                            width: {\n                                width: proxy.parent.insertImageSettings.width, minWidth: proxy.parent.insertImageSettings.minWidth,\n                                maxWidth: proxy.parent.getInsertImgMaxWidth()\n                            }, height: {\n                                height: proxy.parent.insertImageSettings.height, minHeight: proxy.parent.insertImageSettings.minHeight,\n                                maxHeight: proxy.parent.insertImageSettings.maxHeight\n                            }\n                        };\n                        proxy.inputUrl.setAttribute('disabled', 'true');\n                    }\n                    if (e.operation === 'upload' && !isNullOrUndefined(_this.dialogObj)) {\n                        _this.dialogObj.getButtons(0).element.removeAttribute('disabled');\n                    }\n                });\n            },\n            failure: function (e) {\n                _this.parent.trigger(events.imageUploadFailed, e);\n            },\n            removing: function () {\n                // eslint-disable-next-line\n                _this.parent.trigger(events.imageRemoving, e, function (e) {\n                    proxy.isImgUploaded = false;\n                    _this.dialogObj.getButtons(0).element.disabled = true;\n                    proxy.inputUrl.removeAttribute('disabled');\n                    if (proxy.uploadUrl) {\n                        proxy.uploadUrl.url = '';\n                    }\n                });\n            }\n        });\n        this.uploadObj.isStringTemplate = true;\n        this.uploadObj.createElement = this.parent.createElement;\n        this.uploadObj.appendTo(uploadEle);\n        return uploadParentEle;\n    };\n    Image.prototype.checkExtension = function (e) {\n        if (this.uploadObj.allowedExtensions) {\n            if (this.uploadObj.allowedExtensions.toLocaleLowerCase().indexOf(('.' + e.type).toLocaleLowerCase()) === -1) {\n                this.dialogObj.getButtons(0).element.setAttribute('disabled', 'disabled');\n                this.isAllowedTypes = false;\n            }\n            else {\n                this.isAllowedTypes = true;\n            }\n        }\n    };\n    Image.prototype.fileSelect = function () {\n        this.dialogObj.element.getElementsByClassName('e-file-select-wrap')[0].querySelector('button').click();\n        return false;\n    };\n    Image.prototype.dragStart = function (e) {\n        if (e.target.nodeName === 'IMG') {\n            this.parent.trigger(events.actionBegin, e, function (actionBeginArgs) {\n                if (actionBeginArgs.cancel) {\n                    e.preventDefault();\n                }\n                else {\n                    e.dataTransfer.effectAllowed = 'copyMove';\n                    e.target.classList.add(classes.CLS_RTE_DRAG_IMAGE);\n                }\n            });\n        }\n        else {\n            return true;\n        }\n    };\n    Image.prototype.dragEnter = function (e) {\n        e.dataTransfer.dropEffect = 'copy';\n        e.preventDefault();\n    };\n    Image.prototype.dragOver = function (e) {\n        if ((Browser.info.name === 'edge' && e.dataTransfer.items[0].type.split('/')[0].indexOf('image') > -1) ||\n            (Browser.isIE && e.dataTransfer.types[0] === 'Files')) {\n            e.preventDefault();\n        }\n        else {\n            return true;\n        }\n    };\n    /**\n     * Used to set range When drop an image\n     *\n     * @param {ImageDropEventArgs} args - specifies the image arguments.\n     * @returns {void}\n     */\n    Image.prototype.dragDrop = function (args) {\n        var _this = this;\n        this.parent.trigger(events.beforeImageDrop, args, function (e) {\n            var imgElement = _this.parent.inputElement.ownerDocument.querySelector('.' + classes.CLS_RTE_DRAG_IMAGE);\n            var isImgOrFileDrop = (imgElement && imgElement.tagName === 'IMG') || e.dataTransfer.files.length > 0;\n            if (!e.cancel && isImgOrFileDrop) {\n                _this.parent.trigger(events.actionBegin, e, function (actionBeginArgs) {\n                    if (actionBeginArgs.cancel) {\n                        e.preventDefault();\n                    }\n                    else {\n                        if (closest(e.target, '#' + _this.parent.getID() + '_toolbar') ||\n                            _this.parent.inputElement.contentEditable === 'false') {\n                            e.preventDefault();\n                            return;\n                        }\n                        if (_this.parent.element.querySelector('.' + classes.CLS_IMG_RESIZE)) {\n                            detach(_this.imgResizeDiv);\n                        }\n                        e.preventDefault();\n                        var range = void 0;\n                        if (_this.contentModule.getDocument().caretRangeFromPoint) { //For chrome\n                            range = _this.contentModule.getDocument().caretRangeFromPoint(e.clientX, e.clientY);\n                        }\n                        else if ((e.rangeParent)) { //For mozilla firefox\n                            range = _this.contentModule.getDocument().createRange();\n                            range.setStart(e.rangeParent, e.rangeOffset);\n                        }\n                        else {\n                            range = _this.getDropRange(e.clientX, e.clientY); //For internet explorer\n                        }\n                        _this.parent.notify(events.selectRange, { range: range });\n                        var uploadArea = _this.parent.element.querySelector('.' + classes.CLS_DROPAREA);\n                        if (uploadArea) {\n                            return;\n                        }\n                        _this.insertDragImage(e);\n                    }\n                });\n            }\n            else {\n                if (isImgOrFileDrop) {\n                    e.preventDefault();\n                }\n            }\n        });\n    };\n    /**\n     * Used to calculate range on internet explorer\n     *\n     * @param {number} x - specifies the x range.\n     * @param {number} y - specifies the y range.\n     * @returns {void}\n     */\n    Image.prototype.getDropRange = function (x, y) {\n        var startRange = this.contentModule.getDocument().createRange();\n        this.parent.formatter.editorManager.nodeSelection.setRange(this.contentModule.getDocument(), startRange);\n        var elem = this.contentModule.getDocument().elementFromPoint(x, y);\n        var startNode = (elem.childNodes.length > 0 ? elem.childNodes[0] : elem);\n        var startCharIndexCharacter = 0;\n        if (this.parent.inputElement.firstChild.innerHTML === '<br>') {\n            startRange.setStart(startNode, startCharIndexCharacter);\n            startRange.setEnd(startNode, startCharIndexCharacter);\n        }\n        else {\n            var rangeRect = void 0;\n            do {\n                startCharIndexCharacter++;\n                startRange.setStart(startNode, startCharIndexCharacter);\n                startRange.setEnd(startNode, startCharIndexCharacter + 1);\n                rangeRect = startRange.getBoundingClientRect();\n            } while (rangeRect.left < x && startCharIndexCharacter < startNode.length - 1);\n        }\n        return startRange;\n    };\n    Image.prototype.insertDragImage = function (e) {\n        var _this = this;\n        e.preventDefault();\n        var activePopupElement = this.parent.element.querySelector('' + classes.CLS_POPUP_OPEN);\n        this.parent.notify(events.drop, { args: e });\n        if (activePopupElement) {\n            activePopupElement.classList.add(classes.CLS_HIDE);\n        }\n        var imgElement = this.parent.inputElement.ownerDocument.querySelector('.' + classes.CLS_RTE_DRAG_IMAGE);\n        if (e.dataTransfer.files.length > 0 && imgElement === null) { //For external image drag and drop\n            if (e.dataTransfer.files.length > 1) {\n                return;\n            }\n            var imgFiles = e.dataTransfer.files;\n            var fileName = imgFiles[0].name;\n            var imgType = fileName.substring(fileName.lastIndexOf('.'));\n            var allowedTypes = this.parent.insertImageSettings.allowedTypes;\n            for (var i = 0; i < allowedTypes.length; i++) {\n                if (imgType.toLocaleLowerCase() === allowedTypes[i].toLowerCase()) {\n                    if (this.parent.insertImageSettings.saveUrl) {\n                        this.onSelect(e);\n                    }\n                    else {\n                        var args = { args: e, text: '', file: imgFiles[0] };\n                        e.preventDefault();\n                        this.imagePaste(args);\n                    }\n                }\n            }\n        }\n        else { //For internal image drag and drop\n            var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n            if (imgElement && imgElement.tagName === 'IMG') {\n                if (imgElement.nextElementSibling) {\n                    if (imgElement.nextElementSibling.classList.contains(classes.CLS_IMG_INNER)) {\n                        range.insertNode(imgElement.parentElement.parentElement);\n                    }\n                    else {\n                        range.insertNode(imgElement);\n                    }\n                }\n                else {\n                    range.insertNode(imgElement);\n                }\n                imgElement.classList.remove(classes.CLS_RTE_DRAG_IMAGE);\n                var imgArgs_1 = { elements: [imgElement] };\n                imgElement.addEventListener('load', function () {\n                    _this.parent.trigger(events.actionComplete, imgArgs_1);\n                });\n                this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument());\n                var args = e;\n                this.resizeStart(args, imgElement);\n                this.hideImageQuickToolbar();\n            }\n        }\n    };\n    Image.prototype.onSelect = function (args) {\n        var _this = this;\n        // eslint-disable-next-line\n        var proxy = this;\n        var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n        var parentElement = this.parent.createElement('ul', { className: classes.CLS_UPLOAD_FILES });\n        this.parent.element.appendChild(parentElement);\n        var validFiles = {\n            name: '',\n            size: 0,\n            status: '',\n            statusCode: '',\n            type: '',\n            rawFile: args.dataTransfer.files[0],\n            validationMessages: {}\n        };\n        var imageTag = this.parent.createElement('IMG');\n        imageTag.style.opacity = '0.5';\n        imageTag.classList.add(classes.CLS_RTE_IMAGE);\n        imageTag.classList.add(classes.CLS_IMGINLINE);\n        imageTag.classList.add(classes.CLS_RESIZE);\n        var file = validFiles.rawFile;\n        var reader = new FileReader();\n        reader.addEventListener('load', function () {\n            var url = URL.createObjectURL(convertToBlob(reader.result));\n            imageTag.src = proxy.parent.insertImageSettings.saveFormat === 'Blob' ? url : reader.result;\n        });\n        if (file) {\n            reader.readAsDataURL(file);\n        }\n        range.insertNode(imageTag);\n        this.uploadMethod(args, imageTag);\n        var e = { elements: [imageTag] };\n        imageTag.addEventListener('load', function () {\n            _this.parent.trigger(events.actionComplete, e);\n        });\n        detach(parentElement);\n    };\n    /**\n     * Rendering uploader and popup for drag and drop\n     *\n     * @param {DragEvent} dragEvent - specifies the event.\n     * @param {HTMLImageElement} imageElement - specifies the element.\n     * @returns {void}\n     */\n    Image.prototype.uploadMethod = function (dragEvent, imageElement) {\n        var _this = this;\n        var isUploading = false;\n        // eslint-disable-next-line\n        var proxy = this;\n        var popupEle = this.parent.createElement('div');\n        this.parent.element.appendChild(popupEle);\n        var uploadEle = this.parent.createElement('input', {\n            id: this.rteID + '_upload', attrs: { type: 'File', name: 'UploadFiles' }\n        });\n        var offsetY = this.parent.iframeSettings.enable ? -50 : -90;\n        this.popupObj = new Popup(popupEle, {\n            relateTo: imageElement,\n            height: '85px',\n            width: '300px',\n            offsetY: offsetY,\n            content: uploadEle,\n            viewPortElement: this.parent.element,\n            position: { X: 'center', Y: 'top' },\n            enableRtl: this.parent.enableRtl,\n            zIndex: 10001,\n            // eslint-disable-next-line\n            close: function (event) {\n                _this.parent.isBlur = false;\n                _this.popupObj.destroy();\n                detach(_this.popupObj.element);\n                _this.popupObj = null;\n                if (!_this.parent.inlineMode.enable) {\n                    _this.parent.toolbarModule.baseToolbar.toolbarObj.disable(false);\n                }\n            }\n        });\n        this.popupObj.element.style.display = 'none';\n        addClass([this.popupObj.element], classes.CLS_POPUP_OPEN);\n        addClass([this.popupObj.element], classes.CLS_RTE_UPLOAD_POPUP);\n        var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n        var timeOut = dragEvent.dataTransfer.files[0].size > 1000000 ? 300 : 100;\n        setTimeout(function () {\n            proxy.refreshPopup(imageElement);\n        }, timeOut);\n        var rawFile;\n        var beforeUploadArgs;\n        this.uploadObj = new Uploader({\n            asyncSettings: {\n                saveUrl: this.parent.insertImageSettings.saveUrl,\n                removeUrl: this.parent.insertImageSettings.removeUrl\n            },\n            cssClass: classes.CLS_RTE_DIALOG_UPLOAD,\n            dropArea: this.parent.element,\n            allowedExtensions: this.parent.insertImageSettings.allowedTypes.toString(),\n            removing: function () {\n                _this.parent.inputElement.contentEditable = 'true';\n                isUploading = false;\n                detach(imageElement);\n                _this.popupObj.close();\n            },\n            canceling: function () {\n                _this.parent.inputElement.contentEditable = 'true';\n                isUploading = false;\n                detach(imageElement);\n                _this.popupObj.close();\n                _this.quickToolObj.imageQTBar.hidePopup();\n                setTimeout(function () {\n                    _this.uploadObj.destroy();\n                }, 900);\n            },\n            beforeUpload: function (args) {\n                if (_this.parent.isServerRendered) {\n                    beforeUploadArgs = JSON.parse(JSON.stringify(args));\n                    beforeUploadArgs.filesData = rawFile;\n                    isUploading = true;\n                    args.cancel = true;\n                    _this.parent.trigger(events.imageUploading, beforeUploadArgs, function (beforeUploadArgs) {\n                        if (beforeUploadArgs.cancel) {\n                            return;\n                        }\n                        if (!_this.parent.inlineMode.enable) {\n                            _this.parent.toolbarModule.baseToolbar.toolbarObj.disable(true);\n                        }\n                        /* eslint-disable */\n                        _this.uploadObj.currentRequestHeader = beforeUploadArgs.currentRequest ?\n                            beforeUploadArgs.currentRequest : _this.uploadObj.currentRequestHeader;\n                        _this.uploadObj.customFormDatas = beforeUploadArgs.customFormData && beforeUploadArgs.customFormData.length > 0 ?\n                            beforeUploadArgs.customFormData : _this.uploadObj.customFormDatas;\n                        _this.uploadObj.uploadFiles(rawFile, null);\n                        _this.parent.inputElement.contentEditable = 'false';\n                        /* eslint-enable */\n                    });\n                }\n                else {\n                    _this.parent.trigger(events.beforeImageUpload, args);\n                    if (!_this.parent.inlineMode.enable) {\n                        _this.parent.toolbarModule.baseToolbar.toolbarObj.disable(true);\n                    }\n                }\n            },\n            uploading: function (e) {\n                if (!_this.parent.isServerRendered) {\n                    isUploading = true;\n                    _this.parent.trigger(events.imageUploading, e, function (imageUploadingArgs) {\n                        if (imageUploadingArgs.cancel) {\n                            if (!isNullOrUndefined(imageElement)) {\n                                detach(imageElement);\n                            }\n                            if (!isNullOrUndefined(_this.popupObj.element)) {\n                                detach(_this.popupObj.element);\n                            }\n                        }\n                        else {\n                            _this.parent.inputElement.contentEditable = 'false';\n                        }\n                    });\n                }\n            },\n            selected: function (e) {\n                if (isUploading) {\n                    e.cancel = true;\n                }\n                if (_this.parent.isServerRendered) {\n                    rawFile = e.filesData;\n                }\n            },\n            failure: function (e) {\n                isUploading = false;\n                _this.parent.inputElement.contentEditable = 'true';\n                var args = {\n                    args: dragEvent,\n                    type: 'Images',\n                    isNotify: undefined,\n                    elements: imageElement\n                };\n                setTimeout(function () {\n                    _this.uploadFailure(imageElement, args, e);\n                }, 900);\n            },\n            success: function (e) {\n                if (e.operation === \"cancel\") {\n                    return;\n                }\n                isUploading = false;\n                _this.parent.inputElement.contentEditable = 'true';\n                var args = {\n                    args: dragEvent,\n                    type: 'Images',\n                    isNotify: undefined,\n                    elements: imageElement\n                };\n                setTimeout(function () {\n                    _this.uploadSuccess(imageElement, dragEvent, args, e);\n                }, 900);\n            }\n        });\n        this.uploadObj.appendTo(this.popupObj.element.childNodes[0]);\n        this.popupObj.element.querySelector('.e-rte-dialog-upload .e-file-select-wrap').style.display = 'none';\n        range.selectNodeContents(imageElement);\n        this.parent.formatter.editorManager.nodeSelection.setRange(this.contentModule.getDocument(), range);\n    };\n    Image.prototype.refreshPopup = function (imageElement) {\n        var imgPosition = this.parent.iframeSettings.enable ? this.parent.element.offsetTop +\n            imageElement.offsetTop : imageElement.offsetTop;\n        var rtePosition = this.parent.element.offsetTop + this.parent.element.offsetHeight;\n        if (imgPosition > rtePosition) {\n            this.popupObj.relateTo = this.parent.inputElement;\n            this.popupObj.offsetY = this.parent.iframeSettings.enable ? -30 : -65;\n            this.popupObj.element.style.display = 'block';\n        }\n        else {\n            if (this.popupObj) {\n                this.popupObj.refreshPosition(imageElement);\n                this.popupObj.element.style.display = 'block';\n            }\n        }\n    };\n    /**\n     * Called when drop image upload was failed\n     *\n     * @param {HTMLElement} imgEle - specifies the image element.\n     * @param {IShowPopupArgs} args - specifies the arguments.\n     * @param {Object} e - specfies the object.\n     * @returns {void}\n     */\n    Image.prototype.uploadFailure = function (imgEle, args, e) {\n        detach(imgEle);\n        if (this.popupObj) {\n            this.popupObj.close();\n        }\n        this.parent.trigger(events.imageUploadFailed, e);\n        this.uploadObj.destroy();\n    };\n    /**\n     * Called when drop image upload was successful\n     *\n     * @param {HTMLElement} imageElement - specifies the image element.\n     * @param {DragEvent} dragEvent - specifies the drag event.\n     * @param {IShowPopupArgs} args - specifies the arguments.\n     * @param {ImageSuccessEventArgs} e - specifies the success event.\n     * @returns {void}\n     */\n    Image.prototype.uploadSuccess = function (imageElement, dragEvent, args, e) {\n        var _this = this;\n        imageElement.style.opacity = '1';\n        imageElement.classList.add(classes.CLS_IMG_FOCUS);\n        e.element = imageElement;\n        this.parent.trigger(events.imageUploadSuccess, e, function (e) {\n            if (!isNullOrUndefined(_this.parent.insertImageSettings.path)) {\n                var url = _this.parent.insertImageSettings.path + e.file.name;\n                imageElement.src = url;\n                imageElement.setAttribute('alt', e.file.name);\n            }\n        });\n        if (this.popupObj) {\n            this.popupObj.close();\n            this.uploadObj.destroy();\n        }\n        this.showImageQuickToolbar(args);\n        this.resizeStart(dragEvent, imageElement);\n    };\n    Image.prototype.imagePaste = function (args) {\n        var _this = this;\n        if (args.text.length === 0 && !isNullOrUndefined(args.file)) {\n            // eslint-disable-next-line\n            var proxy_1 = this;\n            var reader_2 = new FileReader();\n            args.args.preventDefault();\n            // eslint-disable-next-line\n            reader_2.addEventListener('load', function (e) {\n                var url = {\n                    cssClass: (proxy_1.parent.insertImageSettings.display === 'inline' ? classes.CLS_IMGINLINE : classes.CLS_IMGBREAK),\n                    url: _this.parent.insertImageSettings.saveFormat === 'Base64' || !isNullOrUndefined(args.callBack) ?\n                        reader_2.result : URL.createObjectURL(convertToBlob(reader_2.result)),\n                    width: {\n                        width: proxy_1.parent.insertImageSettings.width, minWidth: proxy_1.parent.insertImageSettings.minWidth,\n                        maxWidth: proxy_1.parent.getInsertImgMaxWidth()\n                    },\n                    height: {\n                        height: proxy_1.parent.insertImageSettings.height, minHeight: proxy_1.parent.insertImageSettings.minHeight,\n                        maxHeight: proxy_1.parent.insertImageSettings.maxHeight\n                    }\n                };\n                if (!isNullOrUndefined(args.callBack)) {\n                    args.callBack(url);\n                    return;\n                }\n                else {\n                    proxy_1.parent.formatter.process(proxy_1.parent, { item: { command: 'Images', subCommand: 'Image' } }, args.args, url);\n                    _this.showPopupToolBar(args, url);\n                }\n            });\n            reader_2.readAsDataURL(args.file);\n        }\n    };\n    Image.prototype.showPopupToolBar = function (e, url) {\n        var _this = this;\n        var imageSrc = 'img[src=\"' + url.url + '\"]';\n        var imageElement = this.parent.inputElement.querySelector(imageSrc);\n        this.parent.quickToolbarModule.createQTBar('Image', 'MultiRow', this.parent.quickToolbarSettings.image, RenderType.ImageToolbar);\n        var args = {\n            args: e.args,\n            type: 'Images',\n            isNotify: undefined,\n            elements: imageElement\n        };\n        if (imageElement) {\n            setTimeout(function () {\n                _this.showImageQuickToolbar(args);\n                _this.resizeStart(e.args, imageElement);\n            }, 0);\n        }\n    };\n    /* eslint-disable */\n    /**\n     * Destroys the ToolBar.\n     *\n     * @method destroy\n     * @returns {void}\n     * @hidden\n\n     */\n    /* eslint-enable */\n    Image.prototype.destroy = function () {\n        this.prevSelectedImgEle = undefined;\n        this.removeEventListener();\n    };\n    /**\n     * For internal use only - Get the module name.\n     *\n     * @returns {void}\n     */\n    Image.prototype.getModuleName = function () {\n        return 'image';\n    };\n    return Image;\n}());\nexport { Image };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}