{"ast":null,"code":"import * as CONSTANT from './../base/constant';\nimport { append, detach, createElement, isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { NodeSelection } from './../../selection/index';\nimport { selfClosingTags } from '../../common/config';\nimport { getLastTextNode } from '../../common/util';\nexport var markerClassName = {\n  startSelection: 'e-editor-select-start',\n  endSelection: 'e-editor-select-end'\n};\n/**\n * DOMNode internal plugin\n *\n * @hidden\n\n */\nvar DOMNode = /** @class */function () {\n  /**\n   * Constructor for creating the DOMNode plugin\n   *\n   * @param {Element} parent - specifies the parent element\n   * @param {Document} currentDocument - specifies the current document.\n   * @hidden\n    */\n  function DOMNode(parent, currentDocument) {\n    this.parent = parent;\n    this.nodeSelection = new NodeSelection();\n    this.currentDocument = currentDocument;\n  }\n  /**\n   * contents method\n   *\n   * @param {Element} element - specifies the element.\n   * @returns {void}\n   * @hidden\n    */\n  DOMNode.prototype.contents = function (element) {\n    return element && 'IFRAME' !== element.tagName ? Array.prototype.slice.call(element.childNodes || []) : [];\n  };\n  /**\n   * isBlockNode method\n   *\n   * @param {Element} element - specifies the node element.\n   * @returns {boolean} - sepcifies the boolean value\n   * @hidden\n    */\n  DOMNode.prototype.isBlockNode = function (element) {\n    return !!element && element.nodeType === Node.ELEMENT_NODE && CONSTANT.BLOCK_TAGS.indexOf(element.tagName.toLowerCase()) >= 0;\n  };\n  /**\n   * isLink method\n   *\n   * @param {Element} element - specifies the element\n   * @returns {boolean} -  specifies the boolean value\n   * @hidden\n    */\n  DOMNode.prototype.isLink = function (element) {\n    return !!element && element.nodeType === Node.ELEMENT_NODE && 'a' === element.tagName.toLowerCase();\n  };\n  /**\n   * blockParentNode method\n   *\n   * @param {Element} element - specifies the element\n   * @returns {Element} - returns the element value\n   * @hidden\n    */\n  DOMNode.prototype.blockParentNode = function (element) {\n    for (; element && element.parentNode !== this.parent && (!element.parentNode || !this.hasClass(element.parentNode, 'e-node-inner')); null) {\n      element = element.parentNode;\n      if (this.isBlockNode(element)) {\n        return element;\n      }\n    }\n    return element;\n  };\n  /**\n   * rawAttributes method\n   *\n   * @param {Element} element - specifies the element\n   * @returns {string} - returns the string value\n   * @hidden\n    */\n  DOMNode.prototype.rawAttributes = function (element) {\n    var rawAttr = {};\n    var attributes = element.attributes;\n    if (attributes.length > 0) {\n      for (var d = 0; d < attributes.length; d++) {\n        var e = attributes[d];\n        rawAttr[e.nodeName] = e.value;\n      }\n    }\n    return rawAttr;\n  };\n  /**\n   * attributes method\n   *\n   * @param {Element} element - sepcifies the element.\n   * @returns {string} - returns the string value.\n   * @hidden\n    */\n  DOMNode.prototype.attributes = function (element) {\n    if (!element) {\n      return '';\n    }\n    var attr = '';\n    var rawAttr = this.rawAttributes(element);\n    var orderRawAttr = Object.keys(rawAttr).sort();\n    for (var e = 0; e < orderRawAttr.length; e++) {\n      var attrKey = orderRawAttr[e];\n      var attrValue = rawAttr[attrKey];\n      /* eslint-disable */\n      if (attrValue.indexOf(\"'\") < 0 && attrValue.indexOf('\"') >= 0) {\n        attr += ' ' + attrKey + \"='\" + attrValue + \"'\";\n      } else if (attrValue.indexOf('\"') >= 0 && attrValue.indexOf(\"'\") >= 0) {\n        /* eslint-enable */\n        attrValue = attrValue.replace(/\"/g, '&quot;');\n        attr += ' ' + attrKey + '=\"' + attrValue + '\"';\n      } else {\n        attr += ' ' + attrKey + '=\"' + attrValue + '\"';\n      }\n    }\n    return attr;\n  };\n  /**\n   * clearAttributes method\n   *\n   * @param {Element} element - specifies the element\n   * @returns {void}\n   * @hidden\n    */\n  DOMNode.prototype.clearAttributes = function (element) {\n    for (var attr = element.attributes, c = attr.length - 1; c >= 0; c--) {\n      var key = attr[c];\n      element.removeAttribute(key.nodeName);\n    }\n  };\n  /**\n   * openTagString method\n   *\n   * @param {Element} element - specifies the element.\n   * @returns {string} - returns the string\n   * @hidden\n    */\n  DOMNode.prototype.openTagString = function (element) {\n    return '<' + element.tagName.toLowerCase() + this.attributes(element) + '>';\n  };\n  /**\n   * closeTagString method\n   *\n   * @param {Element} element - specifies the element\n   * @returns {string} - returns the string value\n   * @hidden\n    */\n  DOMNode.prototype.closeTagString = function (element) {\n    return '</' + element.tagName.toLowerCase() + '>';\n  };\n  /**\n   * createTagString method\n   *\n   * @param {string} tagName - specifies the tag name\n   * @param {Element} relativeElement - specifies the relative element\n   * @param {string} innerHTML - specifies the string value\n   * @returns {string} - returns the string value.\n   * @hidden\n    */\n  DOMNode.prototype.createTagString = function (tagName, relativeElement, innerHTML) {\n    return '<' + tagName.toLowerCase() + this.attributes(relativeElement) + '>' + innerHTML + '</' + tagName.toLowerCase() + '>';\n  };\n  /**\n   * isList method\n   *\n   * @param {Element} element - specifes the element.\n   * @returns {boolean} - returns the boolean value\n   * @hidden\n    */\n  DOMNode.prototype.isList = function (element) {\n    return !!element && ['UL', 'OL'].indexOf(element.tagName) >= 0;\n  };\n  /**\n   * isElement method\n   *\n   * @param {Element} element - specifes the element.\n   * @returns {boolean} - returns the boolean value\n   * @hidden\n    */\n  DOMNode.prototype.isElement = function (element) {\n    return element === this.parent;\n  };\n  /**\n   * isEditable method\n   *\n   * @param {Element} element - specifes the element.\n   * @returns {boolean} - returns the boolean value\n   * @hidden\n    */\n  DOMNode.prototype.isEditable = function (element) {\n    return (!element.getAttribute || element.getAttribute('contenteditable') === 'true') && ['STYLE', 'SCRIPT'].indexOf(element.tagName) < 0;\n  };\n  /**\n   * hasClass method\n   *\n   * @param {Element} element - specifes the element.\n   * @param {string} className - specifies the class name value\n   * @returns {boolean} - returns the boolean value\n   * @hidden\n    */\n  DOMNode.prototype.hasClass = function (element, className) {\n    return element && element.classList && element.classList.contains(className);\n  };\n  /**\n   * replaceWith method\n   *\n   * @param {Element} element - specifes the element.\n   * @param {string} value - specifies the string value\n   * @returns {void}\n   * @hidden\n    */\n  DOMNode.prototype.replaceWith = function (element, value) {\n    var parentNode = element.parentNode;\n    parentNode.insertBefore(this.parseHTMLFragment(value), element);\n    detach(element);\n  };\n  /**\n   * parseHTMLFragment method\n   *\n   * @param {string} value - specifies the string value\n   * @returns {Element} - returns the element\n   * @hidden\n    */\n  DOMNode.prototype.parseHTMLFragment = function (value) {\n    /* eslint-disable */\n    var temp = createElement('template');\n    temp.innerHTML = value;\n    if (temp.content instanceof DocumentFragment) {\n      return temp.content;\n    } else {\n      return document.createRange().createContextualFragment(value);\n    }\n    /* eslint-enable */\n  };\n  /**\n   * wrap method\n   *\n   * @param {Element} element - specifies the element\n   * @param {Element} wrapper - specifies the element.\n   * @returns {Element} - returns the element\n   * @hidden\n    */\n  DOMNode.prototype.wrap = function (element, wrapper) {\n    element.parentNode.insertBefore(wrapper, element);\n    wrapper = element.previousSibling;\n    wrapper.appendChild(element);\n    return wrapper;\n  };\n  /**\n   * insertAfter method\n   *\n   * @param {Element} newNode - specifies the new node element\n   * @param {Element} referenceNode - specifies the referenece node\n   * @returns {void}\n   * @hidden\n    */\n  DOMNode.prototype.insertAfter = function (newNode, referenceNode) {\n    referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);\n  };\n  /**\n   * wrapInner method\n   *\n   * @param {Element} parent - specifies the parent element.\n   * @param {Element} wrapper - specifies the wrapper element.\n   * @returns {Element} - returns the element\n   * @hidden\n    */\n  DOMNode.prototype.wrapInner = function (parent, wrapper) {\n    parent.appendChild(wrapper);\n    wrapper = parent.querySelector('.e-rte-wrap-inner');\n    wrapper.classList.remove('e-rte-wrap-inner');\n    if (wrapper.classList.length === 0) {\n      wrapper.removeAttribute('class');\n    }\n    while (parent.firstChild !== wrapper) {\n      wrapper.appendChild(parent.firstChild);\n    }\n    return wrapper;\n  };\n  /**\n   * unWrap method\n   *\n   * @param {Element} element - specifies the element.\n   * @returns {Element} - returns the element.\n   * @hidden\n    */\n  DOMNode.prototype.unWrap = function (element) {\n    var parent = element.parentNode;\n    var unWrapNode = [];\n    while (element.firstChild) {\n      unWrapNode.push(element.firstChild);\n      parent.insertBefore(element.firstChild, element);\n    }\n    unWrapNode = unWrapNode.length > 0 ? unWrapNode : [element.parentNode];\n    parent.removeChild(element);\n    return unWrapNode;\n  };\n  /**\n   * getSelectedNode method\n   *\n   * @param {Element} element - specifies the element\n   * @param {number} index - specifies the index value.\n   * @returns {Element} - returns the element\n   * @hidden\n    */\n  DOMNode.prototype.getSelectedNode = function (element, index) {\n    if (element.nodeType === Node.ELEMENT_NODE && element.childNodes.length > 0 && element.childNodes[index - 1] && element.childNodes[index - 1].nodeType === Node.ELEMENT_NODE && (element.childNodes[index - 1].classList.contains(markerClassName.startSelection) || element.childNodes[index - 1].classList.contains(markerClassName.endSelection))) {\n      element = element.childNodes[index - 1];\n    } else if (element.nodeType === Node.ELEMENT_NODE && element.childNodes.length > 0 && element.childNodes[index]) {\n      element = element.childNodes[index];\n    }\n    if (element.nodeType === Node.TEXT_NODE) {\n      element = element.parentNode;\n    }\n    return element;\n  };\n  /**\n   * nodeFinds method\n   *\n   * @param {Element} element - specifies the element.\n   * @param {Element[]} elements - specifies the array of elements\n   * @returns {Element[]} - returnts the array elements\n   * @hidden\n    */\n  DOMNode.prototype.nodeFinds = function (element, elements) {\n    var existNodes = [];\n    for (var i = 0; i < elements.length; i++) {\n      if (element.contains(elements[i]) && element !== elements[i]) {\n        existNodes.push(elements[i]);\n      }\n    }\n    return existNodes;\n  };\n  /**\n   * isEditorArea method\n   *\n   * @returns {boolean} - returns the boolean value\n   * @hidden\n    */\n  DOMNode.prototype.isEditorArea = function () {\n    var range = this.getRangePoint(0);\n    var element;\n    for (element = range.commonAncestorContainer; element && !this.isElement(element); null) {\n      element = element.parentNode;\n    }\n    return !!this.isElement(element);\n  };\n  /**\n   * getRangePoint method\n   *\n   * @param {number} point - specifies the number value.\n   * @returns {Range} - returns the range.\n   * @hidden\n    */\n  DOMNode.prototype.getRangePoint = function (point) {\n    var selection = this.getSelection();\n    var ranges = [];\n    if (selection && selection.getRangeAt && selection.rangeCount) {\n      ranges = [];\n      for (var f = 0; f < selection.rangeCount; f++) {\n        ranges.push(selection.getRangeAt(f));\n      }\n    } else {\n      ranges = [this.currentDocument.createRange()];\n    }\n    return 'undefined' !== typeof point ? ranges[point] : ranges;\n  };\n  DOMNode.prototype.getSelection = function () {\n    return this.nodeSelection.get(this.currentDocument);\n  };\n  /**\n   * getPreviousNode method\n   *\n   * @param {Element} element - specifies the element\n   * @returns {Element} - returns the element\n   * @hidden\n    */\n  DOMNode.prototype.getPreviousNode = function (element) {\n    element = element.previousElementSibling;\n    for (; element && element.textContent === '\\n'; null) {\n      element = element.previousElementSibling;\n    }\n    return element;\n  };\n  /**\n   * encode method\n   *\n   * @param {string} value - specifies the string value\n   * @returns {string} - specifies the string value\n   * @hidden\n    */\n  DOMNode.prototype.encode = function (value) {\n    var divNode = document.createElement('div');\n    divNode.innerText = value;\n    // eslint-disable-next-line\n    return divNode.innerHTML.replace(/<br\\s*[\\/]?>/gi, '\\n');\n  };\n  /**\n   * saveMarker method\n   *\n   * @param {NodeSelection} save - specifies the node selection,\n   * @param {string} action - specifies the action  value.\n   * @returns {NodeSelection} - returns the value\n   * @hidden\n    */\n  DOMNode.prototype.saveMarker = function (save, action) {\n    var start = this.parent.querySelector('.' + markerClassName.startSelection);\n    var end = this.parent.querySelector('.' + markerClassName.endSelection);\n    var startTextNode;\n    var endTextNode;\n    if (start.textContent === '' && isNullOrUndefined(end) && action !== 'tab') {\n      if (start.childNodes.length === 1 && start.childNodes[0].nodeName === 'BR') {\n        start.innerHTML = '&#65279;&#65279;<br>';\n      } else {\n        start.innerHTML = '&#65279;&#65279;';\n      }\n    }\n    if (this.hasClass(start, markerClassName.startSelection) && start.classList.length > 1) {\n      var replace = this.createTagString(CONSTANT.DEFAULT_TAG, start, this.encode(start.textContent));\n      this.replaceWith(start, replace);\n      start = this.parent.querySelector('.' + markerClassName.startSelection);\n      start.classList.remove(markerClassName.startSelection);\n      startTextNode = start.childNodes[0];\n    } else {\n      startTextNode = this.unWrap(start)[0];\n    }\n    if (this.hasClass(end, markerClassName.endSelection) && end.classList.length > 1) {\n      var replace = this.createTagString(CONSTANT.DEFAULT_TAG, end, this.encode(end.textContent));\n      this.replaceWith(end, replace);\n      end = this.parent.querySelector('.' + markerClassName.endSelection);\n      end.classList.remove(markerClassName.endSelection);\n      endTextNode = end.childNodes[0];\n    } else {\n      endTextNode = end ? this.unWrap(end)[0] : startTextNode;\n    }\n    save.startContainer = save.getNodeArray(startTextNode, true);\n    save.endContainer = save.getNodeArray(endTextNode, false);\n    return save;\n  };\n  DOMNode.prototype.marker = function (className, textContent) {\n    return '<span class=\"' + className + '\">' + textContent + '</span>';\n  };\n  /**\n   * setMarker method\n   *\n   * @param {NodeSelection} save - specifies the node selection.\n   * @returns {void}\n   * @hidden\n    */\n  DOMNode.prototype.setMarker = function (save) {\n    var range = save.range;\n    var startChildNodes = range.startContainer.childNodes;\n    var isTableStart = startChildNodes.length > 1 && startChildNodes[0].nodeName === 'TABLE';\n    var start = (isTableStart ? getLastTextNode(startChildNodes[range.startOffset + 1]) : startChildNodes[range.startOffset > 0 ? range.startOffset - 1 : range.startOffset]) || range.startContainer;\n    var end = range.endContainer.childNodes[range.endOffset > 0 ? range.endOffset - 1 : range.endOffset] || range.endContainer;\n    if (start.nodeType === Node.ELEMENT_NODE && end.nodeType === Node.ELEMENT_NODE && (start.contains(end) || end.contains(start))) {\n      var existNode = start.contains(end) ? start : end;\n      var isElement = existNode.nodeType !== Node.TEXT_NODE;\n      if (isElement) {\n        var nodes = [];\n        var textNodes = [];\n        for (var node = existNode; existNode.contains(node); null) {\n          if (nodes.indexOf(node) < 0 && node.childNodes && node.childNodes.length) {\n            nodes.push(node);\n            node = node.childNodes[0];\n          } else if (node.nextSibling) {\n            node = node.nextSibling;\n          } else if (node.parentNode) {\n            node = node.parentNode;\n            nodes.push(node);\n          }\n          if (textNodes.indexOf(node) < 0 && (node.nodeType === Node.TEXT_NODE || CONSTANT.IGNORE_BLOCK_TAGS.indexOf(node.parentNode.tagName.toLocaleLowerCase()) >= 0 && (node.tagName === 'BR' || node.tagName === 'IMG'))) {\n            textNodes.push(node);\n          }\n        }\n        if (textNodes.length) {\n          start = start.contains(end) ? textNodes[0] : start;\n          end = textNodes[textNodes.length - 1];\n        }\n      }\n    }\n    if (start !== end) {\n      if (start.nodeType !== Node.TEXT_NODE && (start.tagName === 'BR' && CONSTANT.IGNORE_BLOCK_TAGS.indexOf(start.parentNode.tagName.toLocaleLowerCase()) >= 0 || start.tagName === 'IMG')) {\n        this.replaceWith(start, this.marker(markerClassName.startSelection, this.encode(start.textContent)));\n        var markerStart = range.startContainer.querySelector('.' + markerClassName.startSelection);\n        markerStart.appendChild(start);\n      } else {\n        this.replaceWith(start, this.marker(markerClassName.startSelection, this.encode(start.textContent)));\n      }\n      if (end.nodeType !== Node.TEXT_NODE && end.tagName === 'BR' && CONSTANT.IGNORE_BLOCK_TAGS.indexOf(end.parentNode.tagName.toLocaleLowerCase()) >= 0) {\n        this.replaceWith(end, this.marker(markerClassName.endSelection, this.encode(end.textContent)));\n        var markerEnd = range.endContainer.querySelector('.' + markerClassName.endSelection);\n        markerEnd.appendChild(end);\n      } else {\n        this.ensureSelfClosingTag(end, markerClassName.endSelection, range);\n      }\n    } else {\n      this.ensureSelfClosingTag(start, markerClassName.startSelection, range);\n    }\n  };\n  /**\n   * ensureSelfClosingTag method\n   *\n   * @param {Element} start - specifies the element.\n   * @param {string} className - specifes the class name string value\n   * @param {Range} range - specifies the range value\n   * @returns {void}\n   * @hidden\n    */\n  DOMNode.prototype.ensureSelfClosingTag = function (start, className, range) {\n    var isTable = false;\n    if (start.nodeType === 3) {\n      this.replaceWith(start, this.marker(className, this.encode(start.textContent)));\n    } else if (start.tagName === 'BR') {\n      this.replaceWith(start, this.marker(className, this.encode(start.textContent)));\n      var markerStart = range.startContainer.querySelector('.' + className);\n      markerStart.appendChild(start);\n    } else {\n      if (start.tagName === 'IMG') {\n        var parNode = document.createElement('p');\n        start.parentElement.insertBefore(parNode, start);\n        parNode.appendChild(start);\n        start = parNode.children[0];\n      }\n      if (start.tagName === 'TABLE') {\n        isTable = true;\n        if (start.textContent === '') {\n          var tdNode = start.querySelectorAll('td');\n          start = tdNode[tdNode.length - 1];\n          start = !isNullOrUndefined(start.childNodes[0]) ? start.childNodes[0] : start;\n        } else {\n          var lastNode = start.lastChild;\n          while (lastNode.nodeType !== 3 && lastNode.nodeName !== '#text' && lastNode.nodeName !== 'BR') {\n            lastNode = lastNode.lastChild;\n          }\n          start = lastNode;\n        }\n      }\n      for (var i = 0; i < selfClosingTags.length; i++) {\n        start = start.tagName === selfClosingTags[i] && !isTable ? start.parentNode : start;\n      }\n      if (start.nodeType === 3 && start.nodeName === '#text') {\n        this.replaceWith(start, this.marker(className, this.encode(start.textContent)));\n      } else if (start.nodeName === 'BR') {\n        this.replaceWith(start, this.marker(markerClassName.endSelection, this.encode(start.textContent)));\n        var markerEnd = range.endContainer.querySelector('.' + markerClassName.endSelection);\n        markerEnd.appendChild(start);\n      } else {\n        var marker = this.marker(className, '');\n        append([this.parseHTMLFragment(marker)], start);\n      }\n    }\n  };\n  /**\n   * createTempNode method\n   *\n   * @param {Element} element - specifies the element.\n   * @returns {Element} - returns the element\n   * @hidden\n    */\n  DOMNode.prototype.createTempNode = function (element) {\n    var textContent = element.textContent;\n    if (element.tagName === 'BR') {\n      var wrapper = '<' + CONSTANT.DEFAULT_TAG + '></' + CONSTANT.DEFAULT_TAG + '>';\n      var node = element.parentNode;\n      if (CONSTANT.IGNORE_BLOCK_TAGS.indexOf(node.tagName.toLocaleLowerCase()) >= 0) {\n        element = this.wrap(element, this.parseHTMLFragment(wrapper));\n      }\n    } else if (element.nodeType !== Node.TEXT_NODE && (element.classList.contains(markerClassName.startSelection) || element.classList.contains(markerClassName.endSelection)) || textContent.replace(/\\n/g, '').replace(/(^ *)|( *$)/g, '').length > 0 || textContent.length && textContent.indexOf('\\n') < 0) {\n      var wrapper = '<' + CONSTANT.DEFAULT_TAG + '></' + CONSTANT.DEFAULT_TAG + '>';\n      var target = element;\n      element = this.wrap(element, this.parseHTMLFragment(wrapper));\n      var ignoreBr = target.nodeType === Node.ELEMENT_NODE && target.firstChild && target.firstChild.nodeName === 'BR' && (target.classList.contains(markerClassName.startSelection) || target.classList.contains(markerClassName.endSelection));\n      if (!ignoreBr && element.nextElementSibling && element.nextElementSibling.tagName === 'BR') {\n        element.appendChild(element.nextElementSibling);\n      }\n    }\n    return element;\n  };\n  /**\n   * getImageTagInSelection method\n   *\n   * @returns {void}\n   * @hidden\n    */\n  DOMNode.prototype.getImageTagInSelection = function () {\n    var selection = this.getSelection();\n    if (this.isEditorArea() && selection.rangeCount) {\n      return selection.focusNode.querySelectorAll('img');\n    }\n    return null;\n  };\n  /**\n   * blockNodes method\n   *\n   * @returns {Node[]} - returns the node array values\n   * @hidden\n    */\n  DOMNode.prototype.blockNodes = function () {\n    var collectionNodes = [];\n    var selection = this.getSelection();\n    if (this.isEditorArea() && selection.rangeCount) {\n      var ranges = this.getRangePoint();\n      for (var j = 0; j < ranges.length; j++) {\n        var parentNode = void 0;\n        var range = ranges[j];\n        var startNode = this.getSelectedNode(range.startContainer, range.startOffset);\n        var endNode = this.getSelectedNode(range.endContainer, range.endOffset);\n        if (this.isBlockNode(startNode) && collectionNodes.indexOf(startNode) < 0) {\n          collectionNodes.push(startNode);\n        }\n        parentNode = this.blockParentNode(startNode);\n        if (parentNode && collectionNodes.indexOf(parentNode) < 0) {\n          if (CONSTANT.IGNORE_BLOCK_TAGS.indexOf(parentNode.tagName.toLocaleLowerCase()) >= 0 && (startNode.tagName === 'BR' || startNode.nodeType === Node.TEXT_NODE || startNode.classList.contains(markerClassName.startSelection) || startNode.classList.contains(markerClassName.endSelection))) {\n            var tempNode = startNode.previousSibling && startNode.previousSibling.nodeType === Node.TEXT_NODE ? startNode.previousSibling : startNode;\n            if (!startNode.nextSibling && !startNode.previousSibling && startNode.tagName === 'BR') {\n              collectionNodes.push(tempNode);\n            } else {\n              collectionNodes.push(this.createTempNode(tempNode));\n            }\n          } else {\n            collectionNodes.push(parentNode);\n          }\n        }\n        var nodes = [];\n        for (var node = startNode; node !== endNode && node !== this.parent; null) {\n          if (nodes.indexOf(node) < 0 && node.childNodes && node.childNodes.length) {\n            nodes.push(node);\n            node = node.childNodes[0];\n          } else if (node && node.nodeType !== 8 && (node.tagName === 'BR' || node.nodeType === Node.TEXT_NODE && node.textContent.trim() !== '' || node.nodeType !== Node.TEXT_NODE && (node.classList.contains(markerClassName.startSelection) || node.classList.contains(markerClassName.endSelection))) && CONSTANT.IGNORE_BLOCK_TAGS.indexOf(node.parentNode.tagName.toLocaleLowerCase()) >= 0) {\n            node = this.createTempNode(node);\n          } else if (node.nextSibling && node.nextSibling.nodeType !== 8 && (node.nextSibling.tagName === 'BR' || node.nextSibling.nodeType === Node.TEXT_NODE || node.nextSibling.classList.contains(markerClassName.startSelection) || node.nextSibling.classList.contains(markerClassName.endSelection)) && CONSTANT.IGNORE_BLOCK_TAGS.indexOf(node.nextSibling.parentNode.tagName.toLocaleLowerCase()) >= 0) {\n            node = this.createTempNode(node.nextSibling);\n          } else if (node.nextSibling) {\n            node = node.nextSibling;\n          } else if (node.parentNode) {\n            node = node.parentNode;\n            nodes.push(node);\n          }\n          if (collectionNodes.indexOf(node) < 0 && node.nodeType === Node.ELEMENT_NODE && CONSTANT.IGNORE_BLOCK_TAGS.indexOf(node.parentNode.tagName.toLocaleLowerCase()) >= 0 && (node.classList.contains(markerClassName.startSelection) || node.classList.contains(markerClassName.endSelection))) {\n            collectionNodes.push(this.createTempNode(node));\n          }\n          if (this.isBlockNode(node) && this.ignoreTableTag(node) && nodes.indexOf(node) < 0 && collectionNodes.indexOf(node) < 0 && (node !== endNode || range.endOffset > 0)) {\n            collectionNodes.push(node);\n          }\n          if (node.nodeName === 'IMG' && node.parentElement.contentEditable === 'true') {\n            collectionNodes.push(node);\n          }\n        }\n        parentNode = this.blockParentNode(endNode);\n        if (parentNode && this.ignoreTableTag(parentNode) && collectionNodes.indexOf(parentNode) < 0 && !isNullOrUndefined(parentNode.previousElementSibling) && parentNode.previousElementSibling.tagName !== 'IMG') {\n          collectionNodes.push(parentNode);\n        }\n      }\n    }\n    for (var i = collectionNodes.length - 1; i > 0; i--) {\n      var nodes = this.nodeFinds(collectionNodes[i], collectionNodes);\n      if (nodes.length) {\n        var listNodes = collectionNodes[i].querySelectorAll('ul, ol');\n        if (collectionNodes[i].tagName === 'LI' && listNodes.length > 0) {\n          continue;\n        } else {\n          collectionNodes.splice(i, 1);\n        }\n      }\n    }\n    return collectionNodes;\n  };\n  DOMNode.prototype.ignoreTableTag = function (element) {\n    return !(CONSTANT.TABLE_BLOCK_TAGS.indexOf(element.tagName.toLocaleLowerCase()) >= 0);\n  };\n  return DOMNode;\n}();\nexport { DOMNode };","map":{"version":3,"names":["CONSTANT","append","detach","createElement","isNullOrUndefined","NodeSelection","selfClosingTags","getLastTextNode","markerClassName","startSelection","endSelection","DOMNode","parent","currentDocument","nodeSelection","prototype","contents","element","tagName","Array","slice","call","childNodes","isBlockNode","nodeType","Node","ELEMENT_NODE","BLOCK_TAGS","indexOf","toLowerCase","isLink","blockParentNode","parentNode","hasClass","rawAttributes","rawAttr","attributes","length","d","e","nodeName","value","attr","orderRawAttr","Object","keys","sort","attrKey","attrValue","replace","clearAttributes","c","key","removeAttribute","openTagString","closeTagString","createTagString","relativeElement","innerHTML","isList","isElement","isEditable","getAttribute","className","classList","contains","replaceWith","insertBefore","parseHTMLFragment","temp","content","DocumentFragment","document","createRange","createContextualFragment","wrap","wrapper","previousSibling","appendChild","insertAfter","newNode","referenceNode","nextSibling","wrapInner","querySelector","remove","firstChild","unWrap","unWrapNode","push","removeChild","getSelectedNode","index","TEXT_NODE","nodeFinds","elements","existNodes","i","isEditorArea","range","getRangePoint","commonAncestorContainer","point","selection","getSelection","ranges","getRangeAt","rangeCount","f","get","getPreviousNode","previousElementSibling","textContent","encode","divNode","innerText","saveMarker","save","action","start","end","startTextNode","endTextNode","DEFAULT_TAG","startContainer","getNodeArray","endContainer","marker","setMarker","startChildNodes","isTableStart","startOffset","endOffset","existNode","nodes","textNodes","node","IGNORE_BLOCK_TAGS","toLocaleLowerCase","markerStart","markerEnd","ensureSelfClosingTag","isTable","parNode","parentElement","children","tdNode","querySelectorAll","lastNode","lastChild","createTempNode","target","ignoreBr","nextElementSibling","getImageTagInSelection","focusNode","blockNodes","collectionNodes","j","startNode","endNode","tempNode","trim","ignoreTableTag","contentEditable","listNodes","splice","TABLE_BLOCK_TAGS"],"sources":["D:/USPERSO IMPLEMENTATION/Projet_DevIII/frontend/node_modules/@syncfusion/ej2-richtexteditor/src/editor-manager/plugin/dom-node.js"],"sourcesContent":["import * as CONSTANT from './../base/constant';\nimport { append, detach, createElement, isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { NodeSelection } from './../../selection/index';\nimport { selfClosingTags } from '../../common/config';\nimport { getLastTextNode } from '../../common/util';\nexport var markerClassName = {\n    startSelection: 'e-editor-select-start',\n    endSelection: 'e-editor-select-end'\n};\n/**\n * DOMNode internal plugin\n *\n * @hidden\n\n */\nvar DOMNode = /** @class */ (function () {\n    /**\n     * Constructor for creating the DOMNode plugin\n     *\n     * @param {Element} parent - specifies the parent element\n     * @param {Document} currentDocument - specifies the current document.\n     * @hidden\n\n     */\n    function DOMNode(parent, currentDocument) {\n        this.parent = parent;\n        this.nodeSelection = new NodeSelection();\n        this.currentDocument = currentDocument;\n    }\n    /**\n     * contents method\n     *\n     * @param {Element} element - specifies the element.\n     * @returns {void}\n     * @hidden\n\n     */\n    DOMNode.prototype.contents = function (element) {\n        return (element && 'IFRAME' !== element.tagName ? Array.prototype.slice.call(element.childNodes || []) : []);\n    };\n    /**\n     * isBlockNode method\n     *\n     * @param {Element} element - specifies the node element.\n     * @returns {boolean} - sepcifies the boolean value\n     * @hidden\n\n     */\n    DOMNode.prototype.isBlockNode = function (element) {\n        return (!!element && (element.nodeType === Node.ELEMENT_NODE && CONSTANT.BLOCK_TAGS.indexOf(element.tagName.toLowerCase()) >= 0));\n    };\n    /**\n     * isLink method\n     *\n     * @param {Element} element - specifies the element\n     * @returns {boolean} -  specifies the boolean value\n     * @hidden\n\n     */\n    DOMNode.prototype.isLink = function (element) {\n        return (!!element && (element.nodeType === Node.ELEMENT_NODE && 'a' === element.tagName.toLowerCase()));\n    };\n    /**\n     * blockParentNode method\n     *\n     * @param {Element} element - specifies the element\n     * @returns {Element} - returns the element value\n     * @hidden\n\n     */\n    DOMNode.prototype.blockParentNode = function (element) {\n        for (; element && element.parentNode !== this.parent && ((!element.parentNode ||\n            !this.hasClass(element.parentNode, 'e-node-inner'))); null) {\n            element = element.parentNode;\n            if (this.isBlockNode(element)) {\n                return element;\n            }\n        }\n        return element;\n    };\n    /**\n     * rawAttributes method\n     *\n     * @param {Element} element - specifies the element\n     * @returns {string} - returns the string value\n     * @hidden\n\n     */\n    DOMNode.prototype.rawAttributes = function (element) {\n        var rawAttr = {};\n        var attributes = element.attributes;\n        if (attributes.length > 0) {\n            for (var d = 0; d < attributes.length; d++) {\n                var e = attributes[d];\n                rawAttr[e.nodeName] = e.value;\n            }\n        }\n        return rawAttr;\n    };\n    /**\n     * attributes method\n     *\n     * @param {Element} element - sepcifies the element.\n     * @returns {string} - returns the string value.\n     * @hidden\n\n     */\n    DOMNode.prototype.attributes = function (element) {\n        if (!element) {\n            return '';\n        }\n        var attr = '';\n        var rawAttr = this.rawAttributes(element);\n        var orderRawAttr = Object.keys(rawAttr).sort();\n        for (var e = 0; e < orderRawAttr.length; e++) {\n            var attrKey = orderRawAttr[e];\n            var attrValue = rawAttr[attrKey];\n            /* eslint-disable */\n            if (attrValue.indexOf(\"'\") < 0 && attrValue.indexOf('\"') >= 0) {\n                attr += ' ' + attrKey + \"='\" + attrValue + \"'\";\n            }\n            else if (attrValue.indexOf('\"') >= 0 && attrValue.indexOf(\"'\") >= 0) {\n                /* eslint-enable */\n                attrValue = attrValue.replace(/\"/g, '&quot;');\n                attr += ' ' + attrKey + '=\"' + attrValue + '\"';\n            }\n            else {\n                attr += ' ' + attrKey + '=\"' + attrValue + '\"';\n            }\n        }\n        return attr;\n    };\n    /**\n     * clearAttributes method\n     *\n     * @param {Element} element - specifies the element\n     * @returns {void}\n     * @hidden\n\n     */\n    DOMNode.prototype.clearAttributes = function (element) {\n        for (var attr = element.attributes, c = attr.length - 1; c >= 0; c--) {\n            var key = attr[c];\n            element.removeAttribute(key.nodeName);\n        }\n    };\n    /**\n     * openTagString method\n     *\n     * @param {Element} element - specifies the element.\n     * @returns {string} - returns the string\n     * @hidden\n\n     */\n    DOMNode.prototype.openTagString = function (element) {\n        return '<' + element.tagName.toLowerCase() + this.attributes(element) + '>';\n    };\n    /**\n     * closeTagString method\n     *\n     * @param {Element} element - specifies the element\n     * @returns {string} - returns the string value\n     * @hidden\n\n     */\n    DOMNode.prototype.closeTagString = function (element) {\n        return '</' + element.tagName.toLowerCase() + '>';\n    };\n    /**\n     * createTagString method\n     *\n     * @param {string} tagName - specifies the tag name\n     * @param {Element} relativeElement - specifies the relative element\n     * @param {string} innerHTML - specifies the string value\n     * @returns {string} - returns the string value.\n     * @hidden\n\n     */\n    DOMNode.prototype.createTagString = function (tagName, relativeElement, innerHTML) {\n        return '<' + tagName.toLowerCase() + this.attributes(relativeElement) + '>' + innerHTML + '</' + tagName.toLowerCase() + '>';\n    };\n    /**\n     * isList method\n     *\n     * @param {Element} element - specifes the element.\n     * @returns {boolean} - returns the boolean value\n     * @hidden\n\n     */\n    DOMNode.prototype.isList = function (element) {\n        return !!element && ['UL', 'OL'].indexOf(element.tagName) >= 0;\n    };\n    /**\n     * isElement method\n     *\n     * @param {Element} element - specifes the element.\n     * @returns {boolean} - returns the boolean value\n     * @hidden\n\n     */\n    DOMNode.prototype.isElement = function (element) {\n        return element === this.parent;\n    };\n    /**\n     * isEditable method\n     *\n     * @param {Element} element - specifes the element.\n     * @returns {boolean} - returns the boolean value\n     * @hidden\n\n     */\n    DOMNode.prototype.isEditable = function (element) {\n        return ((!element.getAttribute || element.getAttribute('contenteditable') === 'true')\n            && ['STYLE', 'SCRIPT'].indexOf(element.tagName) < 0);\n    };\n    /**\n     * hasClass method\n     *\n     * @param {Element} element - specifes the element.\n     * @param {string} className - specifies the class name value\n     * @returns {boolean} - returns the boolean value\n     * @hidden\n\n     */\n    DOMNode.prototype.hasClass = function (element, className) {\n        return element && element.classList && element.classList.contains(className);\n    };\n    /**\n     * replaceWith method\n     *\n     * @param {Element} element - specifes the element.\n     * @param {string} value - specifies the string value\n     * @returns {void}\n     * @hidden\n\n     */\n    DOMNode.prototype.replaceWith = function (element, value) {\n        var parentNode = element.parentNode;\n        parentNode.insertBefore(this.parseHTMLFragment(value), element);\n        detach(element);\n    };\n    /**\n     * parseHTMLFragment method\n     *\n     * @param {string} value - specifies the string value\n     * @returns {Element} - returns the element\n     * @hidden\n\n     */\n    DOMNode.prototype.parseHTMLFragment = function (value) {\n        /* eslint-disable */\n        var temp = createElement('template');\n        temp.innerHTML = value;\n        if (temp.content instanceof DocumentFragment) {\n            return temp.content;\n        }\n        else {\n            return document.createRange().createContextualFragment(value);\n        }\n        /* eslint-enable */\n    };\n    /**\n     * wrap method\n     *\n     * @param {Element} element - specifies the element\n     * @param {Element} wrapper - specifies the element.\n     * @returns {Element} - returns the element\n     * @hidden\n\n     */\n    DOMNode.prototype.wrap = function (element, wrapper) {\n        element.parentNode.insertBefore(wrapper, element);\n        wrapper = element.previousSibling;\n        wrapper.appendChild(element);\n        return wrapper;\n    };\n    /**\n     * insertAfter method\n     *\n     * @param {Element} newNode - specifies the new node element\n     * @param {Element} referenceNode - specifies the referenece node\n     * @returns {void}\n     * @hidden\n\n     */\n    DOMNode.prototype.insertAfter = function (newNode, referenceNode) {\n        referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);\n    };\n    /**\n     * wrapInner method\n     *\n     * @param {Element} parent - specifies the parent element.\n     * @param {Element} wrapper - specifies the wrapper element.\n     * @returns {Element} - returns the element\n     * @hidden\n\n     */\n    DOMNode.prototype.wrapInner = function (parent, wrapper) {\n        parent.appendChild(wrapper);\n        wrapper = parent.querySelector('.e-rte-wrap-inner');\n        wrapper.classList.remove('e-rte-wrap-inner');\n        if (wrapper.classList.length === 0) {\n            wrapper.removeAttribute('class');\n        }\n        while (parent.firstChild !== wrapper) {\n            wrapper.appendChild(parent.firstChild);\n        }\n        return wrapper;\n    };\n    /**\n     * unWrap method\n     *\n     * @param {Element} element - specifies the element.\n     * @returns {Element} - returns the element.\n     * @hidden\n\n     */\n    DOMNode.prototype.unWrap = function (element) {\n        var parent = element.parentNode;\n        var unWrapNode = [];\n        while (element.firstChild) {\n            unWrapNode.push(element.firstChild);\n            parent.insertBefore(element.firstChild, element);\n        }\n        unWrapNode = unWrapNode.length > 0 ? unWrapNode : [element.parentNode];\n        parent.removeChild(element);\n        return unWrapNode;\n    };\n    /**\n     * getSelectedNode method\n     *\n     * @param {Element} element - specifies the element\n     * @param {number} index - specifies the index value.\n     * @returns {Element} - returns the element\n     * @hidden\n\n     */\n    DOMNode.prototype.getSelectedNode = function (element, index) {\n        if (element.nodeType === Node.ELEMENT_NODE && element.childNodes.length > 0 &&\n            element.childNodes[index - 1] && element.childNodes[index - 1].nodeType === Node.ELEMENT_NODE &&\n            (element.childNodes[index - 1].classList.contains(markerClassName.startSelection) ||\n                element.childNodes[index - 1].classList.contains(markerClassName.endSelection))) {\n            element = element.childNodes[index - 1];\n        }\n        else if (element.nodeType === Node.ELEMENT_NODE && element.childNodes.length > 0 && element.childNodes[index]) {\n            element = element.childNodes[index];\n        }\n        if (element.nodeType === Node.TEXT_NODE) {\n            element = element.parentNode;\n        }\n        return element;\n    };\n    /**\n     * nodeFinds method\n     *\n     * @param {Element} element - specifies the element.\n     * @param {Element[]} elements - specifies the array of elements\n     * @returns {Element[]} - returnts the array elements\n     * @hidden\n\n     */\n    DOMNode.prototype.nodeFinds = function (element, elements) {\n        var existNodes = [];\n        for (var i = 0; i < elements.length; i++) {\n            if (element.contains(elements[i]) && element !== elements[i]) {\n                existNodes.push(elements[i]);\n            }\n        }\n        return existNodes;\n    };\n    /**\n     * isEditorArea method\n     *\n     * @returns {boolean} - returns the boolean value\n     * @hidden\n\n     */\n    DOMNode.prototype.isEditorArea = function () {\n        var range = this.getRangePoint(0);\n        var element;\n        for (element = range.commonAncestorContainer; element && !this.isElement(element); null) {\n            element = element.parentNode;\n        }\n        return !!this.isElement(element);\n    };\n    /**\n     * getRangePoint method\n     *\n     * @param {number} point - specifies the number value.\n     * @returns {Range} - returns the range.\n     * @hidden\n\n     */\n    DOMNode.prototype.getRangePoint = function (point) {\n        var selection = this.getSelection();\n        var ranges = [];\n        if (selection && selection.getRangeAt && selection.rangeCount) {\n            ranges = [];\n            for (var f = 0; f < selection.rangeCount; f++) {\n                ranges.push(selection.getRangeAt(f));\n            }\n        }\n        else {\n            ranges = [this.currentDocument.createRange()];\n        }\n        return 'undefined' !== typeof point ? ranges[point] : ranges;\n    };\n    DOMNode.prototype.getSelection = function () {\n        return this.nodeSelection.get(this.currentDocument);\n    };\n    /**\n     * getPreviousNode method\n     *\n     * @param {Element} element - specifies the element\n     * @returns {Element} - returns the element\n     * @hidden\n\n     */\n    DOMNode.prototype.getPreviousNode = function (element) {\n        element = element.previousElementSibling;\n        for (; element && element.textContent === '\\n'; null) {\n            element = element.previousElementSibling;\n        }\n        return element;\n    };\n    /**\n     * encode method\n     *\n     * @param {string} value - specifies the string value\n     * @returns {string} - specifies the string value\n     * @hidden\n\n     */\n    DOMNode.prototype.encode = function (value) {\n        var divNode = document.createElement('div');\n        divNode.innerText = value;\n        // eslint-disable-next-line\n        return divNode.innerHTML.replace(/<br\\s*[\\/]?>/gi, '\\n');\n    };\n    /**\n     * saveMarker method\n     *\n     * @param {NodeSelection} save - specifies the node selection,\n     * @param {string} action - specifies the action  value.\n     * @returns {NodeSelection} - returns the value\n     * @hidden\n\n     */\n    DOMNode.prototype.saveMarker = function (save, action) {\n        var start = this.parent.querySelector('.' + markerClassName.startSelection);\n        var end = this.parent.querySelector('.' + markerClassName.endSelection);\n        var startTextNode;\n        var endTextNode;\n        if (start.textContent === '' && isNullOrUndefined(end) && action !== 'tab') {\n            if (start.childNodes.length === 1 && start.childNodes[0].nodeName === 'BR') {\n                start.innerHTML = '&#65279;&#65279;<br>';\n            }\n            else {\n                start.innerHTML = '&#65279;&#65279;';\n            }\n        }\n        if (this.hasClass(start, markerClassName.startSelection) && start.classList.length > 1) {\n            var replace = this.createTagString(CONSTANT.DEFAULT_TAG, start, this.encode(start.textContent));\n            this.replaceWith(start, replace);\n            start = this.parent.querySelector('.' + markerClassName.startSelection);\n            start.classList.remove(markerClassName.startSelection);\n            startTextNode = start.childNodes[0];\n        }\n        else {\n            startTextNode = this.unWrap(start)[0];\n        }\n        if (this.hasClass(end, markerClassName.endSelection) && end.classList.length > 1) {\n            var replace = this.createTagString(CONSTANT.DEFAULT_TAG, end, this.encode(end.textContent));\n            this.replaceWith(end, replace);\n            end = this.parent.querySelector('.' + markerClassName.endSelection);\n            end.classList.remove(markerClassName.endSelection);\n            endTextNode = end.childNodes[0];\n        }\n        else {\n            endTextNode = end ? this.unWrap(end)[0] : startTextNode;\n        }\n        save.startContainer = save.getNodeArray(startTextNode, true);\n        save.endContainer = save.getNodeArray(endTextNode, false);\n        return save;\n    };\n    DOMNode.prototype.marker = function (className, textContent) {\n        return '<span class=\"' + className + '\">' + textContent + '</span>';\n    };\n    /**\n     * setMarker method\n     *\n     * @param {NodeSelection} save - specifies the node selection.\n     * @returns {void}\n     * @hidden\n\n     */\n    DOMNode.prototype.setMarker = function (save) {\n        var range = save.range;\n        var startChildNodes = range.startContainer.childNodes;\n        var isTableStart = startChildNodes.length > 1 && startChildNodes[0].nodeName === 'TABLE';\n        var start = ((isTableStart ? getLastTextNode(startChildNodes[range.startOffset + 1]) :\n            startChildNodes[(range.startOffset > 0) ? (range.startOffset - 1) : range.startOffset]) || range.startContainer);\n        var end = (range.endContainer.childNodes[(range.endOffset > 0) ? (range.endOffset - 1) : range.endOffset]\n            || range.endContainer);\n        if ((start.nodeType === Node.ELEMENT_NODE && end.nodeType === Node.ELEMENT_NODE) && (start.contains(end) || end.contains(start))) {\n            var existNode = start.contains(end) ? start : end;\n            var isElement = existNode.nodeType !== Node.TEXT_NODE;\n            if (isElement) {\n                var nodes = [];\n                var textNodes = [];\n                for (var node = existNode; existNode.contains(node); null) {\n                    if (nodes.indexOf(node) < 0 && node.childNodes && node.childNodes.length) {\n                        nodes.push(node);\n                        node = node.childNodes[0];\n                    }\n                    else if (node.nextSibling) {\n                        node = node.nextSibling;\n                    }\n                    else if (node.parentNode) {\n                        node = node.parentNode;\n                        nodes.push(node);\n                    }\n                    if (textNodes.indexOf(node) < 0 && (node.nodeType === Node.TEXT_NODE ||\n                        (CONSTANT.IGNORE_BLOCK_TAGS.indexOf(node.parentNode.tagName.toLocaleLowerCase()) >= 0\n                            && (node.tagName === 'BR' || node.tagName === 'IMG')))) {\n                        textNodes.push(node);\n                    }\n                }\n                if (textNodes.length) {\n                    start = start.contains(end) ? textNodes[0] : start;\n                    end = textNodes[textNodes.length - 1];\n                }\n            }\n        }\n        if (start !== end) {\n            if (start.nodeType !== Node.TEXT_NODE && ((start.tagName === 'BR' &&\n                CONSTANT.IGNORE_BLOCK_TAGS.indexOf(start.parentNode.tagName.toLocaleLowerCase()) >= 0) ||\n                start.tagName === 'IMG')) {\n                this.replaceWith(start, this.marker(markerClassName.startSelection, this.encode(start.textContent)));\n                var markerStart = range.startContainer.querySelector('.' + markerClassName.startSelection);\n                markerStart.appendChild(start);\n            }\n            else {\n                this.replaceWith(start, this.marker(markerClassName.startSelection, this.encode(start.textContent)));\n            }\n            if (end.nodeType !== Node.TEXT_NODE && end.tagName === 'BR' &&\n                CONSTANT.IGNORE_BLOCK_TAGS.indexOf(end.parentNode.tagName.toLocaleLowerCase()) >= 0) {\n                this.replaceWith(end, this.marker(markerClassName.endSelection, this.encode(end.textContent)));\n                var markerEnd = range.endContainer.querySelector('.' + markerClassName.endSelection);\n                markerEnd.appendChild(end);\n            }\n            else {\n                this.ensureSelfClosingTag(end, markerClassName.endSelection, range);\n            }\n        }\n        else {\n            this.ensureSelfClosingTag(start, markerClassName.startSelection, range);\n        }\n    };\n    /**\n     * ensureSelfClosingTag method\n     *\n     * @param {Element} start - specifies the element.\n     * @param {string} className - specifes the class name string value\n     * @param {Range} range - specifies the range value\n     * @returns {void}\n     * @hidden\n\n     */\n    DOMNode.prototype.ensureSelfClosingTag = function (start, className, range) {\n        var isTable = false;\n        if (start.nodeType === 3) {\n            this.replaceWith(start, this.marker(className, this.encode(start.textContent)));\n        }\n        else if (start.tagName === 'BR') {\n            this.replaceWith(start, this.marker(className, this.encode(start.textContent)));\n            var markerStart = range.startContainer.querySelector('.' + className);\n            markerStart.appendChild(start);\n        }\n        else {\n            if (start.tagName === 'IMG') {\n                var parNode = document.createElement('p');\n                start.parentElement.insertBefore(parNode, start);\n                parNode.appendChild(start);\n                start = parNode.children[0];\n            }\n            if (start.tagName === 'TABLE') {\n                isTable = true;\n                if (start.textContent === '') {\n                    var tdNode = start.querySelectorAll('td');\n                    start = tdNode[tdNode.length - 1];\n                    start = !isNullOrUndefined(start.childNodes[0]) ? start.childNodes[0] : start;\n                }\n                else {\n                    var lastNode = start.lastChild;\n                    while (lastNode.nodeType !== 3 && lastNode.nodeName !== '#text' &&\n                        lastNode.nodeName !== 'BR') {\n                        lastNode = lastNode.lastChild;\n                    }\n                    start = lastNode;\n                }\n            }\n            for (var i = 0; i < selfClosingTags.length; i++) {\n                start = (start.tagName === selfClosingTags[i] && !isTable) ? start.parentNode : start;\n            }\n            if (start.nodeType === 3 && start.nodeName === '#text') {\n                this.replaceWith(start, this.marker(className, this.encode(start.textContent)));\n            }\n            else if (start.nodeName === 'BR') {\n                this.replaceWith(start, this.marker(markerClassName.endSelection, this.encode(start.textContent)));\n                var markerEnd = range.endContainer.querySelector('.' + markerClassName.endSelection);\n                markerEnd.appendChild(start);\n            }\n            else {\n                var marker = this.marker(className, '');\n                append([this.parseHTMLFragment(marker)], start);\n            }\n        }\n    };\n    /**\n     * createTempNode method\n     *\n     * @param {Element} element - specifies the element.\n     * @returns {Element} - returns the element\n     * @hidden\n\n     */\n    DOMNode.prototype.createTempNode = function (element) {\n        var textContent = element.textContent;\n        if (element.tagName === 'BR') {\n            var wrapper = '<' + CONSTANT.DEFAULT_TAG + '></' + CONSTANT.DEFAULT_TAG + '>';\n            var node = element.parentNode;\n            if (CONSTANT.IGNORE_BLOCK_TAGS.indexOf(node.tagName.toLocaleLowerCase()) >= 0) {\n                element = this.wrap(element, this.parseHTMLFragment(wrapper));\n            }\n        }\n        else if (((element.nodeType !== Node.TEXT_NODE &&\n            (element.classList.contains(markerClassName.startSelection) ||\n                element.classList.contains(markerClassName.endSelection))) ||\n            textContent.replace(/\\n/g, '').replace(/(^ *)|( *$)/g, '').length > 0 ||\n            textContent.length && textContent.indexOf('\\n') < 0)) {\n            var wrapper = '<' + CONSTANT.DEFAULT_TAG + '></' + CONSTANT.DEFAULT_TAG + '>';\n            var target = element;\n            element = this.wrap(element, this.parseHTMLFragment(wrapper));\n            var ignoreBr = target.nodeType === Node.ELEMENT_NODE && target.firstChild && target.firstChild.nodeName === 'BR'\n                && (target.classList.contains(markerClassName.startSelection) ||\n                    target.classList.contains(markerClassName.endSelection));\n            if (!ignoreBr && element.nextElementSibling && element.nextElementSibling.tagName === 'BR') {\n                element.appendChild(element.nextElementSibling);\n            }\n        }\n        return element;\n    };\n    /**\n     * getImageTagInSelection method\n     *\n     * @returns {void}\n     * @hidden\n\n     */\n    DOMNode.prototype.getImageTagInSelection = function () {\n        var selection = this.getSelection();\n        if (this.isEditorArea() && selection.rangeCount) {\n            return selection.focusNode.querySelectorAll('img');\n        }\n        return null;\n    };\n    /**\n     * blockNodes method\n     *\n     * @returns {Node[]} - returns the node array values\n     * @hidden\n\n     */\n    DOMNode.prototype.blockNodes = function () {\n        var collectionNodes = [];\n        var selection = this.getSelection();\n        if (this.isEditorArea() && selection.rangeCount) {\n            var ranges = this.getRangePoint();\n            for (var j = 0; j < ranges.length; j++) {\n                var parentNode = void 0;\n                var range = ranges[j];\n                var startNode = this.getSelectedNode(range.startContainer, range.startOffset);\n                var endNode = this.getSelectedNode(range.endContainer, range.endOffset);\n                if (this.isBlockNode(startNode) && collectionNodes.indexOf(startNode) < 0) {\n                    collectionNodes.push(startNode);\n                }\n                parentNode = this.blockParentNode(startNode);\n                if (parentNode && collectionNodes.indexOf(parentNode) < 0) {\n                    if (CONSTANT.IGNORE_BLOCK_TAGS.indexOf(parentNode.tagName.toLocaleLowerCase()) >= 0 && (startNode.tagName === 'BR' ||\n                        startNode.nodeType === Node.TEXT_NODE ||\n                        startNode.classList.contains(markerClassName.startSelection) ||\n                        startNode.classList.contains(markerClassName.endSelection))) {\n                        var tempNode = startNode.previousSibling &&\n                            startNode.previousSibling.nodeType === Node.TEXT_NODE ?\n                            startNode.previousSibling : startNode;\n                        if (!startNode.nextSibling && !startNode.previousSibling && startNode.tagName === 'BR') {\n                            collectionNodes.push(tempNode);\n                        }\n                        else {\n                            collectionNodes.push(this.createTempNode(tempNode));\n                        }\n                    }\n                    else {\n                        collectionNodes.push(parentNode);\n                    }\n                }\n                var nodes = [];\n                for (var node = startNode; node !== endNode && node !== this.parent; null) {\n                    if (nodes.indexOf(node) < 0 && node.childNodes && node.childNodes.length) {\n                        nodes.push(node);\n                        node = node.childNodes[0];\n                    }\n                    else if (node && node.nodeType !== 8 && (node.tagName === 'BR' || (node.nodeType === Node.TEXT_NODE &&\n                        node.textContent.trim() !== '') || (node.nodeType !== Node.TEXT_NODE &&\n                        (node.classList.contains(markerClassName.startSelection) ||\n                            node.classList.contains(markerClassName.endSelection)))) &&\n                        CONSTANT.IGNORE_BLOCK_TAGS.indexOf(node.parentNode.tagName.toLocaleLowerCase()) >= 0) {\n                        node = this.createTempNode(node);\n                    }\n                    else if (node.nextSibling && node.nextSibling.nodeType !== 8 &&\n                        (node.nextSibling.tagName === 'BR' ||\n                            node.nextSibling.nodeType === Node.TEXT_NODE ||\n                            node.nextSibling.classList.contains(markerClassName.startSelection) ||\n                            node.nextSibling.classList.contains(markerClassName.endSelection)) &&\n                        CONSTANT.IGNORE_BLOCK_TAGS.indexOf(node.nextSibling.parentNode.tagName.toLocaleLowerCase()) >= 0) {\n                        node = this.createTempNode(node.nextSibling);\n                    }\n                    else if (node.nextSibling) {\n                        node = node.nextSibling;\n                    }\n                    else if (node.parentNode) {\n                        node = node.parentNode;\n                        nodes.push(node);\n                    }\n                    if (collectionNodes.indexOf(node) < 0 && node.nodeType === Node.ELEMENT_NODE &&\n                        CONSTANT.IGNORE_BLOCK_TAGS.indexOf(node.parentNode.tagName.toLocaleLowerCase()) >= 0 &&\n                        (node.classList.contains(markerClassName.startSelection) ||\n                            node.classList.contains(markerClassName.endSelection))) {\n                        collectionNodes.push(this.createTempNode(node));\n                    }\n                    if (this.isBlockNode(node) && this.ignoreTableTag(node) && nodes.indexOf(node) < 0 &&\n                        collectionNodes.indexOf(node) < 0 && (node !== endNode || range.endOffset > 0)) {\n                        collectionNodes.push(node);\n                    }\n                    if (node.nodeName === 'IMG' && node.parentElement.contentEditable === 'true') {\n                        collectionNodes.push(node);\n                    }\n                }\n                parentNode = this.blockParentNode(endNode);\n                if (parentNode && this.ignoreTableTag(parentNode) && collectionNodes.indexOf(parentNode) < 0 &&\n                    (!isNullOrUndefined(parentNode.previousElementSibling) && parentNode.previousElementSibling.tagName !== 'IMG')) {\n                    collectionNodes.push(parentNode);\n                }\n            }\n        }\n        for (var i = collectionNodes.length - 1; i > 0; i--) {\n            var nodes = this.nodeFinds(collectionNodes[i], collectionNodes);\n            if (nodes.length) {\n                var listNodes = collectionNodes[i].querySelectorAll('ul, ol');\n                if (collectionNodes[i].tagName === 'LI' && listNodes.length > 0) {\n                    continue;\n                }\n                else {\n                    collectionNodes.splice(i, 1);\n                }\n            }\n        }\n        return collectionNodes;\n    };\n    DOMNode.prototype.ignoreTableTag = function (element) {\n        return !(CONSTANT.TABLE_BLOCK_TAGS.indexOf(element.tagName.toLocaleLowerCase()) >= 0);\n    };\n    return DOMNode;\n}());\nexport { DOMNode };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}