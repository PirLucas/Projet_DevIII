{"ast":null,"code":"import * as events from '../base/constant';\nimport { isNullOrUndefined, closest, attributes, removeClass, addClass, Browser, detach } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined as isNOU } from '@syncfusion/ej2-base';\nimport { HTMLFormatter } from '../formatter/html-formatter';\nimport { RenderType } from '../base/enum';\nimport * as classes from '../base/classes';\nimport { HtmlToolbarStatus } from './html-toolbar-status';\nimport { IframeContentRender } from '../renderer/iframe-content-renderer';\nimport { ContentRender } from '../renderer/content-renderer';\nimport { ColorPickerInput } from './color-picker';\nimport { NodeSelection } from '../../selection/selection';\nimport { InsertHtml } from '../../editor-manager/plugin/inserthtml';\nimport { getTextNodesUnder, sanitizeHelper, getDefaultValue } from '../base/util';\nimport { isIDevice } from '../../common/util';\nimport { XhtmlValidation } from './xhtml-validation';\nimport { ON_BEGIN } from './../../common/constant';\n/**\n * `HtmlEditor` module is used to HTML editor\n */\nvar HtmlEditor = /** @class */function () {\n  function HtmlEditor(parent, serviceLocator) {\n    this.rangeCollection = [];\n    this.isImageDelete = false;\n    this.parent = parent;\n    this.locator = serviceLocator;\n    this.renderFactory = this.locator.getService('rendererFactory');\n    this.xhtmlValidation = new XhtmlValidation(parent);\n    this.addEventListener();\n  }\n  /**\n   * Destroys the Markdown.\n   *\n   * @function destroy\n   * @returns {void}\n   * @hidden\n    */\n  HtmlEditor.prototype.destroy = function () {\n    this.removeEventListener();\n  };\n  /**\n   * @param {string} value - specifies the string value\n   * @returns {void}\n   * @hidden\n    */\n  HtmlEditor.prototype.sanitizeHelper = function (value) {\n    value = sanitizeHelper(value, this.parent);\n    return value;\n  };\n  HtmlEditor.prototype.addEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n    this.nodeSelectionObj = new NodeSelection();\n    this.colorPickerModule = new ColorPickerInput(this.parent, this.locator);\n    this.parent.on(events.initialLoad, this.instantiateRenderer, this);\n    this.parent.on(events.htmlToolbarClick, this.onToolbarClick, this);\n    this.parent.on(events.keyDown, this.onKeyDown, this);\n    this.parent.on(events.keyUp, this.onKeyUp, this);\n    this.parent.on(events.renderColorPicker, this.renderColorPicker, this);\n    this.parent.on(events.initialEnd, this.render, this);\n    this.parent.on(events.modelChanged, this.onPropertyChanged, this);\n    this.parent.on(events.destroy, this.destroy, this);\n    this.parent.on(events.selectAll, this.selectAll, this);\n    this.parent.on(events.selectRange, this.selectRange, this);\n    this.parent.on(events.getSelectedHtml, this.getSelectedHtml, this);\n    this.parent.on(events.selectionSave, this.onSelectionSave, this);\n    this.parent.on(events.selectionRestore, this.onSelectionRestore, this);\n    this.parent.on(events.readOnlyMode, this.updateReadOnly, this);\n    this.parent.on(events.paste, this.onPaste, this);\n  };\n  HtmlEditor.prototype.updateReadOnly = function () {\n    if (this.parent.readonly) {\n      attributes(this.parent.contentModule.getEditPanel(), {\n        contenteditable: 'false'\n      });\n      addClass([this.parent.element], classes.CLS_RTE_READONLY);\n    } else {\n      attributes(this.parent.contentModule.getEditPanel(), {\n        contenteditable: 'true'\n      });\n      removeClass([this.parent.element], classes.CLS_RTE_READONLY);\n    }\n  };\n  HtmlEditor.prototype.onSelectionSave = function () {\n    var currentDocument = this.contentRenderer.getDocument();\n    var range = this.nodeSelectionObj.getRange(currentDocument);\n    this.saveSelection = this.nodeSelectionObj.save(range, currentDocument);\n  };\n  HtmlEditor.prototype.onSelectionRestore = function (e) {\n    this.parent.isBlur = false;\n    this.contentRenderer.getEditPanel().focus();\n    if (isNullOrUndefined(e.items) || e.items) {\n      this.saveSelection.restore();\n    }\n  };\n  HtmlEditor.prototype.onKeyUp = function (e) {\n    var args = e.args;\n    var restrictKeys = [8, 9, 13, 16, 17, 18, 20, 27, 37, 38, 39, 40, 44, 45, 46, 91, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123];\n    var range = this.parent.getRange();\n    var regEx = new RegExp(String.fromCharCode(8203), 'g');\n    var pointer;\n    if (restrictKeys.indexOf(args.keyCode) < 0 && !args.shiftKey && !args.ctrlKey && !args.altKey) {\n      if (range.startContainer.textContent.charCodeAt(0) === 8203) {\n        pointer = range.startOffset - 1;\n        range.startContainer.textContent = range.startContainer.textContent.replace(regEx, '');\n        this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), range.startContainer, pointer);\n      }\n      if (!isNOU(range.startContainer.previousSibling) && !isNOU(range.startContainer.previousSibling.parentElement) && range.startContainer.parentElement === range.startContainer.previousSibling.parentElement && range.startContainer.previousSibling.textContent.charCodeAt(0) === 8203 && range.startContainer.previousSibling.textContent.length <= 1) {\n        range.startContainer.previousSibling.textContent = range.startContainer.previousSibling.textContent.replace(regEx, '');\n      }\n      if (range.endContainer.textContent.charCodeAt(range.endOffset) === 8203) {\n        pointer = range.startOffset;\n        range.endContainer.textContent = range.endContainer.textContent.replace(regEx, '');\n        this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), range.startContainer, pointer);\n      }\n    }\n  };\n  HtmlEditor.prototype.onKeyDown = function (e) {\n    var _this = this;\n    var currentRange;\n    var args = e.args;\n    if (Browser.info.name === 'chrome') {\n      currentRange = this.parent.getRange();\n      this.backSpaceCleanup(e, currentRange);\n      this.deleteCleanup(e, currentRange);\n    }\n    if (args.keyCode === 9 && this.parent.enableTabKey) {\n      if (!isNOU(args.target) && isNullOrUndefined(closest(args.target, '.e-rte-toolbar'))) {\n        var range = this.nodeSelectionObj.getRange(this.contentRenderer.getDocument());\n        var parentNode = this.nodeSelectionObj.getParentNodeCollection(range);\n        if (!((parentNode[0].nodeName === 'LI' || closest(parentNode[0], 'li') || closest(parentNode[0], 'table')) && range.startOffset === 0)) {\n          args.preventDefault();\n          if (!args.shiftKey) {\n            InsertHtml.Insert(this.contentRenderer.getDocument(), '&nbsp;&nbsp;&nbsp;&nbsp;');\n            this.rangeCollection.push(this.nodeSelectionObj.getRange(this.contentRenderer.getDocument()));\n          } else if (this.rangeCollection.length > 0 && this.rangeCollection[this.rangeCollection.length - 1].startContainer.textContent.length === 4) {\n            var textCont = this.rangeCollection[this.rangeCollection.length - 1].startContainer;\n            this.nodeSelectionObj.setSelectionText(this.contentRenderer.getDocument(), textCont, textCont, 0, textCont.textContent.length);\n            InsertHtml.Insert(this.contentRenderer.getDocument(), document.createTextNode(''));\n            this.rangeCollection.pop();\n          }\n        }\n      }\n    }\n    if (e.args.action === 'space' || e.args.action === 'enter' || e.args.keyCode === 13) {\n      this.spaceLink(e.args);\n      if (this.parent.editorMode === 'HTML' && !this.parent.readonly) {\n        this.parent.notify(events.enterHandler, {\n          args: e.args\n        });\n      }\n    }\n    if (e.args.action === 'space') {\n      var currentRange_1 = this.parent.getRange();\n      var editorValue = currentRange_1.startContainer.textContent.slice(0, currentRange_1.startOffset);\n      var orderedList_1 = this.isOrderedList(editorValue);\n      var unOrderedList = this.isUnOrderedList(editorValue);\n      if (orderedList_1 && !unOrderedList || unOrderedList && !orderedList_1) {\n        var eventArgs_1 = {\n          callBack: null,\n          event: e.args,\n          name: 'keydown-handler'\n        };\n        var actionBeginArgs = {\n          cancel: false,\n          item: {\n            command: 'Lists',\n            subCommand: orderedList_1 ? 'OL' : 'UL'\n          },\n          name: 'actionBegin',\n          originalEvent: e.args,\n          requestType: orderedList_1 ? 'OL' : 'UL'\n        };\n        this.parent.trigger(events.actionBegin, actionBeginArgs, function (actionBeginArgs) {\n          if (!actionBeginArgs.cancel) {\n            _this.parent.formatter.editorManager.observer.notify(ON_BEGIN, eventArgs_1);\n            _this.parent.trigger(events.actionComplete, {\n              editorMode: _this.parent.editorMode,\n              elements: _this.parent.formatter.editorManager.domNode.blockNodes(),\n              event: e.args,\n              name: events.actionComplete,\n              range: _this.parent.getRange(),\n              requestType: orderedList_1 ? 'OL' : 'UL'\n            });\n          }\n        });\n      }\n    }\n    if (Browser.info.name === 'chrome' && (!isNullOrUndefined(this.rangeElement) && !isNullOrUndefined(this.oldRangeElement) || !isNullOrUndefined(this.deleteRangeElement) && !isNullOrUndefined(this.deleteOldRangeElement)) && currentRange.startContainer.parentElement.tagName !== 'TD' && currentRange.startContainer.parentElement.tagName !== 'TH') {\n      this.rangeElement = null;\n      this.oldRangeElement = null;\n      this.deleteRangeElement = null;\n      this.deleteOldRangeElement = null;\n      if (!this.isImageDelete) {\n        args.preventDefault();\n      }\n    }\n  };\n  HtmlEditor.prototype.isOrderedList = function (editorValue) {\n    editorValue = editorValue.replace(/\\u200B/g, '');\n    var olListStartRegex = [/^[1]+[.]+$/, /^[i]+[.]+$/, /^[a]+[.]+$/];\n    if (!isNullOrUndefined(editorValue)) {\n      for (var i = 0; i < olListStartRegex.length; i++) {\n        if (olListStartRegex[i].test(editorValue)) {\n          return true;\n        }\n      }\n    }\n    return false;\n  };\n  HtmlEditor.prototype.isUnOrderedList = function (editorValue) {\n    editorValue = editorValue.replace(/\\u200B/g, '');\n    var ulListStartRegex = [/^[*]$/, /^[-]$/];\n    if (!isNullOrUndefined(editorValue)) {\n      for (var i = 0; i < ulListStartRegex.length; i++) {\n        if (ulListStartRegex[i].test(editorValue)) {\n          return true;\n        }\n      }\n    }\n    return false;\n  };\n  HtmlEditor.prototype.backSpaceCleanup = function (e, currentRange) {\n    var isLiElement = false;\n    if (e.args.code === 'Backspace' && e.args.keyCode === 8 && currentRange.startOffset === 0 && currentRange.endOffset === 0 && this.parent.getSelection().length === 0 && currentRange.startContainer.textContent.length > 0 && currentRange.startContainer.parentElement.tagName !== 'TD' && currentRange.startContainer.parentElement.tagName !== 'TH') {\n      this.rangeElement = this.getRootBlockNode(currentRange.startContainer);\n      if (this.rangeElement.tagName === 'OL' || this.rangeElement.tagName === 'UL') {\n        var liElement = this.getRangeLiNode(currentRange.startContainer);\n        if (liElement.previousElementSibling && liElement.previousElementSibling.childElementCount > 0) {\n          this.oldRangeElement = liElement.previousElementSibling.lastElementChild.nodeName === 'BR' ? liElement.previousElementSibling : liElement.previousElementSibling.lastElementChild;\n          if (!isNullOrUndefined(liElement.lastElementChild) && liElement.lastElementChild.nodeName !== 'BR') {\n            this.rangeElement = liElement.lastElementChild;\n            isLiElement = true;\n          } else {\n            this.rangeElement = liElement;\n          }\n        }\n      } else if (this.rangeElement.tagName === 'TABLE' || !isNullOrUndefined(this.rangeElement.previousElementSibling) && this.rangeElement.previousElementSibling.tagName === 'TABLE') {\n        return;\n      } else {\n        this.oldRangeElement = this.rangeElement.previousElementSibling;\n      }\n      if (isNullOrUndefined(this.oldRangeElement)) {\n        return;\n      } else {\n        if (this.oldRangeElement.tagName === 'OL' || this.oldRangeElement.tagName === 'UL') {\n          this.oldRangeElement = this.oldRangeElement.lastElementChild.lastElementChild ? this.oldRangeElement.lastElementChild.lastElementChild : this.oldRangeElement.lastElementChild;\n        }\n        this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(),\n        // eslint-disable-next-line\n        this.oldRangeElement, this.oldRangeElement.childNodes.length);\n        if (this.oldRangeElement.querySelector('BR')) {\n          detach(this.oldRangeElement.querySelector('BR'));\n        }\n        if (!isNullOrUndefined(this.rangeElement) && this.oldRangeElement !== this.rangeElement) {\n          while (this.rangeElement.firstChild) {\n            this.oldRangeElement.appendChild(this.rangeElement.childNodes[0]);\n          }\n          // eslint-disable-next-line\n          !isLiElement ? detach(this.rangeElement) : detach(this.rangeElement.parentElement);\n          this.oldRangeElement.normalize();\n        }\n      }\n    }\n  };\n  HtmlEditor.prototype.deleteCleanup = function (e, currentRange) {\n    var isLiElement = false;\n    var liElement;\n    var rootElement;\n    if (e.args.code === 'Delete' && e.args.keyCode === 46 && this.parent.contentModule.getText().trim().length !== 0 && this.parent.getSelection().length === 0 && currentRange.startContainer.parentElement.tagName !== 'TD' && currentRange.startContainer.parentElement.tagName !== 'TH') {\n      this.deleteRangeElement = rootElement = this.getRootBlockNode(currentRange.startContainer);\n      if (this.deleteRangeElement.tagName === 'OL' || this.deleteRangeElement.tagName === 'UL') {\n        liElement = this.getRangeLiNode(currentRange.startContainer);\n        if (liElement.nextElementSibling && liElement.nextElementSibling.childElementCount > 0 && !liElement.nextElementSibling.querySelector('BR')) {\n          if (!isNullOrUndefined(liElement.lastElementChild)) {\n            this.deleteRangeElement = liElement.lastElementChild;\n            isLiElement = true;\n          } else {\n            this.deleteRangeElement = liElement;\n          }\n        } else {\n          this.deleteRangeElement = this.getRangeElement(liElement);\n        }\n      } else if (this.deleteRangeElement.nodeType === 3 || this.deleteRangeElement.tagName === 'TABLE' || !isNullOrUndefined(this.deleteRangeElement.nextElementSibling) && this.deleteRangeElement.nextElementSibling.tagName === 'TABLE') {\n        return;\n      }\n      if (this.getCaretIndex(currentRange, this.deleteRangeElement) === this.deleteRangeElement.textContent.length) {\n        if (!isNullOrUndefined(liElement)) {\n          if (isLiElement || !isNullOrUndefined(liElement.nextElementSibling)) {\n            this.deleteOldRangeElement = this.getRangeElement(liElement.nextElementSibling);\n          } else {\n            this.deleteOldRangeElement = rootElement.nextElementSibling;\n          }\n        } else {\n          this.deleteOldRangeElement = this.deleteRangeElement.nextElementSibling;\n        }\n        if (isNullOrUndefined(this.deleteOldRangeElement)) {\n          return;\n        } else {\n          if (currentRange.startOffset === 0 && currentRange.endOffset === 1 && this.deleteRangeElement.childNodes[0].nodeName === 'IMG') {\n            this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.parent.contentModule.getDocument(), this.deleteRangeElement, this.deleteRangeElement, 0, 1);\n            this.isImageDelete = true;\n          } else {\n            this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), this.deleteRangeElement, this.deleteRangeElement.childNodes.length);\n            this.isImageDelete = false;\n          }\n          if (this.deleteRangeElement.querySelector('BR')) {\n            detach(this.deleteRangeElement.querySelector('BR'));\n          }\n          if (!isNullOrUndefined(this.deleteRangeElement) && this.deleteOldRangeElement.tagName !== 'OL' && this.deleteOldRangeElement.tagName !== 'UL' && this.deleteOldRangeElement !== this.deleteRangeElement) {\n            while (this.deleteOldRangeElement.firstChild) {\n              this.deleteRangeElement.appendChild(this.deleteOldRangeElement.childNodes[0]);\n            }\n            if (!isLiElement) {\n              detach(this.deleteOldRangeElement);\n            } else {\n              detach(this.deleteOldRangeElement.parentElement);\n            }\n            this.deleteRangeElement.normalize();\n          } else {\n            this.deleteRangeElement = null;\n            this.deleteOldRangeElement = null;\n          }\n        }\n      } else {\n        this.deleteRangeElement = null;\n      }\n    }\n  };\n  HtmlEditor.prototype.getCaretIndex = function (currentRange, element) {\n    var position = 0;\n    if (this.parent.contentModule.getDocument().getSelection().rangeCount !== 0) {\n      var preCaretRange = currentRange.cloneRange();\n      preCaretRange.selectNodeContents(element);\n      preCaretRange.setEnd(currentRange.endContainer, currentRange.endOffset);\n      position = preCaretRange.toString().length;\n    }\n    return position;\n  };\n  HtmlEditor.prototype.getRangeElement = function (element) {\n    var rangeElement = element.lastElementChild ? element.lastElementChild.tagName === 'BR' ? element.lastElementChild.previousElementSibling ? element.lastElementChild.previousElementSibling : element : element.lastElementChild : element;\n    return rangeElement;\n  };\n  HtmlEditor.prototype.getRootBlockNode = function (rangeBlockNode) {\n    // eslint-disable-next-line\n    for (; rangeBlockNode && this.parent && this.parent.inputElement !== rangeBlockNode; rangeBlockNode = rangeBlockNode) {\n      if (rangeBlockNode.parentElement === this.parent.inputElement) {\n        break;\n      } else {\n        rangeBlockNode = rangeBlockNode.parentElement;\n      }\n    }\n    return rangeBlockNode;\n  };\n  HtmlEditor.prototype.getRangeLiNode = function (rangeLiNode) {\n    var node = rangeLiNode.parentElement;\n    while (node !== this.parent.inputElement) {\n      if (node.nodeType === 1 && node.tagName === 'LI') {\n        break;\n      }\n      node = node.parentElement;\n    }\n    return node;\n  };\n  HtmlEditor.prototype.onPaste = function (e) {\n    // eslint-disable-next-line\n    var regex = new RegExp(/([^\\S]|^)(((https?\\:\\/\\/)|(www\\.))(\\S+))/gi);\n    if (e.text.match(regex)) {\n      if (e.isWordPaste) {\n        return;\n      }\n      e.args.preventDefault();\n      var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n      // eslint-disable-next-line\n      var saveSelection = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n      // eslint-disable-next-line\n      var httpRegex = new RegExp(/([^\\S]|^)(((https?\\:\\/\\/)))/gi);\n      var wwwRegex = new RegExp(/([^\\S]|^)(((www\\.))(\\S+))/gi);\n      var enterSplitText = e.text.split('\\n');\n      var contentInnerElem = '';\n      for (var i = 0; i < enterSplitText.length; i++) {\n        if (enterSplitText[i].trim() === '') {\n          contentInnerElem += getDefaultValue(this.parent);\n        } else {\n          var contentWithSpace = '';\n          var spaceBetweenContent = true;\n          var spaceSplit = enterSplitText[i].split(' ');\n          for (var j = 0; j < spaceSplit.length; j++) {\n            if (spaceSplit[j].trim() === '') {\n              contentWithSpace += spaceBetweenContent ? '&nbsp;' : ' ';\n            } else {\n              spaceBetweenContent = false;\n              contentWithSpace += spaceSplit[j] + ' ';\n            }\n          }\n          if (i === 0) {\n            contentInnerElem += '<span>' + contentWithSpace.trim() + '</span>';\n          } else {\n            contentInnerElem += '<p>' + contentWithSpace.trim() + '</p>';\n          }\n        }\n      }\n      var divElement = this.parent.createElement('div');\n      divElement.setAttribute('class', 'pasteContent');\n      divElement.style.display = 'inline';\n      divElement.innerHTML = contentInnerElem.replace('&para', '&amp;para');\n      var paraElem = divElement.querySelectorAll('span, p');\n      for (var i = 0; i < paraElem.length; i++) {\n        var splitTextContent = paraElem[i].innerHTML.split(' ');\n        var resultSplitContent = '';\n        for (var j = 0; j < splitTextContent.length; j++) {\n          if (splitTextContent[j].match(httpRegex) || splitTextContent[j].match(wwwRegex)) {\n            resultSplitContent += '<a className=\"e-rte-anchor\" href=\"' + splitTextContent[j] + '\" title=\"' + splitTextContent[j] + '\"target=\"_blank\">' + splitTextContent[j] + ' </a>';\n          } else {\n            resultSplitContent += splitTextContent[j] + ' ';\n          }\n        }\n        paraElem[i].innerHTML = resultSplitContent.trim();\n      }\n      if (!isNullOrUndefined(this.parent.pasteCleanupModule)) {\n        e.callBack(divElement.innerHTML);\n      } else {\n        this.parent.formatter.editorManager.execCommand('insertHTML', null, null, null, divElement);\n      }\n    }\n  };\n  HtmlEditor.prototype.spaceLink = function (e) {\n    var range = this.nodeSelectionObj.getRange(this.contentRenderer.getDocument());\n    var selectNodeEle = this.nodeSelectionObj.getParentNodeCollection(range);\n    var text = range.startContainer.textContent.substr(0, range.endOffset);\n    var splitText = text.split(' ');\n    var urlText = splitText[splitText.length - 1];\n    var urlTextRange = range.startOffset - (text.length - splitText[splitText.length - 1].length);\n    urlText = urlText.slice(0, urlTextRange);\n    // eslint-disable-next-line\n    var regex = new RegExp(/([^\\S]|^)(((https?\\:\\/\\/)|(www\\.))(\\S+))/gi);\n    if (selectNodeEle[0].nodeName !== 'A' && urlText.match(regex)) {\n      var selection = this.nodeSelectionObj.save(range, this.parent.contentModule.getDocument());\n      var url = urlText.indexOf('http') > -1 ? urlText : 'http://' + urlText;\n      var selectParent = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n      var value = {\n        url: url,\n        selection: selection,\n        selectParent: selectParent,\n        text: urlText,\n        title: '',\n        target: '_blank'\n      };\n      this.parent.formatter.process(this.parent, {\n        item: {\n          'command': 'Links',\n          'subCommand': 'CreateLink'\n        }\n      }, e, value);\n    }\n  };\n  HtmlEditor.prototype.onToolbarClick = function (args) {\n    var save;\n    var selectNodeEle;\n    var selectParentEle;\n    var item = args.item;\n    var closestElement = closest(args.originalEvent.target, '.e-rte-quick-popup');\n    if (closestElement && !closestElement.classList.contains('e-rte-inline-popup')) {\n      if (!(item.subCommand === 'SourceCode' || item.subCommand === 'Preview' || item.subCommand === 'FontColor' || item.subCommand === 'BackgroundColor')) {\n        if (isIDevice() && item.command === 'Images') {\n          this.nodeSelectionObj.restore();\n        }\n        var range = this.nodeSelectionObj.getRange(this.parent.contentModule.getDocument());\n        save = this.nodeSelectionObj.save(range, this.parent.contentModule.getDocument());\n        selectNodeEle = this.nodeSelectionObj.getNodeCollection(range);\n        selectParentEle = this.nodeSelectionObj.getParentNodeCollection(range);\n      }\n      if (item.command === 'Images') {\n        this.parent.notify(events.imageToolbarAction, {\n          member: 'image',\n          args: args,\n          selectNode: selectNodeEle,\n          selection: save,\n          selectParent: selectParentEle\n        });\n      }\n      if (item.command === 'Links') {\n        this.parent.notify(events.linkToolbarAction, {\n          member: 'link',\n          args: args,\n          selectNode: selectNodeEle,\n          selection: save,\n          selectParent: selectParentEle\n        });\n      }\n      if (item.command === 'Table') {\n        this.parent.notify(events.tableToolbarAction, {\n          member: 'table',\n          args: args,\n          selectNode: selectNodeEle,\n          selection: save,\n          selectParent: selectParentEle\n        });\n      }\n    } else {\n      var linkDialog = document.getElementById(this.parent.getID() + '_rtelink');\n      var imageDialog = document.getElementById(this.parent.getID() + '_image');\n      if (!(item.subCommand === 'SourceCode' || item.subCommand === 'Preview' || item.subCommand === 'FontColor' || item.subCommand === 'BackgroundColor')) {\n        var range = this.nodeSelectionObj.getRange(this.parent.contentModule.getDocument());\n        if (isNullOrUndefined(linkDialog) && isNullOrUndefined(imageDialog)) {\n          save = this.nodeSelectionObj.save(range, this.parent.contentModule.getDocument());\n        }\n        selectNodeEle = this.nodeSelectionObj.getNodeCollection(range);\n        selectParentEle = this.nodeSelectionObj.getParentNodeCollection(range);\n      }\n      switch (item.subCommand) {\n        case 'Maximize':\n          this.parent.notify(events.enableFullScreen, {\n            args: args\n          });\n          break;\n        case 'Minimize':\n          this.parent.notify(events.disableFullScreen, {\n            args: args\n          });\n          break;\n        case 'CreateLink':\n          this.parent.notify(events.insertLink, {\n            member: 'link',\n            args: args,\n            selectNode: selectNodeEle,\n            selection: save,\n            selectParent: selectParentEle\n          });\n          break;\n        case 'RemoveLink':\n          this.parent.notify(events.unLink, {\n            member: 'link',\n            args: args,\n            selectNode: selectNodeEle,\n            selection: save,\n            selectParent: selectParentEle\n          });\n          break;\n        case 'Print':\n          this.parent.print();\n          break;\n        case 'Image':\n          this.parent.notify(events.insertImage, {\n            member: 'image',\n            args: args,\n            selectNode: selectNodeEle,\n            selection: save,\n            selectParent: selectParentEle\n          });\n          break;\n        case 'CreateTable':\n          this.parent.notify(events.createTable, {\n            member: 'table',\n            args: args,\n            selection: save\n          });\n          break;\n        case 'SourceCode':\n          this.parent.notify(events.sourceCode, {\n            member: 'viewSource',\n            args: args\n          });\n          break;\n        case 'Preview':\n          this.parent.notify(events.updateSource, {\n            member: 'updateSource',\n            args: args\n          });\n          break;\n        case 'FontColor':\n        case 'BackgroundColor':\n          break;\n        case 'File':\n          this.parent.notify(events.renderFileManager, {\n            member: 'fileManager',\n            args: args,\n            selectNode: selectNodeEle,\n            selection: save,\n            selectParent: selectParentEle\n          });\n          break;\n        default:\n          this.parent.formatter.process(this.parent, args, args.originalEvent, null);\n          break;\n      }\n    }\n  };\n  HtmlEditor.prototype.renderColorPicker = function (args) {\n    this.colorPickerModule.renderColorPickerInput(args);\n  };\n  HtmlEditor.prototype.instantiateRenderer = function () {\n    if (this.parent.iframeSettings.enable) {\n      this.renderFactory.addRenderer(RenderType.Content, new IframeContentRender(this.parent, this.locator));\n    } else {\n      this.renderFactory.addRenderer(RenderType.Content, new ContentRender(this.parent, this.locator));\n    }\n  };\n  HtmlEditor.prototype.removeEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n    this.parent.off(events.initialEnd, this.render);\n    this.parent.off(events.modelChanged, this.onPropertyChanged);\n    this.parent.off(events.htmlToolbarClick, this.onToolbarClick);\n    this.parent.off(events.renderColorPicker, this.renderColorPicker);\n    this.parent.off(events.destroy, this.destroy);\n    this.parent.off(events.keyDown, this.onKeyDown);\n    this.parent.off(events.initialLoad, this.instantiateRenderer);\n    this.parent.off(events.selectAll, this.selectAll);\n    this.parent.off(events.selectRange, this.selectRange);\n    this.parent.off(events.getSelectedHtml, this.getSelectedHtml);\n    this.parent.off(events.selectionSave, this.onSelectionSave);\n    this.parent.off(events.selectionRestore, this.onSelectionRestore);\n    this.parent.off(events.readOnlyMode, this.updateReadOnly);\n    this.parent.off(events.paste, this.onPaste);\n  };\n  HtmlEditor.prototype.render = function () {\n    this.contentRenderer = this.renderFactory.getRenderer(RenderType.Content);\n    var editElement = this.contentRenderer.getEditPanel();\n    var option = {\n      undoRedoSteps: this.parent.undoRedoSteps,\n      undoRedoTimer: this.parent.undoRedoTimer\n    };\n    if (isNullOrUndefined(this.parent.formatter)) {\n      var formatterClass = new HTMLFormatter({\n        currentDocument: this.contentRenderer.getDocument(),\n        element: editElement,\n        options: option\n      });\n      this.parent.setProperties({\n        formatter: formatterClass\n      }, true);\n    } else {\n      this.parent.formatter.updateFormatter(editElement, this.contentRenderer.getDocument(), option);\n    }\n    if (this.parent.enableXhtml) {\n      this.parent.notify(events.xhtmlValidation, {});\n    }\n    if (this.parent.toolbarSettings.enable) {\n      this.toolbarUpdate = new HtmlToolbarStatus(this.parent);\n    }\n    if (this.parent.inlineMode.enable) {\n      if (!isNullOrUndefined(this.parent.fontFamily.default)) {\n        editElement.style.fontFamily = this.parent.fontFamily.default;\n      }\n      if (!isNullOrUndefined(this.parent.fontSize.default)) {\n        editElement.style.fontSize = this.parent.fontSize.default;\n      }\n    }\n    this.parent.notify(events.bindOnEnd, {});\n  };\n  /**\n   * Called internally if any of the property value changed.\n   *\n   * @param {RichTextEditorModel} e - specifies the editor model\n   * @returns {void}\n   * @hidden\n    */\n  HtmlEditor.prototype.onPropertyChanged = function (e) {\n    // On property code change here\n    if (!isNullOrUndefined(e.newProp.formatter)) {\n      var editElement = this.contentRenderer.getEditPanel();\n      var option = {\n        undoRedoSteps: this.parent.undoRedoSteps,\n        undoRedoTimer: this.parent.undoRedoTimer\n      };\n      this.parent.formatter.updateFormatter(editElement, this.contentRenderer.getDocument(), option);\n    }\n  };\n  /**\n   * For internal use only - Get the module name.\n   *\n   * @returns {string} - returns the string value\n   * @hidden\n   */\n  HtmlEditor.prototype.getModuleName = function () {\n    return 'htmlEditor';\n  };\n  /**\n   * For selecting all content in RTE\n   *\n   * @returns {void}\n   * @private\n   * @hidden\n   */\n  HtmlEditor.prototype.selectAll = function () {\n    var nodes = getTextNodesUnder(this.parent.contentModule.getDocument(), this.parent.contentModule.getEditPanel());\n    if (nodes.length > 0) {\n      this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.parent.contentModule.getDocument(), nodes[0], nodes[nodes.length - 1], 0, nodes[nodes.length - 1].textContent.length);\n    }\n  };\n  /**\n   * For selecting all content in RTE\n   *\n   * @param {NotifyArgs} e - specifies the notified arguments\n   * @returns {void}\n   * @private\n   * @hidden\n   */\n  HtmlEditor.prototype.selectRange = function (e) {\n    this.parent.formatter.editorManager.nodeSelection.setRange(this.parent.contentModule.getDocument(), e.range);\n  };\n  /**\n   * For get a selected text in RTE\n   *\n   * @param {NotifyArgs} e - specifies the notified arguments\n   * @returns {void}\n   * @hidden\n   */\n  HtmlEditor.prototype.getSelectedHtml = function (e) {\n    e.callBack(this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()).toString());\n  };\n  return HtmlEditor;\n}();\nexport { HtmlEditor };","map":{"version":3,"names":["events","isNullOrUndefined","closest","attributes","removeClass","addClass","Browser","detach","isNOU","HTMLFormatter","RenderType","classes","HtmlToolbarStatus","IframeContentRender","ContentRender","ColorPickerInput","NodeSelection","InsertHtml","getTextNodesUnder","sanitizeHelper","getDefaultValue","isIDevice","XhtmlValidation","ON_BEGIN","HtmlEditor","parent","serviceLocator","rangeCollection","isImageDelete","locator","renderFactory","getService","xhtmlValidation","addEventListener","prototype","destroy","removeEventListener","value","isDestroyed","nodeSelectionObj","colorPickerModule","on","initialLoad","instantiateRenderer","htmlToolbarClick","onToolbarClick","keyDown","onKeyDown","keyUp","onKeyUp","renderColorPicker","initialEnd","render","modelChanged","onPropertyChanged","selectAll","selectRange","getSelectedHtml","selectionSave","onSelectionSave","selectionRestore","onSelectionRestore","readOnlyMode","updateReadOnly","paste","onPaste","readonly","contentModule","getEditPanel","contenteditable","element","CLS_RTE_READONLY","currentDocument","contentRenderer","getDocument","range","getRange","saveSelection","save","e","isBlur","focus","items","restore","args","restrictKeys","regEx","RegExp","String","fromCharCode","pointer","indexOf","keyCode","shiftKey","ctrlKey","altKey","startContainer","textContent","charCodeAt","startOffset","replace","formatter","editorManager","nodeSelection","setCursorPoint","previousSibling","parentElement","length","endContainer","endOffset","_this","currentRange","info","name","backSpaceCleanup","deleteCleanup","enableTabKey","target","parentNode","getParentNodeCollection","nodeName","preventDefault","Insert","push","textCont","setSelectionText","document","createTextNode","pop","action","spaceLink","editorMode","notify","enterHandler","currentRange_1","editorValue","slice","orderedList_1","isOrderedList","unOrderedList","isUnOrderedList","eventArgs_1","callBack","event","actionBeginArgs","cancel","item","command","subCommand","originalEvent","requestType","trigger","actionBegin","observer","actionComplete","elements","domNode","blockNodes","rangeElement","oldRangeElement","deleteRangeElement","deleteOldRangeElement","tagName","olListStartRegex","i","test","ulListStartRegex","isLiElement","code","getSelection","getRootBlockNode","liElement","getRangeLiNode","previousElementSibling","childElementCount","lastElementChild","childNodes","querySelector","firstChild","appendChild","normalize","rootElement","getText","trim","nextElementSibling","getRangeElement","nodeType","getCaretIndex","position","rangeCount","preCaretRange","cloneRange","selectNodeContents","setEnd","toString","rangeBlockNode","inputElement","rangeLiNode","node","regex","text","match","isWordPaste","httpRegex","wwwRegex","enterSplitText","split","contentInnerElem","contentWithSpace","spaceBetweenContent","spaceSplit","j","divElement","createElement","setAttribute","style","display","innerHTML","paraElem","querySelectorAll","splitTextContent","resultSplitContent","pasteCleanupModule","execCommand","selectNodeEle","substr","splitText","urlText","urlTextRange","selection","url","selectParent","title","process","selectParentEle","closestElement","classList","contains","getNodeCollection","imageToolbarAction","member","selectNode","linkToolbarAction","tableToolbarAction","linkDialog","getElementById","getID","imageDialog","enableFullScreen","disableFullScreen","insertLink","unLink","print","insertImage","createTable","sourceCode","updateSource","renderFileManager","renderColorPickerInput","iframeSettings","enable","addRenderer","Content","off","getRenderer","editElement","option","undoRedoSteps","undoRedoTimer","formatterClass","options","setProperties","updateFormatter","enableXhtml","toolbarSettings","toolbarUpdate","inlineMode","fontFamily","default","fontSize","bindOnEnd","newProp","getModuleName","nodes","setRange"],"sources":["D:/USPERSO IMPLEMENTATION/Projet_DevIII/frontend/node_modules/@syncfusion/ej2-richtexteditor/src/rich-text-editor/actions/html-editor.js"],"sourcesContent":["import * as events from '../base/constant';\nimport { isNullOrUndefined, closest, attributes, removeClass, addClass, Browser, detach } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined as isNOU } from '@syncfusion/ej2-base';\nimport { HTMLFormatter } from '../formatter/html-formatter';\nimport { RenderType } from '../base/enum';\nimport * as classes from '../base/classes';\nimport { HtmlToolbarStatus } from './html-toolbar-status';\nimport { IframeContentRender } from '../renderer/iframe-content-renderer';\nimport { ContentRender } from '../renderer/content-renderer';\nimport { ColorPickerInput } from './color-picker';\nimport { NodeSelection } from '../../selection/selection';\nimport { InsertHtml } from '../../editor-manager/plugin/inserthtml';\nimport { getTextNodesUnder, sanitizeHelper, getDefaultValue } from '../base/util';\nimport { isIDevice } from '../../common/util';\nimport { XhtmlValidation } from './xhtml-validation';\nimport { ON_BEGIN } from './../../common/constant';\n/**\n * `HtmlEditor` module is used to HTML editor\n */\nvar HtmlEditor = /** @class */ (function () {\n    function HtmlEditor(parent, serviceLocator) {\n        this.rangeCollection = [];\n        this.isImageDelete = false;\n        this.parent = parent;\n        this.locator = serviceLocator;\n        this.renderFactory = this.locator.getService('rendererFactory');\n        this.xhtmlValidation = new XhtmlValidation(parent);\n        this.addEventListener();\n    }\n    /**\n     * Destroys the Markdown.\n     *\n     * @function destroy\n     * @returns {void}\n     * @hidden\n\n     */\n    HtmlEditor.prototype.destroy = function () {\n        this.removeEventListener();\n    };\n    /**\n     * @param {string} value - specifies the string value\n     * @returns {void}\n     * @hidden\n\n     */\n    HtmlEditor.prototype.sanitizeHelper = function (value) {\n        value = sanitizeHelper(value, this.parent);\n        return value;\n    };\n    HtmlEditor.prototype.addEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.nodeSelectionObj = new NodeSelection();\n        this.colorPickerModule = new ColorPickerInput(this.parent, this.locator);\n        this.parent.on(events.initialLoad, this.instantiateRenderer, this);\n        this.parent.on(events.htmlToolbarClick, this.onToolbarClick, this);\n        this.parent.on(events.keyDown, this.onKeyDown, this);\n        this.parent.on(events.keyUp, this.onKeyUp, this);\n        this.parent.on(events.renderColorPicker, this.renderColorPicker, this);\n        this.parent.on(events.initialEnd, this.render, this);\n        this.parent.on(events.modelChanged, this.onPropertyChanged, this);\n        this.parent.on(events.destroy, this.destroy, this);\n        this.parent.on(events.selectAll, this.selectAll, this);\n        this.parent.on(events.selectRange, this.selectRange, this);\n        this.parent.on(events.getSelectedHtml, this.getSelectedHtml, this);\n        this.parent.on(events.selectionSave, this.onSelectionSave, this);\n        this.parent.on(events.selectionRestore, this.onSelectionRestore, this);\n        this.parent.on(events.readOnlyMode, this.updateReadOnly, this);\n        this.parent.on(events.paste, this.onPaste, this);\n    };\n    HtmlEditor.prototype.updateReadOnly = function () {\n        if (this.parent.readonly) {\n            attributes(this.parent.contentModule.getEditPanel(), { contenteditable: 'false' });\n            addClass([this.parent.element], classes.CLS_RTE_READONLY);\n        }\n        else {\n            attributes(this.parent.contentModule.getEditPanel(), { contenteditable: 'true' });\n            removeClass([this.parent.element], classes.CLS_RTE_READONLY);\n        }\n    };\n    HtmlEditor.prototype.onSelectionSave = function () {\n        var currentDocument = this.contentRenderer.getDocument();\n        var range = this.nodeSelectionObj.getRange(currentDocument);\n        this.saveSelection = this.nodeSelectionObj.save(range, currentDocument);\n    };\n    HtmlEditor.prototype.onSelectionRestore = function (e) {\n        this.parent.isBlur = false;\n        this.contentRenderer.getEditPanel().focus();\n        if (isNullOrUndefined(e.items) || e.items) {\n            this.saveSelection.restore();\n        }\n    };\n    HtmlEditor.prototype.onKeyUp = function (e) {\n        var args = e.args;\n        var restrictKeys = [8, 9, 13, 16, 17, 18, 20, 27, 37, 38, 39, 40, 44, 45, 46, 91,\n            112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123];\n        var range = this.parent.getRange();\n        var regEx = new RegExp(String.fromCharCode(8203), 'g');\n        var pointer;\n        if (restrictKeys.indexOf(args.keyCode) < 0 && !args.shiftKey && !args.ctrlKey && !args.altKey) {\n            if (range.startContainer.textContent.charCodeAt(0) === 8203) {\n                pointer = range.startOffset - 1;\n                range.startContainer.textContent = range.startContainer.textContent.replace(regEx, '');\n                this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), range.startContainer, pointer);\n            }\n            if (!isNOU(range.startContainer.previousSibling) && !isNOU(range.startContainer.previousSibling.parentElement) &&\n                range.startContainer.parentElement === range.startContainer.previousSibling.parentElement &&\n                range.startContainer.previousSibling.textContent.charCodeAt(0) === 8203 &&\n                range.startContainer.previousSibling.textContent.length <= 1) {\n                range.startContainer.previousSibling.textContent = range.startContainer.previousSibling.textContent.replace(regEx, '');\n            }\n            if (range.endContainer.textContent.charCodeAt(range.endOffset) === 8203) {\n                pointer = range.startOffset;\n                range.endContainer.textContent = range.endContainer.textContent.replace(regEx, '');\n                this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), range.startContainer, pointer);\n            }\n        }\n    };\n    HtmlEditor.prototype.onKeyDown = function (e) {\n        var _this = this;\n        var currentRange;\n        var args = e.args;\n        if (Browser.info.name === 'chrome') {\n            currentRange = this.parent.getRange();\n            this.backSpaceCleanup(e, currentRange);\n            this.deleteCleanup(e, currentRange);\n        }\n        if (args.keyCode === 9 && this.parent.enableTabKey) {\n            if (!isNOU(args.target) && isNullOrUndefined(closest(args.target, '.e-rte-toolbar'))) {\n                var range = this.nodeSelectionObj.getRange(this.contentRenderer.getDocument());\n                var parentNode = this.nodeSelectionObj.getParentNodeCollection(range);\n                if (!((parentNode[0].nodeName === 'LI' || closest(parentNode[0], 'li') ||\n                    closest(parentNode[0], 'table')) && range.startOffset === 0)) {\n                    args.preventDefault();\n                    if (!args.shiftKey) {\n                        InsertHtml.Insert(this.contentRenderer.getDocument(), '&nbsp;&nbsp;&nbsp;&nbsp;');\n                        this.rangeCollection.push(this.nodeSelectionObj.getRange(this.contentRenderer.getDocument()));\n                    }\n                    else if (this.rangeCollection.length > 0 &&\n                        this.rangeCollection[this.rangeCollection.length - 1].startContainer.textContent.length === 4) {\n                        var textCont = this.rangeCollection[this.rangeCollection.length - 1].startContainer;\n                        this.nodeSelectionObj.setSelectionText(this.contentRenderer.getDocument(), textCont, textCont, 0, textCont.textContent.length);\n                        InsertHtml.Insert(this.contentRenderer.getDocument(), document.createTextNode(''));\n                        this.rangeCollection.pop();\n                    }\n                }\n            }\n        }\n        if (e.args.action === 'space' ||\n            e.args.action === 'enter' ||\n            e.args.keyCode === 13) {\n            this.spaceLink(e.args);\n            if (this.parent.editorMode === 'HTML' && !this.parent.readonly) {\n                this.parent.notify(events.enterHandler, { args: e.args });\n            }\n        }\n        if (e.args.action === 'space') {\n            var currentRange_1 = this.parent.getRange();\n            var editorValue = currentRange_1.startContainer.textContent.slice(0, currentRange_1.startOffset);\n            var orderedList_1 = this.isOrderedList(editorValue);\n            var unOrderedList = this.isUnOrderedList(editorValue);\n            if (orderedList_1 && !unOrderedList || unOrderedList && !orderedList_1) {\n                var eventArgs_1 = {\n                    callBack: null,\n                    event: e.args,\n                    name: 'keydown-handler'\n                };\n                var actionBeginArgs = {\n                    cancel: false,\n                    item: { command: 'Lists', subCommand: orderedList_1 ? 'OL' : 'UL' },\n                    name: 'actionBegin',\n                    originalEvent: e.args,\n                    requestType: orderedList_1 ? 'OL' : 'UL'\n                };\n                this.parent.trigger(events.actionBegin, actionBeginArgs, function (actionBeginArgs) {\n                    if (!actionBeginArgs.cancel) {\n                        _this.parent.formatter.editorManager.observer.notify(ON_BEGIN, eventArgs_1);\n                        _this.parent.trigger(events.actionComplete, {\n                            editorMode: _this.parent.editorMode,\n                            elements: _this.parent.formatter.editorManager.domNode.blockNodes(),\n                            event: e.args,\n                            name: events.actionComplete,\n                            range: _this.parent.getRange(),\n                            requestType: orderedList_1 ? 'OL' : 'UL'\n                        });\n                    }\n                });\n            }\n        }\n        if (Browser.info.name === 'chrome' && (!isNullOrUndefined(this.rangeElement) && !isNullOrUndefined(this.oldRangeElement) ||\n            !isNullOrUndefined(this.deleteRangeElement) && !isNullOrUndefined(this.deleteOldRangeElement)) &&\n            currentRange.startContainer.parentElement.tagName !== 'TD' && currentRange.startContainer.parentElement.tagName !== 'TH') {\n            this.rangeElement = null;\n            this.oldRangeElement = null;\n            this.deleteRangeElement = null;\n            this.deleteOldRangeElement = null;\n            if (!this.isImageDelete) {\n                args.preventDefault();\n            }\n        }\n    };\n    HtmlEditor.prototype.isOrderedList = function (editorValue) {\n        editorValue = editorValue.replace(/\\u200B/g, '');\n        var olListStartRegex = [/^[1]+[.]+$/, /^[i]+[.]+$/, /^[a]+[.]+$/];\n        if (!isNullOrUndefined(editorValue)) {\n            for (var i = 0; i < olListStartRegex.length; i++) {\n                if (olListStartRegex[i].test(editorValue)) {\n                    return true;\n                }\n            }\n        }\n        return false;\n    };\n    HtmlEditor.prototype.isUnOrderedList = function (editorValue) {\n        editorValue = editorValue.replace(/\\u200B/g, '');\n        var ulListStartRegex = [/^[*]$/, /^[-]$/];\n        if (!isNullOrUndefined(editorValue)) {\n            for (var i = 0; i < ulListStartRegex.length; i++) {\n                if (ulListStartRegex[i].test(editorValue)) {\n                    return true;\n                }\n            }\n        }\n        return false;\n    };\n    HtmlEditor.prototype.backSpaceCleanup = function (e, currentRange) {\n        var isLiElement = false;\n        if (e.args.code === 'Backspace' && e.args.keyCode === 8 && currentRange.startOffset === 0 &&\n            currentRange.endOffset === 0 && this.parent.getSelection().length === 0 && currentRange.startContainer.textContent.length > 0 &&\n            currentRange.startContainer.parentElement.tagName !== 'TD' && currentRange.startContainer.parentElement.tagName !== 'TH') {\n            this.rangeElement = this.getRootBlockNode(currentRange.startContainer);\n            if (this.rangeElement.tagName === 'OL' || this.rangeElement.tagName === 'UL') {\n                var liElement = this.getRangeLiNode(currentRange.startContainer);\n                if (liElement.previousElementSibling && liElement.previousElementSibling.childElementCount > 0) {\n                    this.oldRangeElement = liElement.previousElementSibling.lastElementChild.nodeName === 'BR' ?\n                        liElement.previousElementSibling : liElement.previousElementSibling.lastElementChild;\n                    if (!isNullOrUndefined(liElement.lastElementChild) && liElement.lastElementChild.nodeName !== 'BR') {\n                        this.rangeElement = liElement.lastElementChild;\n                        isLiElement = true;\n                    }\n                    else {\n                        this.rangeElement = liElement;\n                    }\n                }\n            }\n            else if (this.rangeElement.tagName === 'TABLE' || (!isNullOrUndefined(this.rangeElement.previousElementSibling) &&\n                this.rangeElement.previousElementSibling.tagName === 'TABLE')) {\n                return;\n            }\n            else {\n                this.oldRangeElement = this.rangeElement.previousElementSibling;\n            }\n            if (isNullOrUndefined(this.oldRangeElement)) {\n                return;\n            }\n            else {\n                if (this.oldRangeElement.tagName === 'OL' || this.oldRangeElement.tagName === 'UL') {\n                    this.oldRangeElement = this.oldRangeElement.lastElementChild.lastElementChild\n                        ? this.oldRangeElement.lastElementChild.lastElementChild :\n                        this.oldRangeElement.lastElementChild;\n                }\n                this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), \n                // eslint-disable-next-line\n                this.oldRangeElement, this.oldRangeElement.childNodes.length);\n                if (this.oldRangeElement.querySelector('BR')) {\n                    detach(this.oldRangeElement.querySelector('BR'));\n                }\n                if (!isNullOrUndefined(this.rangeElement) && this.oldRangeElement !== this.rangeElement) {\n                    while (this.rangeElement.firstChild) {\n                        this.oldRangeElement.appendChild(this.rangeElement.childNodes[0]);\n                    }\n                    // eslint-disable-next-line\n                    !isLiElement ? detach(this.rangeElement) : detach(this.rangeElement.parentElement);\n                    this.oldRangeElement.normalize();\n                }\n            }\n        }\n    };\n    HtmlEditor.prototype.deleteCleanup = function (e, currentRange) {\n        var isLiElement = false;\n        var liElement;\n        var rootElement;\n        if (e.args.code === 'Delete' && e.args.keyCode === 46 &&\n            this.parent.contentModule.getText().trim().length !== 0 && this.parent.getSelection().length === 0 && currentRange.startContainer.parentElement.tagName !== 'TD' &&\n            currentRange.startContainer.parentElement.tagName !== 'TH') {\n            this.deleteRangeElement = rootElement = this.getRootBlockNode(currentRange.startContainer);\n            if (this.deleteRangeElement.tagName === 'OL' || this.deleteRangeElement.tagName === 'UL') {\n                liElement = this.getRangeLiNode(currentRange.startContainer);\n                if (liElement.nextElementSibling && liElement.nextElementSibling.childElementCount > 0\n                    && !liElement.nextElementSibling.querySelector('BR')) {\n                    if (!isNullOrUndefined(liElement.lastElementChild)) {\n                        this.deleteRangeElement = liElement.lastElementChild;\n                        isLiElement = true;\n                    }\n                    else {\n                        this.deleteRangeElement = liElement;\n                    }\n                }\n                else {\n                    this.deleteRangeElement = this.getRangeElement(liElement);\n                }\n            }\n            else if (this.deleteRangeElement.nodeType === 3 || (this.deleteRangeElement.tagName === 'TABLE' ||\n                (!isNullOrUndefined(this.deleteRangeElement.nextElementSibling) && this.deleteRangeElement.nextElementSibling.tagName === 'TABLE'))) {\n                return;\n            }\n            if (this.getCaretIndex(currentRange, this.deleteRangeElement) === this.deleteRangeElement.textContent.length) {\n                if (!isNullOrUndefined(liElement)) {\n                    if (isLiElement || !isNullOrUndefined(liElement.nextElementSibling)) {\n                        this.deleteOldRangeElement = this.getRangeElement(liElement.nextElementSibling);\n                    }\n                    else {\n                        this.deleteOldRangeElement = rootElement.nextElementSibling;\n                    }\n                }\n                else {\n                    this.deleteOldRangeElement = this.deleteRangeElement.nextElementSibling;\n                }\n                if (isNullOrUndefined(this.deleteOldRangeElement)) {\n                    return;\n                }\n                else {\n                    if (currentRange.startOffset === 0 && currentRange.endOffset === 1 &&\n                        this.deleteRangeElement.childNodes[0].nodeName === 'IMG') {\n                        this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.parent.contentModule.getDocument(), this.deleteRangeElement, this.deleteRangeElement, 0, 1);\n                        this.isImageDelete = true;\n                    }\n                    else {\n                        this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), this.deleteRangeElement, this.deleteRangeElement.childNodes.length);\n                        this.isImageDelete = false;\n                    }\n                    if (this.deleteRangeElement.querySelector('BR')) {\n                        detach(this.deleteRangeElement.querySelector('BR'));\n                    }\n                    if (!isNullOrUndefined(this.deleteRangeElement) && (this.deleteOldRangeElement.tagName !== 'OL' && this.deleteOldRangeElement.tagName !== 'UL')\n                        && this.deleteOldRangeElement !== this.deleteRangeElement) {\n                        while (this.deleteOldRangeElement.firstChild) {\n                            this.deleteRangeElement.appendChild(this.deleteOldRangeElement.childNodes[0]);\n                        }\n                        if (!isLiElement) {\n                            detach(this.deleteOldRangeElement);\n                        }\n                        else {\n                            detach(this.deleteOldRangeElement.parentElement);\n                        }\n                        this.deleteRangeElement.normalize();\n                    }\n                    else {\n                        this.deleteRangeElement = null;\n                        this.deleteOldRangeElement = null;\n                    }\n                }\n            }\n            else {\n                this.deleteRangeElement = null;\n            }\n        }\n    };\n    HtmlEditor.prototype.getCaretIndex = function (currentRange, element) {\n        var position = 0;\n        if (this.parent.contentModule.getDocument().getSelection().rangeCount !== 0) {\n            var preCaretRange = currentRange.cloneRange();\n            preCaretRange.selectNodeContents(element);\n            preCaretRange.setEnd(currentRange.endContainer, currentRange.endOffset);\n            position = preCaretRange.toString().length;\n        }\n        return position;\n    };\n    HtmlEditor.prototype.getRangeElement = function (element) {\n        var rangeElement = element.lastElementChild ? element.lastElementChild.tagName === 'BR' ?\n            element.lastElementChild.previousElementSibling ? element.lastElementChild.previousElementSibling\n                : element : element.lastElementChild : element;\n        return rangeElement;\n    };\n    HtmlEditor.prototype.getRootBlockNode = function (rangeBlockNode) {\n        // eslint-disable-next-line\n        for (; rangeBlockNode && this.parent && this.parent.inputElement !== rangeBlockNode; rangeBlockNode = rangeBlockNode) {\n            if (rangeBlockNode.parentElement === this.parent.inputElement) {\n                break;\n            }\n            else {\n                rangeBlockNode = rangeBlockNode.parentElement;\n            }\n        }\n        return rangeBlockNode;\n    };\n    HtmlEditor.prototype.getRangeLiNode = function (rangeLiNode) {\n        var node = rangeLiNode.parentElement;\n        while (node !== this.parent.inputElement) {\n            if (node.nodeType === 1 && node.tagName === 'LI') {\n                break;\n            }\n            node = node.parentElement;\n        }\n        return node;\n    };\n    HtmlEditor.prototype.onPaste = function (e) {\n        // eslint-disable-next-line\n        var regex = new RegExp(/([^\\S]|^)(((https?\\:\\/\\/)|(www\\.))(\\S+))/gi);\n        if (e.text.match(regex)) {\n            if (e.isWordPaste) {\n                return;\n            }\n            e.args.preventDefault();\n            var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n            // eslint-disable-next-line\n            var saveSelection = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n            // eslint-disable-next-line\n            var httpRegex = new RegExp(/([^\\S]|^)(((https?\\:\\/\\/)))/gi);\n            var wwwRegex = new RegExp(/([^\\S]|^)(((www\\.))(\\S+))/gi);\n            var enterSplitText = e.text.split('\\n');\n            var contentInnerElem = '';\n            for (var i = 0; i < enterSplitText.length; i++) {\n                if (enterSplitText[i].trim() === '') {\n                    contentInnerElem += getDefaultValue(this.parent);\n                }\n                else {\n                    var contentWithSpace = '';\n                    var spaceBetweenContent = true;\n                    var spaceSplit = enterSplitText[i].split(' ');\n                    for (var j = 0; j < spaceSplit.length; j++) {\n                        if (spaceSplit[j].trim() === '') {\n                            contentWithSpace += spaceBetweenContent ? '&nbsp;' : ' ';\n                        }\n                        else {\n                            spaceBetweenContent = false;\n                            contentWithSpace += spaceSplit[j] + ' ';\n                        }\n                    }\n                    if (i === 0) {\n                        contentInnerElem += '<span>' + contentWithSpace.trim() + '</span>';\n                    }\n                    else {\n                        contentInnerElem += '<p>' + contentWithSpace.trim() + '</p>';\n                    }\n                }\n            }\n            var divElement = this.parent.createElement('div');\n            divElement.setAttribute('class', 'pasteContent');\n            divElement.style.display = 'inline';\n            divElement.innerHTML = contentInnerElem.replace('&para', '&amp;para');\n            var paraElem = divElement.querySelectorAll('span, p');\n            for (var i = 0; i < paraElem.length; i++) {\n                var splitTextContent = paraElem[i].innerHTML.split(' ');\n                var resultSplitContent = '';\n                for (var j = 0; j < splitTextContent.length; j++) {\n                    if (splitTextContent[j].match(httpRegex) || splitTextContent[j].match(wwwRegex)) {\n                        resultSplitContent += '<a className=\"e-rte-anchor\" href=\"' + splitTextContent[j] +\n                            '\" title=\"' + splitTextContent[j] + '\"target=\"_blank\">' + splitTextContent[j] + ' </a>';\n                    }\n                    else {\n                        resultSplitContent += splitTextContent[j] + ' ';\n                    }\n                }\n                paraElem[i].innerHTML = resultSplitContent.trim();\n            }\n            if (!isNullOrUndefined(this.parent.pasteCleanupModule)) {\n                e.callBack(divElement.innerHTML);\n            }\n            else {\n                this.parent.formatter.editorManager.execCommand('insertHTML', null, null, null, divElement);\n            }\n        }\n    };\n    HtmlEditor.prototype.spaceLink = function (e) {\n        var range = this.nodeSelectionObj.getRange(this.contentRenderer.getDocument());\n        var selectNodeEle = this.nodeSelectionObj.getParentNodeCollection(range);\n        var text = range.startContainer.textContent.substr(0, range.endOffset);\n        var splitText = text.split(' ');\n        var urlText = splitText[splitText.length - 1];\n        var urlTextRange = range.startOffset - (text.length - splitText[splitText.length - 1].length);\n        urlText = urlText.slice(0, urlTextRange);\n        // eslint-disable-next-line\n        var regex = new RegExp(/([^\\S]|^)(((https?\\:\\/\\/)|(www\\.))(\\S+))/gi);\n        if (selectNodeEle[0].nodeName !== 'A' && urlText.match(regex)) {\n            var selection = this.nodeSelectionObj.save(range, this.parent.contentModule.getDocument());\n            var url = urlText.indexOf('http') > -1 ? urlText : 'http://' + urlText;\n            var selectParent = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n            var value = {\n                url: url,\n                selection: selection, selectParent: selectParent,\n                text: urlText,\n                title: '',\n                target: '_blank'\n            };\n            this.parent.formatter.process(this.parent, {\n                item: {\n                    'command': 'Links',\n                    'subCommand': 'CreateLink'\n                }\n            }, e, value);\n        }\n    };\n    HtmlEditor.prototype.onToolbarClick = function (args) {\n        var save;\n        var selectNodeEle;\n        var selectParentEle;\n        var item = args.item;\n        var closestElement = closest(args.originalEvent.target, '.e-rte-quick-popup');\n        if (closestElement && !closestElement.classList.contains('e-rte-inline-popup')) {\n            if (!(item.subCommand === 'SourceCode' || item.subCommand === 'Preview' ||\n                item.subCommand === 'FontColor' || item.subCommand === 'BackgroundColor')) {\n                if (isIDevice() && item.command === 'Images') {\n                    this.nodeSelectionObj.restore();\n                }\n                var range = this.nodeSelectionObj.getRange(this.parent.contentModule.getDocument());\n                save = this.nodeSelectionObj.save(range, this.parent.contentModule.getDocument());\n                selectNodeEle = this.nodeSelectionObj.getNodeCollection(range);\n                selectParentEle = this.nodeSelectionObj.getParentNodeCollection(range);\n            }\n            if (item.command === 'Images') {\n                this.parent.notify(events.imageToolbarAction, {\n                    member: 'image', args: args, selectNode: selectNodeEle, selection: save, selectParent: selectParentEle\n                });\n            }\n            if (item.command === 'Links') {\n                this.parent.notify(events.linkToolbarAction, {\n                    member: 'link', args: args, selectNode: selectNodeEle, selection: save, selectParent: selectParentEle\n                });\n            }\n            if (item.command === 'Table') {\n                this.parent.notify(events.tableToolbarAction, {\n                    member: 'table', args: args, selectNode: selectNodeEle, selection: save, selectParent: selectParentEle\n                });\n            }\n        }\n        else {\n            var linkDialog = document.getElementById(this.parent.getID() + '_rtelink');\n            var imageDialog = document.getElementById(this.parent.getID() + '_image');\n            if (!(item.subCommand === 'SourceCode' || item.subCommand === 'Preview' ||\n                item.subCommand === 'FontColor' || item.subCommand === 'BackgroundColor')) {\n                var range = this.nodeSelectionObj.getRange(this.parent.contentModule.getDocument());\n                if (isNullOrUndefined(linkDialog) && isNullOrUndefined(imageDialog)) {\n                    save = this.nodeSelectionObj.save(range, this.parent.contentModule.getDocument());\n                }\n                selectNodeEle = this.nodeSelectionObj.getNodeCollection(range);\n                selectParentEle = this.nodeSelectionObj.getParentNodeCollection(range);\n            }\n            switch (item.subCommand) {\n                case 'Maximize':\n                    this.parent.notify(events.enableFullScreen, { args: args });\n                    break;\n                case 'Minimize':\n                    this.parent.notify(events.disableFullScreen, { args: args });\n                    break;\n                case 'CreateLink':\n                    this.parent.notify(events.insertLink, {\n                        member: 'link', args: args, selectNode: selectNodeEle, selection: save, selectParent: selectParentEle\n                    });\n                    break;\n                case 'RemoveLink':\n                    this.parent.notify(events.unLink, {\n                        member: 'link', args: args, selectNode: selectNodeEle, selection: save, selectParent: selectParentEle\n                    });\n                    break;\n                case 'Print':\n                    this.parent.print();\n                    break;\n                case 'Image':\n                    this.parent.notify(events.insertImage, {\n                        member: 'image', args: args, selectNode: selectNodeEle, selection: save, selectParent: selectParentEle\n                    });\n                    break;\n                case 'CreateTable':\n                    this.parent.notify(events.createTable, {\n                        member: 'table', args: args, selection: save\n                    });\n                    break;\n                case 'SourceCode':\n                    this.parent.notify(events.sourceCode, { member: 'viewSource', args: args });\n                    break;\n                case 'Preview':\n                    this.parent.notify(events.updateSource, { member: 'updateSource', args: args });\n                    break;\n                case 'FontColor':\n                case 'BackgroundColor':\n                    break;\n                case 'File':\n                    this.parent.notify(events.renderFileManager, {\n                        member: 'fileManager', args: args, selectNode: selectNodeEle, selection: save, selectParent: selectParentEle\n                    });\n                    break;\n                default:\n                    this.parent.formatter.process(this.parent, args, args.originalEvent, null);\n                    break;\n            }\n        }\n    };\n    HtmlEditor.prototype.renderColorPicker = function (args) {\n        this.colorPickerModule.renderColorPickerInput(args);\n    };\n    HtmlEditor.prototype.instantiateRenderer = function () {\n        if (this.parent.iframeSettings.enable) {\n            this.renderFactory.addRenderer(RenderType.Content, new IframeContentRender(this.parent, this.locator));\n        }\n        else {\n            this.renderFactory.addRenderer(RenderType.Content, new ContentRender(this.parent, this.locator));\n        }\n    };\n    HtmlEditor.prototype.removeEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.off(events.initialEnd, this.render);\n        this.parent.off(events.modelChanged, this.onPropertyChanged);\n        this.parent.off(events.htmlToolbarClick, this.onToolbarClick);\n        this.parent.off(events.renderColorPicker, this.renderColorPicker);\n        this.parent.off(events.destroy, this.destroy);\n        this.parent.off(events.keyDown, this.onKeyDown);\n        this.parent.off(events.initialLoad, this.instantiateRenderer);\n        this.parent.off(events.selectAll, this.selectAll);\n        this.parent.off(events.selectRange, this.selectRange);\n        this.parent.off(events.getSelectedHtml, this.getSelectedHtml);\n        this.parent.off(events.selectionSave, this.onSelectionSave);\n        this.parent.off(events.selectionRestore, this.onSelectionRestore);\n        this.parent.off(events.readOnlyMode, this.updateReadOnly);\n        this.parent.off(events.paste, this.onPaste);\n    };\n    HtmlEditor.prototype.render = function () {\n        this.contentRenderer = this.renderFactory.getRenderer(RenderType.Content);\n        var editElement = this.contentRenderer.getEditPanel();\n        var option = { undoRedoSteps: this.parent.undoRedoSteps, undoRedoTimer: this.parent.undoRedoTimer };\n        if (isNullOrUndefined(this.parent.formatter)) {\n            var formatterClass = new HTMLFormatter({\n                currentDocument: this.contentRenderer.getDocument(),\n                element: editElement,\n                options: option\n            });\n            this.parent.setProperties({ formatter: formatterClass }, true);\n        }\n        else {\n            this.parent.formatter.updateFormatter(editElement, this.contentRenderer.getDocument(), option);\n        }\n        if (this.parent.enableXhtml) {\n            this.parent.notify(events.xhtmlValidation, {});\n        }\n        if (this.parent.toolbarSettings.enable) {\n            this.toolbarUpdate = new HtmlToolbarStatus(this.parent);\n        }\n        if (this.parent.inlineMode.enable) {\n            if (!isNullOrUndefined(this.parent.fontFamily.default)) {\n                editElement.style.fontFamily = this.parent.fontFamily.default;\n            }\n            if (!isNullOrUndefined(this.parent.fontSize.default)) {\n                editElement.style.fontSize = this.parent.fontSize.default;\n            }\n        }\n        this.parent.notify(events.bindOnEnd, {});\n    };\n    /**\n     * Called internally if any of the property value changed.\n     *\n     * @param {RichTextEditorModel} e - specifies the editor model\n     * @returns {void}\n     * @hidden\n\n     */\n    HtmlEditor.prototype.onPropertyChanged = function (e) {\n        // On property code change here\n        if (!isNullOrUndefined(e.newProp.formatter)) {\n            var editElement = this.contentRenderer.getEditPanel();\n            var option = { undoRedoSteps: this.parent.undoRedoSteps,\n                undoRedoTimer: this.parent.undoRedoTimer };\n            this.parent.formatter.updateFormatter(editElement, this.contentRenderer.getDocument(), option);\n        }\n    };\n    /**\n     * For internal use only - Get the module name.\n     *\n     * @returns {string} - returns the string value\n     * @hidden\n     */\n    HtmlEditor.prototype.getModuleName = function () {\n        return 'htmlEditor';\n    };\n    /**\n     * For selecting all content in RTE\n     *\n     * @returns {void}\n     * @private\n     * @hidden\n     */\n    HtmlEditor.prototype.selectAll = function () {\n        var nodes = getTextNodesUnder(this.parent.contentModule.getDocument(), this.parent.contentModule.getEditPanel());\n        if (nodes.length > 0) {\n            this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.parent.contentModule.getDocument(), nodes[0], nodes[nodes.length - 1], 0, nodes[nodes.length - 1].textContent.length);\n        }\n    };\n    /**\n     * For selecting all content in RTE\n     *\n     * @param {NotifyArgs} e - specifies the notified arguments\n     * @returns {void}\n     * @private\n     * @hidden\n     */\n    HtmlEditor.prototype.selectRange = function (e) {\n        this.parent.formatter.editorManager.nodeSelection.setRange(this.parent.contentModule.getDocument(), e.range);\n    };\n    /**\n     * For get a selected text in RTE\n     *\n     * @param {NotifyArgs} e - specifies the notified arguments\n     * @returns {void}\n     * @hidden\n     */\n    HtmlEditor.prototype.getSelectedHtml = function (e) {\n        e.callBack(this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()).toString());\n    };\n    return HtmlEditor;\n}());\nexport { HtmlEditor };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}